LavaPack.loadBundle([[4081,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){function n(e){if(Array.isArray(e)){const t=[];for(let r=0;r<e.length;r++)t.push(n(e[r]));const r=p(...t);return p(i(r.length,192),r)}const t=y(e);return 1===t.length&&t[0]<128?t:p(i(t.length,128),t)}function s(e,t,r){if(r>e.length)throw new Error("invalid RLP (safeSlice): end slice of Uint8Array out-of-bounds");return e.slice(t,r)}function o(e){if(0===e[0])throw new Error("invalid RLP: extra zeros");return u(d(e))}function i(e,t){if(e<56)return Uint8Array.from([e+t]);const r=m(e),n=m(t+55+r.length/2);return Uint8Array.from(h(n+r))}function a(e,t=!1){if(!e||0===e.length)return Uint8Array.from([]);const r=l(y(e));if(t)return r;if(0!==r.remainder.length)throw new Error("invalid RLP: remainder must be zero");return r.data}function l(e){let t,r,n,i,a;const c=[],d=e[0];if(d<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(d<=183){if(t=d-127,n=128===d?Uint8Array.from([]):s(e,1,t),2===t&&n[0]<128)throw new Error("invalid RLP encoding: invalid prefix, single byte < 0x80 are not prefixed");return{data:n,remainder:e.slice(t)}}if(d<=191){if(r=d-182,e.length-1<r)throw new Error("invalid RLP: not enough bytes for string length");if(t=o(s(e,1,r)),t<=55)throw new Error("invalid RLP: expected string length to be greater than 55");return n=s(e,r,t+r),{data:n,remainder:e.slice(t+r)}}if(d<=247){for(t=d-191,i=s(e,1,t);i.length;)a=l(i),c.push(a.data),i=a.remainder;return{data:c,remainder:e.slice(t)}}{if(r=d-246,t=o(s(e,1,r)),t<56)throw new Error("invalid RLP: encoded list too short");const n=r+t;if(n>e.length)throw new Error("invalid RLP: total length is larger than the data");for(i=s(e,r,n);i.length;)a=l(i),c.push(a.data),i=a.remainder;return{data:c,remainder:e.slice(n)}}}Object.defineProperty(r,"__esModule",{value:!0}),r.utils=r.decode=r.encode=void 0,r.encode=n,r.decode=a;const c=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function d(e){let t="";for(let r=0;r<e.length;r++)t+=c[e[r]];return t}function u(e){const t=Number.parseInt(e,16);if(Number.isNaN(t))throw new Error("Invalid byte sequence");return t}function h(e){if("string"!=typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){const n=2*r;t[r]=u(e.slice(n,n+2))}return t}function p(...e){if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),r=new Uint8Array(t);for(let t=0,n=0;t<e.length;t++){const s=e[t];r.set(s,n),n+=s.length}return r}function g(e){return(new TextEncoder).encode(e)}function m(e){if(e<0)throw new Error("Invalid integer as argument, must be unsigned!");const t=e.toString(16);return t.length%2?`0${t}`:t}function f(e){return e.length>=2&&"0"===e[0]&&"x"===e[1]}function y(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)return f(e)?h((t="string"!=typeof(r=e)?r:f(r)?r.slice(2):r).length%2?`0${t}`:t):g(e);var t,r;if("number"==typeof e||"bigint"==typeof e)return e?h(m(e)):Uint8Array.from([]);if(null===e||e===undefined)return Uint8Array.from([]);throw new Error("toBytes: received unsupported type "+typeof e)}r.utils={bytesToHex:d,concatBytes:p,hexToBytes:h,utf8ToBytes:g};const b={encode:n,decode:a};r.default=b}}},{package:"eth-lattice-keyring>rlp",file:"node_modules/rlp/dist/index.js"}],[4090,{timers:4200},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(e){(function(){!function(n){const s=2147483647;function o(e){const t=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);let r=1779033703,n=3144134277,s=1013904242,o=2773480762,i=1359893119,a=2600822924,l=528734635,c=1541459225;const d=new Uint32Array(64);function u(e){let u=0,h=e.length;for(;h>=64;){let p,g,m,f,y,b=r,w=n,C=s,v=o,_=i,S=a,k=l,T=c;for(g=0;g<16;g++)m=u+4*g,d[g]=(255&e[m])<<24|(255&e[m+1])<<16|(255&e[m+2])<<8|255&e[m+3];for(g=16;g<64;g++)p=d[g-2],f=(p>>>17|p<<15)^(p>>>19|p<<13)^p>>>10,p=d[g-15],y=(p>>>7|p<<25)^(p>>>18|p<<14)^p>>>3,d[g]=(f+d[g-7]|0)+(y+d[g-16]|0)|0;for(g=0;g<64;g++)f=(((_>>>6|_<<26)^(_>>>11|_<<21)^(_>>>25|_<<7))+(_&S^~_&k)|0)+(T+(t[g]+d[g]|0)|0)|0,y=((b>>>2|b<<30)^(b>>>13|b<<19)^(b>>>22|b<<10))+(b&w^b&C^w&C)|0,T=k,k=S,S=_,_=v+f|0,v=C,C=w,w=b,b=f+y|0;r=r+b|0,n=n+w|0,s=s+C|0,o=o+v|0,i=i+_|0,a=a+S|0,l=l+k|0,c=c+T|0,u+=64,h-=64}}u(e);let h,p=e.length%64,g=e.length/536870912|0,m=e.length<<3,f=p<56?56:120,y=e.slice(e.length-p,e.length);for(y.push(128),h=p+1;h<f;h++)y.push(0);return y.push(g>>>24&255),y.push(g>>>16&255),y.push(g>>>8&255),y.push(g>>>0&255),y.push(m>>>24&255),y.push(m>>>16&255),y.push(m>>>8&255),y.push(m>>>0&255),u(y),[r>>>24&255,r>>>16&255,r>>>8&255,r>>>0&255,n>>>24&255,n>>>16&255,n>>>8&255,n>>>0&255,s>>>24&255,s>>>16&255,s>>>8&255,s>>>0&255,o>>>24&255,o>>>16&255,o>>>8&255,o>>>0&255,i>>>24&255,i>>>16&255,i>>>8&255,i>>>0&255,a>>>24&255,a>>>16&255,a>>>8&255,a>>>0&255,l>>>24&255,l>>>16&255,l>>>8&255,l>>>0&255,c>>>24&255,c>>>16&255,c>>>8&255,c>>>0&255]}function i(e,t,r){e=e.length<=64?e:o(e);const n=64+t.length+4,s=new Array(n),i=new Array(64);let a,l=[];for(a=0;a<64;a++)s[a]=54;for(a=0;a<e.length;a++)s[a]^=e[a];for(a=0;a<t.length;a++)s[64+a]=t[a];for(a=n-4;a<n;a++)s[a]=0;for(a=0;a<64;a++)i[a]=92;for(a=0;a<e.length;a++)i[a]^=e[a];function c(){for(let e=n-1;e>=n-4;e--){if(s[e]++,s[e]<=255)return;s[e]=0}}for(;r>=32;)c(),l=l.concat(o(i.concat(o(s)))),r-=32;return r>0&&(c(),l=l.concat(o(i.concat(o(s))).slice(0,r))),l}function a(e,t,r,n,s){let o;for(u(e,16*(2*r-1),s,0,16),o=0;o<2*r;o++)d(e,16*o,s,16),c(s,n),u(s,0,e,t+16*o,16);for(o=0;o<r;o++)u(e,t+2*o*16,e,16*o,16);for(o=0;o<r;o++)u(e,t+16*(2*o+1),e,16*(o+r),16)}function l(e,t){return e<<t|e>>>32-t}function c(e,t){u(e,0,t,0,16);for(let e=8;e>0;e-=2)t[4]^=l(t[0]+t[12],7),t[8]^=l(t[4]+t[0],9),t[12]^=l(t[8]+t[4],13),t[0]^=l(t[12]+t[8],18),t[9]^=l(t[5]+t[1],7),t[13]^=l(t[9]+t[5],9),t[1]^=l(t[13]+t[9],13),t[5]^=l(t[1]+t[13],18),t[14]^=l(t[10]+t[6],7),t[2]^=l(t[14]+t[10],9),t[6]^=l(t[2]+t[14],13),t[10]^=l(t[6]+t[2],18),t[3]^=l(t[15]+t[11],7),t[7]^=l(t[3]+t[15],9),t[11]^=l(t[7]+t[3],13),t[15]^=l(t[11]+t[7],18),t[1]^=l(t[0]+t[3],7),t[2]^=l(t[1]+t[0],9),t[3]^=l(t[2]+t[1],13),t[0]^=l(t[3]+t[2],18),t[6]^=l(t[5]+t[4],7),t[7]^=l(t[6]+t[5],9),t[4]^=l(t[7]+t[6],13),t[5]^=l(t[4]+t[7],18),t[11]^=l(t[10]+t[9],7),t[8]^=l(t[11]+t[10],9),t[9]^=l(t[8]+t[11],13),t[10]^=l(t[9]+t[8],18),t[12]^=l(t[15]+t[14],7),t[13]^=l(t[12]+t[15],9),t[14]^=l(t[13]+t[12],13),t[15]^=l(t[14]+t[13],18);for(let r=0;r<16;++r)e[r]+=t[r]}function d(e,t,r,n){for(let s=0;s<n;s++)r[s]^=e[t+s]}function u(e,t,r,n,s){for(;s--;)r[n++]=e[t++]}function h(e){if(!e||"number"!=typeof e.length)return!1;for(let t=0;t<e.length;t++){const r=e[t];if("number"!=typeof r||r%1||r<0||r>=256)return!1}return!0}function p(e,t){if("number"!=typeof e||e%1)throw new Error("invalid "+t);return e}function g(t,r,n,o,l,c,g){if(n=p(n,"N"),o=p(o,"r"),l=p(l,"p"),c=p(c,"dkLen"),0===n||n&n-1)throw new Error("N must be power of 2");if(n>s/128/o)throw new Error("N too large");if(o>s/128/l)throw new Error("r too large");if(!h(t))throw new Error("password must be an array or buffer");if(t=Array.prototype.slice.call(t),!h(r))throw new Error("salt must be an array or buffer");r=Array.prototype.slice.call(r);let m=i(t,r,128*l*o);const f=new Uint32Array(32*l*o);for(let e=0;e<f.length;e++){const t=4*e;f[e]=(255&m[t+3])<<24|(255&m[t+2])<<16|(255&m[t+1])<<8|255&m[t+0]}const y=new Uint32Array(64*o),b=new Uint32Array(32*o*n),w=32*o,C=new Uint32Array(16),v=new Uint32Array(16),_=l*n*2;let S,k,T=0,E=null,A=!1,M=0,P=0;const N=g?parseInt(1e3/o):4294967295,I=void 0!==e?e:setTimeout,R=function(){if(A)return g(new Error("cancelled"),T/_);let e;switch(M){case 0:k=32*P*o,u(f,k,y,0,w),M=1,S=0;case 1:e=n-S,e>N&&(e=N);for(let t=0;t<e;t++)u(y,0,b,(S+t)*w,w),a(y,w,o,C,v);if(S+=e,T+=e,g){const e=parseInt(1e3*T/_);if(e!==E){if(A=g(null,T/_),A)break;E=e}}if(S<n)break;S=0,M=2;case 2:e=n-S,e>N&&(e=N);for(let t=0;t<e;t++){const e=y[16*(2*o-1)]&n-1;d(b,e*w,y,w),a(y,w,o,C,v)}if(S+=e,T+=e,g){const e=parseInt(1e3*T/_);if(e!==E){if(A=g(null,T/_),A)break;E=e}}if(S<n)break;if(u(y,0,f,k,w),P++,P<l){M=0;break}m=[];for(let e=0;e<f.length;e++)m.push(255&f[e]),m.push(f[e]>>8&255),m.push(f[e]>>16&255),m.push(f[e]>>24&255);const r=i(t,m,c);return g&&g(null,1,r),r}g&&I(R)};if(!g)for(;;){const e=R();if(e!=undefined)return e}R()}const m={scrypt:function(e,t,r,n,s,o,i){return new Promise((function(a,l){let c=0;i&&i(0),g(e,t,r,n,s,o,(function(e,t,r){if(e)l(e);else if(r)i&&1!==c&&i(1),a(new Uint8Array(r));else if(i&&t!==c)return c=t,i(t)}))}))},syncScrypt:function(e,t,r,n,s,o){return new Uint8Array(g(e,t,r,n,s,o))}};void 0!==r?t.exports=m:"function"==typeof define&&define.amd?define(m):n&&(n.scrypt&&(n._scrypt=n.scrypt),n.scrypt=m)}(this)}).call(this)}).call(this,e("timers").setImmediate)}}},{package:"ethereumjs-util>ethereum-cryptography>scrypt-js",file:"node_modules/scrypt-js/scrypt.js"}],[41,{loglevel:3644},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,n){n((n=>{r.error&&s.default.debug("Error in RPC response:\n",r),t.isMetamaskInternal||(s.default.info(`RPC (${e.origin}): ${t.method} -> ${r.error?"error":"success"}`),n())}))}};var n,s=(n=e("loglevel"))&&n.__esModule?n:{default:n}}}},{package:"$root$",file:"app/scripts/lib/createLoggerMiddleware.js"}],[4188,{events:3097,"fast-fifo":3127,"queue-tick":3870},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){const{EventEmitter:n}=e("events"),s=new Error("Stream was destroyed"),o=new Error("Premature close"),i=e("queue-tick"),a=e("fast-fifo"),l=134217727,c=1^l,d=2^l,u=64,h=128,p=256,g=1024,m=2048,f=4096,y=8192,b=16384,w=32768,C=16^l,v=768^l,_=134184959,S=32^l,k=2<<17,T=4<<17,E=8<<17,A=16<<17,M=32<<17,P=64<<17,N=128<<17,I=256<<17,R=512<<17,x=100532223,O=133693439,L=117440511,D=131088,U=134086639,j=4210688,F=14,B=15,q=4210702,K=16809984,$=16809999,H=1179648,G=1179663,W=Symbol.asyncIterator||Symbol("asyncIterator");class z{constructor(e,{highWaterMark:t=16384,map:r=null,mapWritable:n,byteLength:s,byteLengthWritable:o}={}){this.stream=e,this.queue=new a,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||s||ge,this.map=n||r,this.afterWrite=ee.bind(this),this.afterUpdateNextTick=ne.bind(this)}get ended(){return!!(this.stream._duplexState&M)}push(e){return null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),this.buffered<this.highWaterMark?(this.stream._duplexState|=E,!0):(this.stream._duplexState|=3145728,!1)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=133169151),e}end(e){"function"==typeof e?this.stream.once("finish",e):e!==undefined&&null!==e&&this.push(e),this.stream._duplexState=(this.stream._duplexState|R)&O}autoBatch(e,t){const r=[],n=this.stream;for(r.push(e);(n._duplexState&G)===H;)r.push(n._writableState.shift());if(n._duplexState&B)return t(null);n._writev(r,t)}update(){const e=this.stream;e._duplexState|=k;do{for(;(e._duplexState&G)===E;){const t=this.shift();e._duplexState|=33685504,e._write(t,this.afterWrite)}655360&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=133955583}updateNonPrimary(){const e=this.stream;if((72482831&e._duplexState)===R)return e._duplexState=67108863&e._duplexState|131072,void e._final(X.bind(this));4!=(e._duplexState&F)?1==(e._duplexState&$)&&(e._duplexState=(e._duplexState|D)&c,e._open(se.bind(this))):e._duplexState&K||(e._duplexState|=D,e._destroy(Z.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&N)&&(this.stream._duplexState&=L,!0)}updateCallback(){(17563663&this.stream._duplexState)===T?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&N||(this.stream._duplexState|=N,this.stream._duplexState&k||i(this.afterUpdateNextTick))}}class V{constructor(e,{highWaterMark:t=16384,map:r=null,mapReadable:n,byteLength:s,byteLengthReadable:o}={}){this.stream=e,this.queue=new a,this.highWaterMark=t,this.buffered=0,this.error=null,this.pipeline=null,this.byteLength=o||s||ge,this.map=n||r,this.pipeTo=null,this.afterRead=te.bind(this),this.afterUpdateNextTick=re.bind(this)}get ended(){return!!(this.stream._duplexState&b)}pipe(e,t){if(null!==this.pipeTo)throw new Error("Can only pipe to one destination");if("function"!=typeof t&&(t=null),this.stream._duplexState|=512,this.pipeTo=e,this.pipeline=new Q(this.stream,e,t),t&&this.stream.on("error",me),pe(e))e._writableState.pipeline=this.pipeline,t&&e.on("error",me),e.on("finish",this.pipeline.finished.bind(this.pipeline));else{const t=this.pipeline.done.bind(this.pipeline,e),r=this.pipeline.done.bind(this.pipeline,e,null);e.on("error",t),e.on("close",r),e.on("finish",this.pipeline.finished.bind(this.pipeline))}e.on("drain",J.bind(this)),this.stream.emit("piping",e),e.emit("pipe",this.stream)}push(e){const t=this.stream;return null===e?(this.highWaterMark=0,t._duplexState=134152127&t._duplexState|1024,!1):(null!==this.map&&(e=this.map(e)),this.buffered+=this.byteLength(e),this.queue.push(e),t._duplexState=134152191&t._duplexState|128,this.buffered<this.highWaterMark)}shift(){const e=this.queue.shift();return this.buffered-=this.byteLength(e),0===this.buffered&&(this.stream._duplexState&=134209407),e}unshift(e){const t=[null!==this.map?this.map(e):e];for(;this.buffered>0;)t.push(this.shift());for(let e=0;e<t.length-1;e++){const r=t[e];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(t[t.length-1])}read(){const e=this.stream;if((16527&e._duplexState)===h){const t=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=v),e._duplexState&m&&e.emit("data",t),t}return null}drain(){const e=this.stream;for(;(16527&e._duplexState)===h&&768&e._duplexState;){const t=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(t)&&(e._duplexState&=v),e._duplexState&m&&e.emit("data",t)}}update(){const e=this.stream;e._duplexState|=32;do{for(this.drain();this.buffered<this.highWaterMark&&!(82975&e._duplexState);)e._duplexState|=65552,e._read(this.afterRead),this.drain();4224==(12431&e._duplexState)&&(e._duplexState|=y,e.emit("readable")),80&e._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());e._duplexState&=S}updateNonPrimary(){const e=this.stream;(1167&e._duplexState)===g&&(e._duplexState=134216703&e._duplexState|16384,e.emit("end"),(e._duplexState&q)===j&&(e._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(e._duplexState&F)?1==(e._duplexState&$)&&(e._duplexState=(e._duplexState|D)&c,e._open(se.bind(this))):e._duplexState&K||(e._duplexState|=D,e._destroy(Z.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&w)&&(this.stream._duplexState&=_,!0)}updateCallback(){(32879&this.stream._duplexState)===u?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&w||(this.stream._duplexState|=w,32&this.stream._duplexState||i(this.afterUpdateNextTick))}}class Y{constructor(e){this.data=null,this.afterTransform=oe.bind(e),this.afterFinal=null}}class Q{constructor(e,t,r){this.from=e,this.to=t,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(e,t){t&&(this.error=t),e!==this.to||(this.to=null,null===this.from)?e!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):e._duplexState&b||this.to.destroy(this.error||new Error("Readable stream closed before ending")):this.from._duplexState&b&&this.pipeToFinished||this.from.destroy(this.error||new Error("Writable stream closed prematurely"))}}function J(){this.stream._duplexState|=512,this.updateCallback()}function X(e){const t=this.stream;e&&t.destroy(e),t._duplexState&F||(t._duplexState|=M,t.emit("finish")),(t._duplexState&q)===j&&(t._duplexState|=4),t._duplexState&=x,t._duplexState&k?this.updateNextTick():this.update()}function Z(e){const t=this.stream;e||this.error===s||(e=this.error),e&&t.emit("error",e),t._duplexState|=8,t.emit("close");const r=t._readableState,n=t._writableState;if(null!==r&&null!==r.pipeline&&r.pipeline.done(t,e),null!==n){for(;null!==n.drains&&n.drains.length>0;)n.drains.shift().resolve(!1);null!==n.pipeline&&n.pipeline.done(t,e)}}function ee(e){const t=this.stream;e&&t.destroy(e),t._duplexState&=x,null!==this.drains&&function(e){for(let t=0;t<e.length;t++)0==--e[t].writes&&(e.shift().resolve(!0),t--)}(this.drains),(3276815&t._duplexState)===A&&(t._duplexState&=132120575,(t._duplexState&P)===P&&t.emit("drain")),this.updateCallback()}function te(e){e&&this.stream.destroy(e),this.stream._duplexState&=C,this.updateCallback()}function re(){32&this.stream._duplexState||(this.stream._duplexState&=_,this.update())}function ne(){this.stream._duplexState&k||(this.stream._duplexState&=L,this.update())}function se(e){const t=this.stream;e&&t.destroy(e),4&t._duplexState||(17423&t._duplexState||(t._duplexState|=u),71303183&t._duplexState||(t._duplexState|=T),t.emit("open")),t._duplexState&=U,null!==t._writableState&&t._writableState.updateCallback(),null!==t._readableState&&t._readableState.updateCallback()}function oe(e,t){t!==undefined&&null!==t&&this.push(t),this._writableState.afterWrite(e)}class ie extends n{constructor(e){super(),this._duplexState=0,this._readableState=null,this._writableState=null,e&&(e.open&&(this._open=e.open),e.destroy&&(this._destroy=e.destroy),e.predestroy&&(this._predestroy=e.predestroy),e.signal&&e.signal.addEventListener("abort",fe.bind(this)))}_open(e){e(null)}_destroy(e){e(null)}_predestroy(){}get readable(){return null!==this._readableState||undefined}get writable(){return null!==this._writableState||undefined}get destroyed(){return!!(8&this._duplexState)}get destroying(){return!!(this._duplexState&F)}destroy(e){this._duplexState&F||(e||(e=s),this._duplexState=133693375&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=e),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=e),this._duplexState|=2,this._predestroy(),this._duplexState&=d,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}on(e,t){return null!==this._readableState&&("data"===e&&(this._duplexState|=2304,this._readableState.updateNextTick()),"readable"===e&&(this._duplexState|=f,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===e&&(this._duplexState|=P,this._writableState.updateNextTick()),super.on(e,t)}}class ae extends ie{constructor(e){super(e),this._duplexState|=4194305,this._readableState=new V(this,e),e&&(e.read&&(this._read=e.read),e.eagerOpen&&this._readableState.updateNextTick())}_read(e){e(null)}pipe(e,t){return this._readableState.updateNextTick(),this._readableState.pipe(e,t),e}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(e){return this._readableState.updateNextTick(),this._readableState.push(e)}unshift(e){return this._readableState.updateNextTick(),this._readableState.unshift(e)}resume(){return this._duplexState|=p,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=134217471,this}static _fromAsyncIterator(e,t){let r;const n=new ae({...t,read(t){e.next().then(s).then(t.bind(null,null)).catch(t)},predestroy(){r=e.return()},destroy(e){if(!r)return e(null);r.then(e.bind(null,null)).catch(e)}});return n;function s(e){e.done?n.push(null):n.push(e.value)}}static from(e,t){if(pe(r=e)&&r.readable)return e;var r;if(e[W])return this._fromAsyncIterator(e[W](),t);Array.isArray(e)||(e=e===undefined?[]:[e]);let n=0;return new ae({...t,read(t){this.push(n===e.length?null:e[n++]),t(null)}})}static isBackpressured(e){return!!(17422&e._duplexState)||e._readableState.buffered>=e._readableState.highWaterMark}static isPaused(e){return!(e._duplexState&p)}[W](){const e=this;let t=null,r=null,n=null;return this.on("error",(e=>{t=e})),this.on("readable",(function(){null!==r&&o(e.read())})),this.on("close",(function(){null!==r&&o(null)})),{[W](){return this},next:()=>new Promise((function(t,s){r=t,n=s;const i=e.read();null!==i?o(i):8&e._duplexState&&o(null)})),return:()=>i(null),throw:e=>i(e)};function o(o){null!==n&&(t?n(t):null!==o||e._duplexState&b?r({value:o,done:null===o}):n(s),n=r=null)}function i(t){return e.destroy(t),new Promise(((r,n)=>{if(8&e._duplexState)return r({value:undefined,done:!0});e.once("close",(function(){t?n(t):r({value:undefined,done:!0})}))}))}}}class le extends ae{constructor(e){super(e),this._duplexState=1,this._writableState=new z(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final))}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}}class ce extends le{constructor(e){super(e),this._transformState=new Y(this),e&&(e.transform&&(this._transform=e.transform),e.flush&&(this._flush=e.flush))}_write(e,t){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=e:this._transform(e,this._transformState.afterTransform)}_read(e){if(null!==this._transformState.data){const t=this._transformState.data;this._transformState.data=null,e(null),this._transform(t,this._transformState.afterTransform)}else e(null)}_transform(e,t){t(null,e)}_flush(e){e(null)}_final(e){this._transformState.afterFinal=e,this._flush(de.bind(this))}}function de(e,t){const r=this._transformState.afterFinal;if(e)return r(e);null!==t&&t!==undefined&&this.push(t),this.push(null),r(null)}function ue(e,...t){const r=Array.isArray(e)?[...e,...t]:[e,...t],n=r.length&&"function"==typeof r[r.length-1]?r.pop():null;if(r.length<2)throw new Error("Pipeline requires at least 2 streams");let s=r[0],i=null,a=null;for(let e=1;e<r.length;e++)i=r[e],pe(s)?s.pipe(i,c):(l(s,!0,e>1,c),s.pipe(i)),s=i;if(n){let e=!1;const t=pe(i)||!(!i._writableState||!i._writableState.autoDestroy);i.on("error",(e=>{null===a&&(a=e)})),i.on("finish",(()=>{e=!0,t||n(a)})),t&&i.on("close",(()=>n(a||(e?null:o))))}return i;function l(e,t,r,n){e.on("error",n),e.on("close",(function(){if(t&&e._readableState&&!e._readableState.ended)return n(o);if(r&&e._writableState&&!e._writableState.ended)return n(o)}))}function c(e){if(e&&!a){a=e;for(const t of r)t.destroy(e)}}}function he(e){return!!e._readableState||!!e._writableState}function pe(e){return"number"==typeof e._duplexState&&he(e)}function ge(e){return function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.byteLength}(e)?e.byteLength:1024}function me(){}function fe(){this.destroy(new Error("Stream aborted."))}t.exports={pipeline:ue,pipelinePromise:function(...e){return new Promise(((t,r)=>ue(...e,(e=>{if(e)return r(e);t()}))))},isStream:he,isStreamx:pe,getStreamError:function(e){const t=e._readableState&&e._readableState.error||e._writableState&&e._writableState.error;return t===s?null:t},Stream:ie,Writable:class extends ie{constructor(e){super(e),this._duplexState|=16385,this._writableState=new z(this,e),e&&(e.writev&&(this._writev=e.writev),e.write&&(this._write=e.write),e.final&&(this._final=e.final),e.eagerOpen&&this._writableState.updateNextTick())}_writev(e,t){t(null)}_write(e,t){this._writableState.autoBatch(e,t)}_final(e){e(null)}static isBackpressured(e){return!!(73400334&e._duplexState)}static drained(e){if(e.destroyed)return Promise.resolve(!1);const t=e._writableState,r=t.queue.length+(e._duplexState&I?1:0);return 0===r?Promise.resolve(!0):(null===t.drains&&(t.drains=[]),new Promise((e=>{t.drains.push({writes:r,resolve:e})})))}write(e){return this._writableState.updateNextTick(),this._writableState.push(e)}end(e){return this._writableState.updateNextTick(),this._writableState.end(e),this}},Readable:ae,Duplex:le,Transform:ce,PassThrough:class extends ce{}}}}},{package:"@metamask/snaps-controllers>tar-stream>streamx",file:"node_modules/streamx/index.js"}],[4194,{fs:2760},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){const n={S_IFMT:61440,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960};try{t.exports=e("fs").constants||n}catch{t.exports=n}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/tar-stream/constants.js"}],[4195,{"./headers":4196,b4a:2690,"fast-fifo":3127,streamx:4188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){const{Writable:n,Readable:s,getStreamError:o}=e("streamx"),i=e("fast-fifo"),a=e("b4a"),l=e("./headers"),c=a.alloc(0);class d{constructor(){this.buffered=0,this.shifted=0,this.queue=new i,this._offset=0}push(e){this.buffered+=e.byteLength,this.queue.push(e)}shiftFirst(e){return 0===this._buffered?null:this._next(e)}shift(e){if(e>this.buffered)return null;if(0===e)return c;let t=this._next(e);if(e===t.byteLength)return t;const r=[t];for(;(e-=t.byteLength)>0;)t=this._next(e),r.push(t);return a.concat(r)}_next(e){const t=this.queue.peek(),r=t.byteLength-this._offset;if(e>=r){const e=this._offset?t.subarray(this._offset,t.byteLength):t;return this.queue.shift(),this._offset=0,this.buffered-=r,this.shifted+=r,e}return this.buffered-=e,this.shifted+=e,t.subarray(this._offset,this._offset+=e)}}class u extends s{constructor(e,t,r){super(),this.header=t,this.offset=r,this._parent=e}_read(e){0===this.header.size&&this.push(null),this._parent._stream===this&&this._parent._update(),e(null)}_predestroy(){this._parent.destroy(o(this))}_detach(){this._parent._stream===this&&(this._parent._stream=null,this._parent._missing=g(this.header.size),this._parent._update())}_destroy(e){this._detach(),e(null)}}class h extends n{constructor(e){super(e),e||(e={}),this._buffer=new d,this._offset=0,this._header=null,this._stream=null,this._missing=0,this._longHeader=!1,this._callback=p,this._locked=!1,this._finished=!1,this._pax=null,this._paxGlobal=null,this._gnuLongPath=null,this._gnuLongLinkPath=null,this._filenameEncoding=e.filenameEncoding||"utf-8",this._allowUnknownFormat=!!e.allowUnknownFormat,this._unlockBound=this._unlock.bind(this)}_unlock(e){if(this._locked=!1,e)return this.destroy(e),void this._continueWrite(e);this._update()}_consumeHeader(){if(this._locked)return!1;this._offset=this._buffer.shifted;try{this._header=l.decode(this._buffer.shift(512),this._filenameEncoding,this._allowUnknownFormat)}catch(e){return this._continueWrite(e),!1}if(!this._header)return!0;switch(this._header.type){case"gnu-long-path":case"gnu-long-link-path":case"pax-global-header":case"pax-header":return this._longHeader=!0,this._missing=this._header.size,!0}return this._locked=!0,this._applyLongHeaders(),0===this._header.size||"directory"===this._header.type?(this.emit("entry",this._header,this._createStream(),this._unlockBound),!0):(this._stream=this._createStream(),this._missing=this._header.size,this.emit("entry",this._header,this._stream,this._unlockBound),!0)}_applyLongHeaders(){this._gnuLongPath&&(this._header.name=this._gnuLongPath,this._gnuLongPath=null),this._gnuLongLinkPath&&(this._header.linkname=this._gnuLongLinkPath,this._gnuLongLinkPath=null),this._pax&&(this._pax.path&&(this._header.name=this._pax.path),this._pax.linkpath&&(this._header.linkname=this._pax.linkpath),this._pax.size&&(this._header.size=parseInt(this._pax.size,10)),this._header.pax=this._pax,this._pax=null)}_decodeLongHeader(e){switch(this._header.type){case"gnu-long-path":this._gnuLongPath=l.decodeLongPath(e,this._filenameEncoding);break;case"gnu-long-link-path":this._gnuLongLinkPath=l.decodeLongPath(e,this._filenameEncoding);break;case"pax-global-header":this._paxGlobal=l.decodePax(e);break;case"pax-header":this._pax=null===this._paxGlobal?l.decodePax(e):Object.assign({},this._paxGlobal,l.decodePax(e))}}_consumeLongHeader(){this._longHeader=!1,this._missing=g(this._header.size);const e=this._buffer.shift(this._header.size);try{this._decodeLongHeader(e)}catch(e){return this._continueWrite(e),!1}return!0}_consumeStream(){const e=this._buffer.shiftFirst(this._missing);if(null===e)return!1;this._missing-=e.byteLength;const t=this._stream.push(e);return 0===this._missing?(this._stream.push(null),t&&this._stream._detach(),t&&!1===this._locked):t}_createStream(){return new u(this,this._header,this._offset)}_update(){for(;this._buffer.buffered>0&&!this.destroying;)if(this._missing>0){if(null!==this._stream){if(!1===this._consumeStream())return;continue}if(!0===this._longHeader){if(this._missing>this._buffer.buffered)break;if(!1===this._consumeLongHeader())return!1;continue}const e=this._buffer.shiftFirst(this._missing);null!==e&&(this._missing-=e.byteLength)}else{if(this._buffer.buffered<512)break;if(null!==this._stream||!1===this._consumeHeader())return}this._continueWrite(null)}_continueWrite(e){const t=this._callback;this._callback=p,t(e)}_write(e,t){this._callback=t,this._buffer.push(e),this._update()}_final(e){this._finished=0===this._missing&&0===this._buffer.buffered,e(this._finished?null:new Error("Unexpected end of data"))}_predestroy(){this._continueWrite(null)}_destroy(e){this._stream&&this._stream.destroy(o(this)),e(null)}[Symbol.asyncIterator](){let e=null,t=null,r=null,n=null,s=null;const o=this;return this.on("entry",(function(e,o,i){s=i,o.on("error",p),t?(t({value:o,done:!1}),t=r=null):n=o})),this.on("error",(t=>{e=t})),this.on("close",(function(){if(i(e),!t)return;e?r(e):t({value:undefined,done:!0});t=r=null})),{[Symbol.asyncIterator](){return this},next:()=>new Promise(a),return:()=>l(null),throw:e=>l(e)};function i(e){if(!s)return;const t=s;s=null,t(e)}function a(s,a){return e?a(e):n?(s({value:n,done:!1}),void(n=null)):(t=s,r=a,i(null),void(o._finished&&t&&(t({value:undefined,done:!0}),t=r=null)))}function l(e){return o.destroy(e),i(e),new Promise(((t,r)=>{if(o.destroyed)return t({value:undefined,done:!0});o.once("close",(function(){e?r(e):t({value:undefined,done:!0})}))}))}}}function p(){}function g(e){return(e&=511)&&512-e}t.exports=function(e){return new h(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/tar-stream/extract.js"}],[4196,{b4a:2690},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){const n=e("b4a"),s="0000000000000000000",o="7777777777777777777",i="0".charCodeAt(0),a=n.from([117,115,116,97,114,0]),l=n.from([i,i]),c=n.from([117,115,116,97,114,32]),d=n.from([32,0]),u=257,h=263;function p(e,t,r,n){for(;r<n;r++)if(e[r]===t)return r;return n}function g(e){let t=256;for(let r=0;r<148;r++)t+=e[r];for(let r=156;r<512;r++)t+=e[r];return t}function m(e,t){return(e=e.toString(8)).length>t?o.slice(0,t)+" ":s.slice(0,t-e.length)+e+" "}function f(e,t,r){if(128&(e=e.subarray(t,t+r))[t=0])return function(e){let t;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}const r=[];let n;for(n=e.length-1;n>0;n--){const s=e[n];t?r.push(s):r.push(255-s)}let s=0;const o=r.length;for(n=0;n<o;n++)s+=r[n]*Math.pow(256,n);return t?s:-1*s}(e);{for(;t<e.length&&32===e[t];)t++;const r=(s=p(e,32,t,e.length),o=e.length,i=e.length,"number"!=typeof s?i:(s=~~s)>=o?o:s>=0||(s+=o)>=0?s:0);for(;t<r&&0===e[t];)t++;return r===t?0:parseInt(n.toString(e.subarray(t,r)),8)}var s,o,i}function y(e,t,r,s){return n.toString(e.subarray(t,p(e,0,t,t+r)),s)}function b(e){const t=n.byteLength(e);let r=Math.floor(Math.log(t)/Math.log(10))+1;return t+r>=Math.pow(10,r)&&r++,t+r+e}r.decodeLongPath=function(e,t){return y(e,0,e.length,t)},r.encodePax=function(e){let t="";e.name&&(t+=b(" path="+e.name+"\n")),e.linkname&&(t+=b(" linkpath="+e.linkname+"\n"));const r=e.pax;if(r)for(const e in r)t+=b(" "+e+"="+r[e]+"\n");return n.from(t)},r.decodePax=function(e){const t={};for(;e.length;){let r=0;for(;r<e.length&&32!==e[r];)r++;const s=parseInt(n.toString(e.subarray(0,r)),10);if(!s)return t;const o=n.toString(e.subarray(r+1,s-1)),i=o.indexOf("=");if(-1===i)return t;t[o.slice(0,i)]=o.slice(i+1),e=e.subarray(s)}return t},r.encode=function(e){const t=n.alloc(512);let r=e.name,s="";if(5===e.typeflag&&"/"!==r[r.length-1]&&(r+="/"),n.byteLength(r)!==r.length)return null;for(;n.byteLength(r)>100;){const e=r.indexOf("/");if(-1===e)return null;s+=s?"/"+r.slice(0,e):r.slice(0,e),r=r.slice(e+1)}return n.byteLength(r)>100||n.byteLength(s)>155||e.linkname&&n.byteLength(e.linkname)>100?null:(n.write(t,r),n.write(t,m(4095&e.mode,6),100),n.write(t,m(e.uid,6),108),n.write(t,m(e.gid,6),116),function(e,t,r){e.toString(8).length>11?function(e,t,r){t[r]=128;for(let n=11;n>0;n--)t[r+n]=255&e,e=Math.floor(e/256)}(e,t,r):n.write(t,m(e,11),r)}(e.size,t,124),n.write(t,m(e.mtime.getTime()/1e3|0,11),136),t[156]=i+function(e){switch(e){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}return 0}(e.type),e.linkname&&n.write(t,e.linkname,157),n.copy(a,t,u),n.copy(l,t,263),e.uname&&n.write(t,e.uname,265),e.gname&&n.write(t,e.gname,297),n.write(t,m(e.devmajor||0,6),329),n.write(t,m(e.devminor||0,6),337),s&&n.write(t,s,345),n.write(t,m(g(t),6),148),t)},r.decode=function(e,t,r){let s=0===e[156]?0:e[156]-i,o=y(e,0,100,t);const l=f(e,100,8),p=f(e,108,8),m=f(e,116,8),b=f(e,124,12),w=f(e,136,12),C=function(e){switch(e){case 0:return"file";case 1:return"link";case 2:return"symlink";case 3:return"character-device";case 4:return"block-device";case 5:return"directory";case 6:return"fifo";case 7:return"contiguous-file";case 72:return"pax-header";case 55:return"pax-global-header";case 27:return"gnu-long-link-path";case 28:case 30:return"gnu-long-path"}return null}(s),v=0===e[157]?null:y(e,157,100,t),_=y(e,265,32),S=y(e,297,32),k=f(e,329,8),T=f(e,337,8),E=g(e);if(256===E)return null;if(E!==f(e,148,8))throw new Error("Invalid tar header. Maybe the tar is corrupted or it needs to be gunzipped?");if(function(e){return n.equals(a,e.subarray(u,263))}(e))e[345]&&(o=y(e,345,155,t)+"/"+o);else if(function(e){return n.equals(c,e.subarray(u,263))&&n.equals(d,e.subarray(h,265))}(e));else if(!r)throw new Error("Invalid tar header: unknown format.");return 0===s&&o&&"/"===o[o.length-1]&&(s=5),{name:o,mode:l,uid:p,gid:m,size:b,mtime:new Date(1e3*w),type:C,linkname:v,uname:_,gname:S,devmajor:k,devminor:T,pax:null}}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/tar-stream/headers.js"}],[4197,{"./extract":4195,"./pack":4198},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){r.extract=e("./extract"),r.pack=e("./pack")}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/tar-stream/index.js"}],[4198,{"./constants":4194,"./headers":4196,b4a:2690,streamx:4188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){const{Readable:n,Writable:s,getStreamError:o}=e("streamx"),i=e("b4a"),a=e("./constants"),l=e("./headers"),c=i.alloc(1024);class d extends s{constructor(e,t,r){super({mapWritable:g,eagerOpen:!0}),this.written=0,this.header=t,this._callback=r,this._linkname=null,this._isLinkname="symlink"===t.type&&!t.linkname,this._isVoid="file"!==t.type&&"contiguous-file"!==t.type,this._finished=!1,this._pack=e,this._openCallback=null,null===this._pack._stream?this._pack._stream=this:this._pack._pending.push(this)}_open(e){this._openCallback=e,this._pack._stream===this&&this._continueOpen()}_continuePack(e){if(null===this._callback)return;const t=this._callback;this._callback=null,t(e)}_continueOpen(){null===this._pack._stream&&(this._pack._stream=this);const e=this._openCallback;if(this._openCallback=null,null!==e){if(this._pack.destroying)return e(new Error("pack stream destroyed"));if(this._pack._finalized)return e(new Error("pack stream is already finalized"));this._pack._stream=this,this._isLinkname||this._pack._encode(this.header),this._isVoid&&(this._finish(),this._continuePack(null)),e(null)}}_write(e,t){return this._isLinkname?(this._linkname=this._linkname?i.concat([this._linkname,e]):e,t(null)):this._isVoid?e.byteLength>0?t(new Error("No body allowed for this entry")):t():(this.written+=e.byteLength,this._pack.push(e)?t():void(this._pack._drain=t))}_finish(){this._finished||(this._finished=!0,this._isLinkname&&(this.header.linkname=this._linkname?i.toString(this._linkname,"utf-8"):"",this._pack._encode(this.header)),p(this._pack,this.header.size),this._pack._done(this))}_final(e){if(this.written!==this.header.size)return e(new Error("Size mismatch"));this._finish(),e(null)}_getError(){return o(this)||new Error("tar entry destroyed")}_predestroy(){this._pack.destroy(this._getError())}_destroy(e){this._pack._done(this),this._continuePack(this._finished?null:this._getError()),e()}}class u extends n{constructor(e){super(e),this._drain=h,this._finalized=!1,this._finalizing=!1,this._pending=[],this._stream=null}entry(e,t,r){if(this._finalized||this.destroying)throw new Error("already finalized or destroyed");"function"==typeof t&&(r=t,t=null),r||(r=h),e.size&&"symlink"!==e.type||(e.size=0),e.type||(e.type=function(e){switch(e&a.S_IFMT){case a.S_IFBLK:return"block-device";case a.S_IFCHR:return"character-device";case a.S_IFDIR:return"directory";case a.S_IFIFO:return"fifo";case a.S_IFLNK:return"symlink"}return"file"}(e.mode)),e.mode||(e.mode="directory"===e.type?493:420),e.uid||(e.uid=0),e.gid||(e.gid=0),e.mtime||(e.mtime=new Date),"string"==typeof t&&(t=i.from(t));const n=new d(this,e,r);return i.isBuffer(t)?(e.size=t.byteLength,n.write(t),n.end(),n):(n._isVoid,n)}finalize(){this._stream||this._pending.length>0?this._finalizing=!0:this._finalized||(this._finalized=!0,this.push(c),this.push(null))}_done(e){e===this._stream&&(this._stream=null,this._finalizing&&this.finalize(),this._pending.length&&this._pending.shift()._continueOpen())}_encode(e){if(!e.pax){const t=l.encode(e);if(t)return void this.push(t)}this._encodePax(e)}_encodePax(e){const t=l.encodePax({name:e.name,linkname:e.linkname,pax:e.pax}),r={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.byteLength,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(l.encode(r)),this.push(t),p(this,t.byteLength),r.size=e.size,r.type=e.type,this.push(l.encode(r))}_doDrain(){const e=this._drain;this._drain=h,e()}_predestroy(){const e=o(this);for(this._stream&&this._stream.destroy(e);this._pending.length;){const t=this._pending.shift();t.destroy(e),t._continueOpen()}this._doDrain()}_read(e){this._doDrain(),e()}}function h(){}function p(e,t){(t&=511)&&e.push(c.subarray(0,512-t))}function g(e){return i.isBuffer(e)?e:i.from(e)}t.exports=function(e){return new u(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/tar-stream/pack.js"}],[4199,{_process:3789,stream:4154},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("stream");function s(e,t,s){e=e||function(e){this.queue(e)},t=t||function(){this.queue(null)};var o=!1,i=!1,a=[],l=!1,c=new n;function d(){for(;a.length&&!c.paused;){var e=a.shift();if(null===e)return c.emit("end");c.emit("data",e)}}return c.readable=c.writable=!0,c.paused=!1,c.autoDestroy=!(s&&!1===s.autoDestroy),c.write=function(t){return e.call(this,t),!c.paused},c.queue=c.push=function(e){return l||(null===e&&(l=!0),a.push(e),d()),c},c.on("end",(function(){c.readable=!1,!c.writable&&c.autoDestroy&&r.nextTick((function(){c.destroy()}))})),c.end=function(e){if(!o)return o=!0,arguments.length&&c.write(e),c.writable=!1,t.call(c),!c.readable&&c.autoDestroy&&c.destroy(),c},c.destroy=function(){if(!i)return i=!0,o=!0,a.length=0,c.writable=c.readable=!1,c.emit("close"),c},c.pause=function(){if(!c.paused)return c.paused=!0,c},c.resume=function(){return c.paused&&(c.paused=!1,c.emit("resume")),d(),c.paused||c.emit("drain"),c},c}t.exports=s,s.through=s}).call(this)}).call(this,e("_process"))}}},{package:"debounce-stream>through",file:"node_modules/through/index.js"}],[42,{"eth-rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors");r.default=(e,t)=>async r=>{if(t._writableState.ended)return;if(!e[r.method])return void t.write({jsonrpc:"2.0",error:n.ethErrors.rpc.methodNotFound({message:`${r.method} not found`}),id:r.id});let s,o;try{s=await e[r.method](...r.params)}catch(e){o=e}t._writableState.ended?o&&console.error(o):o?t.write({jsonrpc:"2.0",error:(0,n.serializeError)(o,{shouldIncludeStack:!0}),id:r.id}):t.write({jsonrpc:"2.0",result:s,id:r.id})}}}},{package:"$root$",file:"app/scripts/lib/createMetaRPCHandler.js"}],[4203,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e){if(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray)return new DataView(e.buffer,e.byteOffset,e.byteLength);if(e instanceof ArrayBuffer)return new DataView(e);throw new TypeError("Expected `data` to be an ArrayBuffer, Buffer, Int8Array, Uint8Array or Uint8ClampedArray")}}}},{package:"base32-encode>to-data-view",file:"node_modules/to-data-view/index.js"}],[4216,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n,s,o,i=void 0,a=(n=Object.prototype.toString,s=Object.prototype.hasOwnProperty,{Class:function(e){return n.call(e).replace(/^\[object *|\]$/g,"")},HasProperty:function(e,t){return t in e},HasOwnProperty:function(e,t){return s.call(e,t)},IsCallable:function(e){return"function"==typeof e},ToInt32:function(e){return 0|e},ToUint32:function(e){return e>>>0}}),l=Math.LN2,c=Math.abs,d=Math.floor,u=Math.log,h=Math.min,p=Math.pow,g=Math.round;function m(e){if(f&&o){var t,r=f(e);for(t=0;t<r.length;t+=1)o(e,r[t],{value:e[r[t]],writable:!1,enumerable:!1,configurable:!1})}}o=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()?Object.defineProperty:function(e,t,r){if(!e===Object(e))throw new TypeError("Object.defineProperty called on non-object");return a.HasProperty(r,"get")&&Object.prototype.__defineGetter__&&Object.prototype.__defineGetter__.call(e,t,r.get),a.HasProperty(r,"set")&&Object.prototype.__defineSetter__&&Object.prototype.__defineSetter__.call(e,t,r.set),a.HasProperty(r,"value")&&(e[t]=r.value),e};var f=Object.getOwnPropertyNames||function(e){if(e!==Object(e))throw new TypeError("Object.getOwnPropertyNames called on non-object");var t,r=[];for(t in e)a.HasOwnProperty(e,t)&&r.push(t);return r};function y(e,t){var r=32-t;return e<<r>>r}function b(e,t){var r=32-t;return e<<r>>>r}function w(e){return[255&e]}function C(e){return y(e[0],8)}function v(e){return[255&e]}function _(e){return b(e[0],8)}function S(e){return[(e=g(Number(e)))<0?0:e>255?255:255&e]}function k(e){return[e>>8&255,255&e]}function T(e){return y(e[0]<<8|e[1],16)}function E(e){return[e>>8&255,255&e]}function A(e){return b(e[0]<<8|e[1],16)}function M(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function P(e){return y(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function N(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]}function I(e){return b(e[0]<<24|e[1]<<16|e[2]<<8|e[3],32)}function R(e,t,r){var n,s,o,i,a,g,m,f=(1<<t-1)-1;function y(e){var t=d(e),r=e-t;return r<.5?t:r>.5||t%2?t+1:t}for(e!=e?(s=(1<<t)-1,o=p(2,r-1),n=0):e===Infinity||e===-Infinity?(s=(1<<t)-1,o=0,n=e<0?1:0):0===e?(s=0,o=0,n=1/e==-Infinity?1:0):(n=e<0,(e=c(e))>=p(2,1-f)?(s=h(d(u(e)/l),1023),(o=y(e/p(2,s)*p(2,r)))/p(2,r)>=2&&(s+=1,o=1),s>f?(s=(1<<t)-1,o=0):(s+=f,o-=p(2,r))):(s=0,o=y(e/p(2,1-f-r)))),a=[],i=r;i;i-=1)a.push(o%2?1:0),o=d(o/2);for(i=t;i;i-=1)a.push(s%2?1:0),s=d(s/2);for(a.push(n?1:0),a.reverse(),g=a.join(""),m=[];g.length;)m.push(parseInt(g.substring(0,8),2)),g=g.substring(8);return m}function x(e,t,r){var n,s,o,i,a,l,c,d,u=[];for(n=e.length;n;n-=1)for(o=e[n-1],s=8;s;s-=1)u.push(o%2?1:0),o>>=1;return u.reverse(),i=u.join(""),a=(1<<t-1)-1,l=parseInt(i.substring(0,1),2)?-1:1,c=parseInt(i.substring(1,1+t),2),d=parseInt(i.substring(1+t),2),c===(1<<t)-1?0!==d?NaN:l*Infinity:c>0?l*p(2,c-a)*(1+d/p(2,r)):0!==d?l*p(2,-(a-1))*(d/p(2,r)):l<0?-0:0}function O(e){return x(e,11,52)}function L(e){return R(e,11,52)}function D(e){return x(e,8,23)}function U(e){return R(e,8,23)}!function(){var e=function(e){if((e=a.ToInt32(e))<0)throw new RangeError("ArrayBuffer size is not a small enough positive integer");var t;for(this.byteLength=e,this._bytes=[],this._bytes.length=e,t=0;t<this.byteLength;t+=1)this._bytes[t]=0;m(this)};r.ArrayBuffer=r.ArrayBuffer||e;var t=function(){};function n(r,n,s){var l;return l=function(t,r,n){var s,i,c,d;if(arguments.length&&"number"!=typeof arguments[0])if("object"==typeof arguments[0]&&arguments[0].constructor===l)for(s=arguments[0],this.length=s.length,this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new e(this.byteLength),this.byteOffset=0,c=0;c<this.length;c+=1)this._setter(c,s._getter(c));else if("object"!=typeof arguments[0]||(arguments[0]instanceof e||"ArrayBuffer"===a.Class(arguments[0]))){if("object"!=typeof arguments[0]||!(arguments[0]instanceof e||"ArrayBuffer"===a.Class(arguments[0])))throw new TypeError("Unexpected argument type(s)");if(this.buffer=t,this.byteOffset=a.ToUint32(r),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(this.byteOffset%this.BYTES_PER_ELEMENT)throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.");if(arguments.length<3){if(this.byteLength=this.buffer.byteLength-this.byteOffset,this.byteLength%this.BYTES_PER_ELEMENT)throw new RangeError("length of buffer minus byteOffset not a multiple of the element size");this.length=this.byteLength/this.BYTES_PER_ELEMENT}else this.length=a.ToUint32(n),this.byteLength=this.length*this.BYTES_PER_ELEMENT;if(this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer")}else for(i=arguments[0],this.length=a.ToUint32(i.length),this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new e(this.byteLength),this.byteOffset=0,c=0;c<this.length;c+=1)d=i[c],this._setter(c,Number(d));else{if(this.length=a.ToInt32(arguments[0]),n<0)throw new RangeError("ArrayBufferView size is not a small enough positive integer");this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new e(this.byteLength),this.byteOffset=0}this.constructor=l,m(this),function(e){if(o){if(e.length>1e5)throw new RangeError("Array too large for polyfill");var t;for(t=0;t<e.length;t+=1)r(t)}function r(t){o(e,t,{get:function(){return e._getter(t)},set:function(r){e._setter(t,r)},enumerable:!0,configurable:!1})}}(this)},l.prototype=new t,l.prototype.BYTES_PER_ELEMENT=r,l.prototype._pack=n,l.prototype._unpack=s,l.BYTES_PER_ELEMENT=r,l.prototype._getter=function(e){if(arguments.length<1)throw new SyntaxError("Not enough arguments");if((e=a.ToUint32(e))>=this.length)return i;var t,r,n=[];for(t=0,r=this.byteOffset+e*this.BYTES_PER_ELEMENT;t<this.BYTES_PER_ELEMENT;t+=1,r+=1)n.push(this.buffer._bytes[r]);return this._unpack(n)},l.prototype.get=l.prototype._getter,l.prototype._setter=function(e,t){if(arguments.length<2)throw new SyntaxError("Not enough arguments");if((e=a.ToUint32(e))>=this.length)return i;var r,n,s=this._pack(t);for(r=0,n=this.byteOffset+e*this.BYTES_PER_ELEMENT;r<this.BYTES_PER_ELEMENT;r+=1,n+=1)this.buffer._bytes[n]=s[r]},l.prototype.set=function(e,t){if(arguments.length<1)throw new SyntaxError("Not enough arguments");var r,n,s,o,i,l,c,d,u,h;if("object"==typeof arguments[0]&&arguments[0].constructor===this.constructor){if(r=arguments[0],(s=a.ToUint32(arguments[1]))+r.length>this.length)throw new RangeError("Offset plus length of array is out of range");if(d=this.byteOffset+s*this.BYTES_PER_ELEMENT,u=r.length*this.BYTES_PER_ELEMENT,r.buffer===this.buffer){for(h=[],i=0,l=r.byteOffset;i<u;i+=1,l+=1)h[i]=r.buffer._bytes[l];for(i=0,c=d;i<u;i+=1,c+=1)this.buffer._bytes[c]=h[i]}else for(i=0,l=r.byteOffset,c=d;i<u;i+=1,l+=1,c+=1)this.buffer._bytes[c]=r.buffer._bytes[l]}else{if("object"!=typeof arguments[0]||void 0===arguments[0].length)throw new TypeError("Unexpected argument type(s)");if(n=arguments[0],o=a.ToUint32(n.length),(s=a.ToUint32(arguments[1]))+o>this.length)throw new RangeError("Offset plus length of array is out of range");for(i=0;i<o;i+=1)l=n[i],this._setter(s+i,Number(l))}},l.prototype.subarray=function(e,t){function r(e,t,r){return e<t?t:e>r?r:e}e=a.ToInt32(e),t=a.ToInt32(t),arguments.length<1&&(e=0),arguments.length<2&&(t=this.length),e<0&&(e=this.length+e),t<0&&(t=this.length+t),e=r(e,0,this.length);var n=(t=r(t,0,this.length))-e;return n<0&&(n=0),new this.constructor(this.buffer,this.byteOffset+e*this.BYTES_PER_ELEMENT,n)},l}var s=n(1,w,C),l=n(1,v,_),c=n(1,S,_),d=n(2,k,T),u=n(2,E,A),h=n(4,M,P),p=n(4,N,I),g=n(4,U,D),f=n(8,L,O);r.Int8Array=r.Int8Array||s,r.Uint8Array=r.Uint8Array||l,r.Uint8ClampedArray=r.Uint8ClampedArray||c,r.Int16Array=r.Int16Array||d,r.Uint16Array=r.Uint16Array||u,r.Int32Array=r.Int32Array||h,r.Uint32Array=r.Uint32Array||p,r.Float32Array=r.Float32Array||g,r.Float64Array=r.Float64Array||f}(),function(){function e(e,t){return a.IsCallable(e.get)?e.get(t):e[t]}var t,n=(t=new r.Uint16Array([4660]),18===e(new r.Uint8Array(t.buffer),0)),s=function(e,t,n){if(0===arguments.length)e=new r.ArrayBuffer(0);else if(!(e instanceof r.ArrayBuffer||"ArrayBuffer"===a.Class(e)))throw new TypeError("TypeError");if(this.buffer=e||new r.ArrayBuffer(0),this.byteOffset=a.ToUint32(t),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(this.byteLength=arguments.length<3?this.buffer.byteLength-this.byteOffset:a.ToUint32(n),this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer");m(this)};function o(t){return function(s,o){if((s=a.ToUint32(s))+t.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");s+=this.byteOffset;var i,l=new r.Uint8Array(this.buffer,s,t.BYTES_PER_ELEMENT),c=[];for(i=0;i<t.BYTES_PER_ELEMENT;i+=1)c.push(e(l,i));return Boolean(o)===Boolean(n)&&c.reverse(),e(new t(new r.Uint8Array(c).buffer),0)}}function i(t){return function(s,o,i){if((s=a.ToUint32(s))+t.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");var l,c=new t([o]),d=new r.Uint8Array(c.buffer),u=[];for(l=0;l<t.BYTES_PER_ELEMENT;l+=1)u.push(e(d,l));Boolean(i)===Boolean(n)&&u.reverse(),new r.Uint8Array(this.buffer,s,t.BYTES_PER_ELEMENT).set(u)}}s.prototype.getUint8=o(r.Uint8Array),s.prototype.getInt8=o(r.Int8Array),s.prototype.getUint16=o(r.Uint16Array),s.prototype.getInt16=o(r.Int16Array),s.prototype.getUint32=o(r.Uint32Array),s.prototype.getInt32=o(r.Int32Array),s.prototype.getFloat32=o(r.Float32Array),s.prototype.getFloat64=o(r.Float64Array),s.prototype.setUint8=i(r.Uint8Array),s.prototype.setInt8=i(r.Int8Array),s.prototype.setUint16=i(r.Uint16Array),s.prototype.setInt16=i(r.Int16Array),s.prototype.setUint32=i(r.Uint32Array),s.prototype.setInt32=i(r.Int32Array),s.prototype.setFloat32=i(r.Float32Array),s.prototype.setFloat64=i(r.Float64Array),r.DataView=r.DataView||s}()}}},{package:"browserify>concat-stream>typedarray",file:"node_modules/typedarray/index.js"}],[4218,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const r=new Uint8Array(t);let n=0;for(const t of e)r.set(t,n),n+=t.length;return r}}}},{package:"@ensdomains/content-hash>cids>uint8arrays",file:"node_modules/uint8arrays/concat.js"}],[4219,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.byteLength;r++)if(e[r]!==t[r])return!1;return!0}}}},{package:"@ensdomains/content-hash>cids>uint8arrays",file:"node_modules/uint8arrays/equals.js"}],[4220,{multibase:3688},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){const{encoding:n}=e("multibase"),s=new TextEncoder;t.exports=function(e,t="utf8"){return"utf8"===t||"utf-8"===t?s.encode(e):"ascii"===t?function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(e):n(t).decode(e)}}}},{package:"@ensdomains/content-hash>cids>uint8arrays",file:"node_modules/uint8arrays/from-string.js"}],[4221,{multibase:3688},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){const{encoding:n}=e("multibase"),s=new TextDecoder("utf8");t.exports=function(e,t="utf8"){return"utf8"===t||"utf-8"===t?s.decode(e):"ascii"===t?function(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}(e):n(t).encode(e)}}}},{package:"@ensdomains/content-hash>cids>uint8arrays",file:"node_modules/uint8arrays/to-string.js"}],[4254,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){!function(e){var t,r,n,s=String.fromCharCode;function o(e){for(var t,r,n=[],s=0,o=e.length;s<o;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<o?56320==(64512&(r=e.charCodeAt(s++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),s--):n.push(t);return n}function i(e){if(e>=55296&&e<=57343)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value")}function a(e,t){return s(e>>t&63|128)}function l(e){if(!(4294967168&e))return s(e);var t="";return 4294965248&e?4294901760&e?4292870144&e||(t=s(e>>18&7|240),t+=a(e,12),t+=a(e,6)):(i(e),t=s(e>>12&15|224),t+=a(e,6)):t=s(e>>6&31|192),t+=s(63&e|128)}function c(){if(n>=r)throw Error("Invalid byte index");var e=255&t[n];if(n++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function d(){var e,s;if(n>r)throw Error("Invalid byte index");if(n==r)return!1;if(e=255&t[n],n++,!(128&e))return e;if(192==(224&e)){if((s=(31&e)<<6|c())>=128)return s;throw Error("Invalid continuation byte")}if(224==(240&e)){if((s=(15&e)<<12|c()<<6|c())>=2048)return i(s),s;throw Error("Invalid continuation byte")}if(240==(248&e)&&(s=(7&e)<<18|c()<<12|c()<<6|c())>=65536&&s<=1114111)return s;throw Error("Invalid UTF-8 detected")}e.version="3.0.0",e.encode=function(e){for(var t=o(e),r=t.length,n=-1,s="";++n<r;)s+=l(t[n]);return s},e.decode=function(e){t=o(e),r=t.length,n=0;for(var i,a=[];!1!==(i=d());)a.push(i);return function(e){for(var t,r=e.length,n=-1,o="";++n<r;)(t=e[n])>65535&&(o+=s((t-=65536)>>>10&1023|55296),t=56320|1023&t),o+=s(t);return o}(a)}}(void 0===r?this.utf8={}:r)}}},{package:"@metamask/keyring-controller>ethereumjs-wallet>utf8",file:"node_modules/utf8/utf8.js"}],[4278,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function e(t,r){var o,i=0,a=0,l=r=r||0,c=t.length;do{if(l>=c||a>49)throw e.bytes=0,new RangeError("Could not decode varint");o=t[l++],i+=a<28?(o&s)<<a:(o&s)*Math.pow(2,a),a+=7}while(o>=n);return e.bytes=l-r,i};var n=128,s=127}}},{package:"sass-embedded>varint",file:"node_modules/varint/decode.js"}],[4279,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=function e(t,r,i){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");r=r||[];var a=i=i||0;for(;t>=o;)r[i++]=255&t|n,t/=128;for(;t&s;)r[i++]=255&t|n,t>>>=7;return r[i]=0|t,e.bytes=i-a+1,r};var n=128,s=-128,o=Math.pow(2,31)}}},{package:"sass-embedded>varint",file:"node_modules/varint/encode.js"}],[4280,{"./decode.js":4278,"./encode.js":4279,"./length.js":4281},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports={encode:e("./encode.js"),decode:e("./decode.js"),encodingLength:e("./length.js")}}}},{package:"sass-embedded>varint",file:"node_modules/varint/index.js"}],[4281,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=Math.pow(2,7),s=Math.pow(2,14),o=Math.pow(2,21),i=Math.pow(2,28),a=Math.pow(2,35),l=Math.pow(2,42),c=Math.pow(2,49),d=Math.pow(2,56),u=Math.pow(2,63);t.exports=function(e){return e<n?1:e<s?2:e<o?3:e<i?4:e<a?5:e<l?6:e<c?7:e<d?8:e<u?9:10}}}},{package:"sass-embedded>varint",file:"node_modules/varint/length.js"}],[4289,{util:4258},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){r.TextEncoder="undefined"!=typeof TextEncoder?TextEncoder:e("util").TextEncoder,r.TextDecoder="undefined"!=typeof TextDecoder?TextDecoder:e("util").TextDecoder}}},{package:"@ensdomains/content-hash>multihashes>web-encoding",file:"node_modules/web-encoding/src/lib.js"}],[43,{"./middleware/pending":61,"@metamask/eth-json-rpc-middleware":1169,"json-rpc-engine":3457},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({version:e,getAccounts:t,processTransaction:r,processEthSignMessage:i,processTypedMessage:a,processTypedMessageV3:l,processTypedMessageV4:c,processPersonalMessage:d,processDecryptMessage:u,processEncryptionPublicKey:h,getPendingNonce:p,getPendingTransactionByHash:g}){return(0,n.mergeMiddleware)([(0,n.createScaffoldMiddleware)({eth_syncing:!1,web3_clientVersion:`MetaMask/v${e}`}),(0,s.createWalletMiddleware)({getAccounts:t,processTransaction:r,processEthSignMessage:i,processTypedMessage:a,processTypedMessageV3:l,processTypedMessageV4:c,processPersonalMessage:d,processDecryptMessage:u,processEncryptionPublicKey:h}),(0,o.createPendingNonceMiddleware)({getPendingNonce:p}),(0,o.createPendingTxMiddleware)({getPendingTransactionByHash:g})])};var n=e("json-rpc-engine"),s=e("@metamask/eth-json-rpc-middleware"),o=e("./middleware/pending")}}},{package:"$root$",file:"app/scripts/lib/createMetamaskMiddleware.js"}],[4341,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM=r.AUTO_LOCK_TIMEOUT_ALARM=void 0;r.AUTO_LOCK_TIMEOUT_ALARM="AUTO_LOCK_TIMEOUT_ALARM",r.METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM="METAMETRICS_FINALIZE_EVENT_FRAGMENT_ALARM"}}},{package:"$root$",file:"shared/constants/alarms.js"}],[4352,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LOG_EVENT=void 0;r.LOG_EVENT={VERSION_UPDATE:"Extension version update"}}}},{package:"$root$",file:"shared/constants/logs.ts"}],[4354,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.methodsWithConfirmation=r.methodsRequiringNetworkSwitch=void 0;const n=r.methodsRequiringNetworkSwitch=["eth_sendTransaction","eth_sendRawTransaction","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_watchAsset","eth_signTypedData_v4","personal_sign"];r.methodsWithConfirmation=[...n,"wallet_requestPermissions","wallet_requestSnaps","wallet_snap","wallet_invokeSnap","eth_decrypt","eth_sign","eth_requestAccounts","eth_getEncryptionPublicKey"]}}},{package:"$root$",file:"shared/constants/methods-tags.ts"}],[4392,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSmartTransactionMetricsProperties=void 0;r.getSmartTransactionMetricsProperties=(e,t)=>{const r=e.getIsSmartTransaction(),n={is_smart_transaction:r};if(!r)return n;const s=e.getSmartTransactionByMinedTxHash(t.hash),o=null==s?void 0:s.statusMetadata;return o?(n.smart_transaction_duplicated=o.duplicated,n.smart_transaction_timed_out=o.timedOut,n.smart_transaction_proxied=o.proxied,n):n}}}},{package:"$root$",file:"shared/modules/metametrics.ts"}],[44,{loglevel:3644,"webextension-polyfill":4322},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({location:e,registerOnboarding:t}){return async function(r,o,i,a){try{if("wallet_registerOnboarding"!==r.method)return void i();r.tabId&&r.tabId!==s.default.tabs.TAB_ID_NONE?await t(e,r.tabId):n.default.debug(`'wallet_registerOnboarding' message from ${e} ignored due to missing tabId`),o.result=!0,a()}catch(e){a(e)}}};var n=o(e("loglevel")),s=o(e("webextension-polyfill"));function o(e){return e&&e.__esModule?e:{default:e}}}}},{package:"$root$",file:"app/scripts/lib/createOnboardingMiddleware.js"}],[45,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,n){t.origin=e.origin,n()}}}}},{package:"$root$",file:"app/scripts/lib/createOriginMiddleware.js"}],[46,{"../../../shared/constants/app":4343,"../../../shared/constants/metametrics":4353,"../../../shared/constants/security-provider":4361,"../../../shared/constants/transaction":4368,"../../../ui/helpers/utils/metrics":5176,"./snap-keyring/metrics":89,"@metamask/controller-utils":1094,"eth-rpc-errors":3026,"ethereumjs-util":3057},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({trackEvent:e,getMetricsState:t,rateLimitTimeout:r=3e5,rateLimitSamplePercent:y=.001,globalRateLimitTimeout:b=3e5,globalRateLimitMaxAmount:w=10,getAccountType:C,getDeviceModel:v,snapAndHardwareMessenger:_,appStateController:S}){return async function(k,T,E){const{origin:A,method:M}=k,P=p[M]??h.RANDOM_SAMPLE;let N;switch(P){case h.TIMEOUT:N=void 0!==m[M];break;case h.NON_RATE_LIMITED:N=!1;break;case h.BLOCKED:N=!0;break;default:case h.RANDOM_SAMPLE:N=Math.random()>=y}const I=w>0&&f>=w,R=!0===t().participateInMetaMetrics,x=g[M],O={},L=A!==i.ORIGIN_METAMASK&&!N&&!I&&!0===R;if(L){const t=x?x.REQUESTED:a.MetaMetricsEventName.ProviderMethodCalled;if(t===a.MetaMetricsEventName.SignatureRequested){var D,U,j,F,B;let e;var q,K;if(O.signature_type=M,(0,o.isValidAddress)(null==k||null===(D=k.params)||void 0===D?void 0:D[1]))e=null==k||null===(q=k.params)||void 0===q?void 0:q[0];else e=null==k||null===(K=k.params)||void 0===K?void 0:K[1];null!==(U=k.securityAlertResponse)&&void 0!==U&&U.providerRequestsCount&&Object.keys(k.securityAlertResponse.providerRequestsCount).forEach((e=>{O[`ppom_${e}_count`]=k.securityAlertResponse.providerRequestsCount[e]})),O.security_alert_response=(null===(j=k.securityAlertResponse)||void 0===j?void 0:j.result_type)??l.BlockaidResultType.NotApplicable,O.security_alert_reason=(null===(F=k.securityAlertResponse)||void 0===F?void 0:F.reason)??l.BlockaidReason.notApplicable,null!==(B=k.securityAlertResponse)&&void 0!==B&&B.description&&(O.security_alert_description=k.securityAlertResponse.description);const t=await(0,u.getSnapAndHardwareInfoForMetrics)(C,v,_);Object.assign(O,t);try{if(M===i.MESSAGE_TYPE.PERSONAL_SIGN){const{isSIWEMessage:t}=(0,n.detectSIWE)({data:e});t&&(O.ui_customizations=(O.ui_customizations||[]).concat(a.MetaMetricsEventUiCustomization.Siwe))}}catch(e){console.warn(`createRPCMethodTrackingMiddleware: Errored - ${e}`)}}else O.method=M;e({event:t,category:a.MetaMetricsEventCategory.InpageProvider,referrer:{url:A},properties:O}),P===h.TIMEOUT&&(m[M]=setTimeout((()=>{delete m[M]}),r)),f+=1,setTimeout((()=>{f-=1}),b)}E((async t=>{var r,n,o,u;if(!1===L||void 0===x)return t();const h=M===i.MESSAGE_TYPE.ETH_SIGN&&(null===(r=T.error)||void 0===r?void 0:r.code)===s.errorCodes.rpc.methodNotFound;let p;h?(p=x.FAILED,O.error=T.error):(null===(n=T.error)||void 0===n?void 0:n.code)===s.errorCodes.provider.userRejectedRequest?p=x.REJECTED:(null===(o=T.error)||void 0===o?void 0:o.code)===s.errorCodes.rpc.internal&&"Request rejected by user or snap."===(null===(u=T.error)||void 0===u?void 0:u.message)?(p=x.REJECTED,O.status=T.error.message):p=x.APPROVED;let g={};if(!h&&c.SIGNING_METHODS.includes(M)){var m;const e=S.getSignatureSecurityAlertResponse(null===(m=k.securityAlertResponse)||void 0===m?void 0:m.securityAlertId);g=(0,d.getBlockaidMetricsProps)({securityAlertResponse:e})}const f={...O,...g,security_alert_reason:g.security_alert_response===l.BlockaidResultType.Benign?"":g.security_alert_reason};return e({event:p,category:a.MetaMetricsEventCategory.InpageProvider,referrer:{url:A},properties:f}),t()}))}};var n=e("@metamask/controller-utils"),s=e("eth-rpc-errors"),o=e("ethereumjs-util"),i=e("../../../shared/constants/app"),a=e("../../../shared/constants/metametrics"),l=e("../../../shared/constants/security-provider"),c=e("../../../shared/constants/transaction"),d=e("../../../ui/helpers/utils/metrics"),u=e("./snap-keyring/metrics");const h={TIMEOUT:"timeout",BLOCKED:"blocked",NON_RATE_LIMITED:"non_rate_limited",RANDOM_SAMPLE:"random_sample"},p={[i.MESSAGE_TYPE.ETH_SIGN]:h.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:h.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:h.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:h.NON_RATE_LIMITED,[i.MESSAGE_TYPE.PERSONAL_SIGN]:h.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_DECRYPT]:h.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:h.NON_RATE_LIMITED,[i.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:h.TIMEOUT,[i.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:h.TIMEOUT,[i.MESSAGE_TYPE.SEND_METADATA]:h.BLOCKED,[i.MESSAGE_TYPE.ETH_CHAIN_ID]:h.BLOCKED,[i.MESSAGE_TYPE.ETH_ACCOUNTS]:h.BLOCKED,[i.MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE]:h.BLOCKED,[i.MESSAGE_TYPE.GET_PROVIDER_STATE]:h.BLOCKED},g={[i.MESSAGE_TYPE.ETH_SIGN]:{APPROVED:a.MetaMetricsEventName.SignatureApproved,FAILED:a.MetaMetricsEventName.SignatureFailed,REJECTED:a.MetaMetricsEventName.SignatureRejected,REQUESTED:a.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA]:{APPROVED:a.MetaMetricsEventName.SignatureApproved,REJECTED:a.MetaMetricsEventName.SignatureRejected,REQUESTED:a.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V3]:{APPROVED:a.MetaMetricsEventName.SignatureApproved,REJECTED:a.MetaMetricsEventName.SignatureRejected,REQUESTED:a.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.ETH_SIGN_TYPED_DATA_V4]:{APPROVED:a.MetaMetricsEventName.SignatureApproved,REJECTED:a.MetaMetricsEventName.SignatureRejected,REQUESTED:a.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.PERSONAL_SIGN]:{APPROVED:a.MetaMetricsEventName.SignatureApproved,REJECTED:a.MetaMetricsEventName.SignatureRejected,REQUESTED:a.MetaMetricsEventName.SignatureRequested},[i.MESSAGE_TYPE.ETH_DECRYPT]:{APPROVED:a.MetaMetricsEventName.DecryptionApproved,REJECTED:a.MetaMetricsEventName.DecryptionRejected,REQUESTED:a.MetaMetricsEventName.DecryptionRequested},[i.MESSAGE_TYPE.ETH_GET_ENCRYPTION_PUBLIC_KEY]:{APPROVED:a.MetaMetricsEventName.EncryptionPublicKeyApproved,REJECTED:a.MetaMetricsEventName.EncryptionPublicKeyRejected,REQUESTED:a.MetaMetricsEventName.EncryptionPublicKeyRequested},[i.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS]:{APPROVED:a.MetaMetricsEventName.PermissionsApproved,REJECTED:a.MetaMetricsEventName.PermissionsRejected,REQUESTED:a.MetaMetricsEventName.PermissionsRequested},[i.MESSAGE_TYPE.WALLET_REQUEST_PERMISSIONS]:{APPROVED:a.MetaMetricsEventName.PermissionsApproved,REJECTED:a.MetaMetricsEventName.PermissionsRejected,REQUESTED:a.MetaMetricsEventName.PermissionsRequested}},m={};let f=0}}},{package:"$root$",file:"app/scripts/lib/createRPCMethodTrackingMiddleware.js"}],[47,{"promise-to-callback":3790,"readable-stream":4049},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e,t){return new i(e,t)};var n,s=e("readable-stream"),o=(n=e("promise-to-callback"))&&n.__esModule?n:{default:n};class i extends s.Writable{constructor(e,t){super({objectMode:!0,...t}),this._asyncWriteFn=e}_write(e,t,r){(0,o.default)(this._asyncWriteFn(e,t))(r)}}}}},{package:"$root$",file:"app/scripts/lib/createStreamSink.js"}],[48,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return function(t,r,n){t.tabId=e.tabId,n()}}}}},{package:"$root$",file:"app/scripts/lib/createTabIdMiddleware.js"}],[49,{"@metamask/browser-passworder":1086},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.encryptorFactory=void 0;var n=e("@metamask/browser-passworder");const s=e=>async(t,r,s,o)=>(0,n.encrypt)(t,r,s,o,{algorithm:"PBKDF2",params:{iterations:e}}),o=e=>async(t,r,s)=>(0,n.encryptWithDetail)(t,r,s,{algorithm:"PBKDF2",params:{iterations:e}}),i=e=>async(t,r,s,o)=>(0,n.keyFromPassword)(t,r,s,o??{algorithm:"PBKDF2",params:{iterations:e}}),a=e=>t=>(0,n.isVaultUpdated)(t,{algorithm:"PBKDF2",params:{iterations:e}});r.encryptorFactory=e=>({encrypt:s(e),encryptWithKey:n.encryptWithKey,encryptWithDetail:o(e),decrypt:n.decrypt,decryptWithKey:n.decryptWithKey,decryptWithDetail:n.decryptWithDetail,keyFromPassword:i(e),isVaultUpdated:a(e),importKey:n.importKey,exportKey:n.exportKey,generateSalt:n.generateSalt})}}},{package:"$root$",file:"app/scripts/lib/encryptor-factory.ts"}],[5,{"../../../shared/constants/network":4355},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.SINGLE_CALL_BALANCES_ADDRESSES=void 0;var n=e("../../../shared/constants/network");r.SINGLE_CALL_BALANCES_ADDRESSES={[n.CHAIN_IDS.MAINNET]:"0xb1f8e55c7f64d203c1400b9d8555d050f94adf39",[n.CHAIN_IDS.GOERLI]:"0x9788C4E93f9002a7ad8e72633b11E8d1ecd51f9b",[n.CHAIN_IDS.SEPOLIA]:"",[n.CHAIN_IDS.BSC]:"0x2352c63A83f9Fd126af8676146721Fa00924d7e4",[n.CHAIN_IDS.OPTIMISM]:"0xB1c568e9C3E6bdaf755A60c7418C269eb11524FC",[n.CHAIN_IDS.POLYGON]:"0x2352c63A83f9Fd126af8676146721Fa00924d7e4",[n.CHAIN_IDS.AVALANCHE]:"0xD023D153a0DFa485130ECFdE2FAA7e612EF94818",[n.CHAIN_IDS.FANTOM]:"0x07f697424ABe762bB808c109860c04eA488ff92B",[n.CHAIN_IDS.ARBITRUM]:"0x151E24A486D7258dd7C33Fb67E4bB01919B7B32c",[n.CHAIN_IDS.BLAST]:"0xfd5730e96f9dffae40d99b77015bd42816280998",[n.CHAIN_IDS.LINEA_GOERLI]:"0x10dAd7Ca3921471f616db788D9300DC97Db01783",[n.CHAIN_IDS.LINEA_MAINNET]:"0xF62e6a41561b3650a69Bb03199C735e3E3328c0D",[n.CHAIN_IDS.AURORA]:"0x1286415D333855237f89Df27D388127181448538",[n.CHAIN_IDS.BASE]:"0x6AA75276052D96696134252587894ef5FFA520af",[n.CHAIN_IDS.ZKSYNC_ERA]:"0x458fEd3144680a5b8bcfaa0F9594aa19B4Ea2D34"}}}},{package:"$root$",file:"app/scripts/constants/contracts.ts"}],[50,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=[{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"resolver",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"owner",outputs:[{name:"",type:"address"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"label",type:"bytes32"},{name:"owner",type:"address"}],name:"setSubnodeOwner",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"ttl",type:"uint64"}],name:"setTTL",outputs:[],payable:!1,type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"ttl",outputs:[{name:"",type:"uint64"}],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"resolver",type:"address"}],name:"setResolver",outputs:[],payable:!1,type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"owner",type:"address"}],name:"setOwner",outputs:[],payable:!1,type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"Transfer",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"label",type:"bytes32"},{indexed:!1,name:"owner",type:"address"}],name:"NewOwner",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"resolver",type:"address"}],name:"NewResolver",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"ttl",type:"uint64"}],name:"NewTTL",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/registry.js"}],[51,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;r.default=[{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes32"}],name:"setContent",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"content",outputs:[{name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"interfaceID",type:"bytes4"}],name:"supportsInterface",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"pure",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"},{name:"value",type:"string"}],name:"setText",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"contentTypes",type:"uint256"}],name:"ABI",outputs:[{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],name:"setPubkey",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"hash",type:"bytes"}],name:"setContenthash",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"addr",outputs:[{name:"",type:"address"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"},{name:"key",type:"string"}],name:"text",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"contentType",type:"uint256"},{name:"data",type:"bytes"}],name:"setABI",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"name",outputs:[{name:"",type:"string"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"name",type:"string"}],name:"setName",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"contenthash",outputs:[{name:"",type:"bytes"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"node",type:"bytes32"}],name:"pubkey",outputs:[{name:"x",type:"bytes32"},{name:"y",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"node",type:"bytes32"},{name:"addr",type:"address"}],name:"setAddr",outputs:[],payable:!1,stateMutability:"nonpayable",type:"function"},{inputs:[{name:"ensAddr",type:"address"}],payable:!1,stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"a",type:"address"}],name:"AddrChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"name",type:"string"}],name:"NameChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!0,name:"contentType",type:"uint256"}],name:"ABIChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"x",type:"bytes32"},{indexed:!1,name:"y",type:"bytes32"}],name:"PubkeyChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"indexedKey",type:"string"},{indexed:!1,name:"key",type:"string"}],name:"TextChanged",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"node",type:"bytes32"},{indexed:!1,name:"hash",type:"bytes"}],name:"ContenthashChanged",type:"event"}]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/contracts/resolver.js"}],[52,{"./contracts/registry":50,"./contracts/resolver":51,"@ensdomains/content-hash":333,"@metamask/ethjs-contract":1291,"@metamask/ethjs-query":1295,"eth-ens-namehash":2994},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=async function({provider:e,name:t}){const r=new s.default(e),c=n.default.hash(t),u=new o.default(r),h=Number.parseInt(await r.net_version(),10),p=function(e){switch(e){case 1:case 3:case 4:case 5:case 6:return"0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";default:return null}}(h);if(!p)throw new Error(`EnsIpfsResolver - no known ens-ipfs registry for chainId "${h}"`);const g=u(a.default).at(p),m=(await g.resolver(c))[0];if(d(m))throw new Error(`EnsIpfsResolver - no resolver found for name "${t}"`);const f=u(l.default).at(m),y=await f.supportsInterface("0xbc1c58d1"),b=await f.supportsInterface("0xd8389dc5");if(y[0]){const e=(await f.contenthash(c))[0];let t=i.default.decode(e);const r=i.default.getCodec(e);return"ipfs-ns"!==r&&"ipns-ns"!==r||(t=i.default.helpers.cidV0ToV1Base32(t)),{type:r,hash:t}}if(b[0]){const e=(await f.content(c))[0];if(d(e))throw new Error(`EnsIpfsResolver - no content ID found for name "${t}"`);return{type:"swarm-ns",hash:e.slice(2)}}throw new Error(`EnsIpfsResolver - the resolver for name "${t}" is not standard, it should either supports contenthash() or content()`)};var n=c(e("eth-ens-namehash")),s=c(e("@metamask/ethjs-query")),o=c(e("@metamask/ethjs-contract")),i=c(e("@ensdomains/content-hash")),a=c(e("./contracts/registry")),l=c(e("./contracts/resolver"));function c(e){return e&&e.__esModule?e:{default:e}}function d(e){return[undefined,null,"0x","0x0","0x0000000000000000000000000000000000000000000000000000000000000000"].includes(e)}}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/resolver.js"}],[529,{"@ethereumjs/tx":395,"@ethereumjs/util":407,"@keystonehq/bc-ur-registry-eth":534,buffer:2795,hdkey:3406,rlp:4081,uuid:4259},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(r,"__esModule",{value:!0});var s=n(e("hdkey")),o=e("@ethereumjs/util"),i=n(e("rlp")),a=e("@ethereumjs/tx"),l=e("@keystonehq/bc-ur-registry-eth"),c=e("uuid");const d="QR Hardware Wallet Device",u="m",h="0/*";var p,g;!function(e){e.hd="hd",e.pubkey="pubkey"}(p||(p={})),function(e){e.standard="account.standard",e.ledger_live="account.ledger_live",e.ledger_legacy="account.ledger_legacy"}(g||(g={}));class m{constructor(e){this.version=1,this.getInteraction=()=>{throw new Error("KeystoneError#invalid_extends: method getInteraction not implemented, please extend BaseKeyring by overwriting this method.")},this.type=d,this.requestSignature=async(e,t,r,n)=>{const s=await this.getInteraction().requestSignature(t,r,n),o=s.getRequestId(),i=s.getSignature();if(o){if(c.stringify(o)!==e)throw new Error("KeystoneError#invalid_data: read signature error: mismatched requestId")}return{r:i.slice(0,32),s:i.slice(32,64),v:i.slice(64)}},this.__readCryptoHDKey=e=>{var t,r;const n=`m/${e.getOrigin().getPath()}`,s=null==(t=e.getOrigin().getSourceFingerprint())?void 0:t.toString("hex"),o=(null==(r=e.getChildren())?void 0:r.getPath())||h,i=e.getName();if(e.getNote()===g.standard?this.keyringAccount=g.standard:e.getNote()===g.ledger_legacy&&(this.keyringAccount=g.ledger_legacy),!s)throw new Error("KeystoneError#invalid_data: invalid crypto-hdkey, cannot get source fingerprint");const a=e.getBip32Key();this.xfp=s,this.xpub=a,this.hdPath=n,this.childrenPath=o,i!==undefined&&""!==i&&(this.name=i),this.initialized=!0},this.__readCryptoAccount=e=>{var t,r;const n=null==(t=e.getMasterFingerprint())?void 0:t.toString("hex");if(!n)throw new Error("KeystoneError#invalid_data: invalid crypto-account, cannot get master fingerprint");this.xfp=n,this.initialized=!0;let s=!1;const i=e.getOutputDescriptors();if(!i||0===i.length)throw new Error("KeystoneError#invalid_data: invalid crypto-account, no crypto output found");if(i.length%5!=0)throw new Error("KeystoneError#invalid_data: only support 5x pubkey accounts for now");return null==(r=e.getOutputDescriptors())||r.forEach((e=>{try{const t=e.getHDKey();if(t){const e=t.getKey(),r=`M/${t.getOrigin().getPath()}`,n="0x"+o.publicToAddress(e,!0).toString("hex");this.name=t.getName(),t.getNote()===g.ledger_live&&(this.keyringAccount=g.ledger_live),this.paths[o.toChecksumAddress(n)]===undefined&&(s=!0),this.paths[o.toChecksumAddress(n)]=r}}catch(e){throw new Error(`KeystoneError#invalid_data: ${e}`)}})),s},this.getName=()=>this.name,this.setAccountToUnlock=e=>{this.unlockedAccount=parseInt(e,10)},this.__getNormalPage=async e=>{this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,r=t+this.perPage,n=[];for(let e=t;e<r;e++){const t=await this.__addressFromIndex(u,e);n.push({address:t,balance:null,index:e}),this.indexes[o.toChecksumAddress(t)]=e}return n},this.__getLedgerLivePage=async e=>{const t=(this.page+e-1)*this.perPage,r=t+this.perPage,n=[];for(let e=t;e<r;e++){const t=await this.__addressFromIndex(u,e);n.push({address:t,balance:null,index:e})}return this.page+=e,n},this.__addressFromIndex=async(e,t)=>{if(this.keyringMode===p.hd){this.checkKeyring(),this.hdk||(this.hdk=s.fromExtendedKey(this.xpub));const r=this.childrenPath.replace("*",String(t)).replace(/\*/g,"0"),n=this.hdk.derive(`${e}/${r}`),i="0x"+o.publicToAddress(n.publicKey,!0).toString("hex");return o.toChecksumAddress(i)}{const e=Object.keys(this.paths)[t];if(e)return o.toChecksumAddress(e);throw new Error("KeystoneError#pubkey_account.no_expected_account")}},this.page=0,this.perPage=5,this.accounts=[],this.currentAccount=0,this.unlockedAccount=0,this.name="QR Hardware",this.keyringMode=p.hd,this.keyringAccount=g.standard,this.initialized=!1,this.xfp="",this.xpub="",this.hdPath="",this.childrenPath=h,this.indexes={},this.paths={},this.deserialize(e)}async readKeyring(){const e=await this.getInteraction().readCryptoHDKeyOrCryptoAccount();this.syncKeyring(e)}syncKeyring(e){e.getRegistryType().getType()===l.extend.RegistryTypes.CRYPTO_HDKEY.getType()?(this.keyringMode=p.hd,this.__readCryptoHDKey(e)):(this.keyringMode=p.pubkey,this.__readCryptoAccount(e))}checkKeyring(){if(!this.xfp||!this.xpub||!this.hdPath)throw new Error("KeystoneError#invalid_keyring: keyring not fulfilled, please call function `readKeyring` firstly")}serialize(){return Promise.resolve({initialized:this.initialized,accounts:this.accounts,currentAccount:this.currentAccount,page:this.page,perPage:this.perPage,keyringAccount:this.keyringAccount,keyringMode:this.keyringMode,name:this.name,version:this.version,xfp:this.xfp,xpub:this.xpub,hdPath:this.hdPath,childrenPath:this.childrenPath,indexes:this.indexes,paths:this.paths})}deserialize(e){e&&(this.accounts=e.accounts,this.currentAccount=e.currentAccount,this.page=e.page,this.perPage=e.perPage,this.name=e.name,this.initialized=e.initialized,this.keyringMode=e.keyringMode||p.hd,this.keyringAccount=e.keyringAccount||g.standard,this.xfp=e.xfp,this.xpub=e.xpub,this.hdPath=e.hdPath,this.indexes=e.indexes,this.paths=e.paths,this.childrenPath=e.childrenPath||h)}setCurrentAccount(e){this.currentAccount=e}getCurrentAccount(){return this.currentAccount}getCurrentAddress(){return this.accounts[this.currentAccount]}async addAccounts(e=1){const t=this.unlockedAccount,r=t+e,n=[];for(let e=t;e<r;e++){const t=await this.__addressFromIndex(u,e);n.push(t),this.page=0,this.unlockedAccount++}return this.accounts=this.accounts.concat(n),this.accounts}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}async __getPage(e){return this.initialized||await this.readKeyring(),this.keyringMode===p.hd?this.__getNormalPage(e):this.__getLedgerLivePage(e)}getAccounts(){return Promise.resolve(this.accounts)}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))}async signTransaction(e,r){const n=0===r.type?l.DataType.transaction:l.DataType.typedTransaction;let s;s=0===r.type?t.from(i.encode(r.getMessageToSign(!1))):r.getMessageToSign(!1);const o=await this._pathFromAddress(e),d=Number(r.common.chainId()),u=c.v4(),h=l.EthSignRequest.constructETHRequest(s,n,o,this.xfp,u,d),{r:p,s:g,v:m}=await this.requestSignature(u,h,"Scan with your Keystone",'After your Keystone has signed the transaction, click on "Scan Keystone" to receive the signature');return a.TransactionFactory.fromTxData({...r.toJSON(),type:r.type,r:p,s:g,v:m},{common:r.common})}signMessage(e,t){return this.signPersonalMessage(e,t)}async signPersonalMessage(e,r){const n=o.stripHexPrefix(r),s=await this._pathFromAddress(e),i=c.v4(),a=l.EthSignRequest.constructETHRequest(t.from(n,"hex"),l.DataType.personalMessage,s,this.xfp,i,undefined,e),{r:d,s:u,v:h}=await this.requestSignature(i,a,"Scan with your Keystone",'After your Keystone has signed this message, click on "Scan Keystone" to receive the signature');return"0x"+t.concat([d,u,h]).toString("hex")}async signTypedData(e,r){const n=await this._pathFromAddress(e),s=c.v4(),o=l.EthSignRequest.constructETHRequest(t.from(JSON.stringify(r),"utf-8"),l.DataType.typedData,n,this.xfp,s,undefined,e),{r:i,s:a,v:d}=await this.requestSignature(s,o,"Scan with your Keystone",'After your Keystone has signed this data, click on "Scan Keystone" to receive the signature');return"0x"+t.concat([i,a,d]).toString("hex")}async _pathFromAddress(e){if(this.keyringMode===p.hd){const t=o.toChecksumAddress(e);let r=this.indexes[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===await this.__addressFromIndex(u,e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return`${this.hdPath}/${this.childrenPath.replace("*",r.toString()).replace(/\*/g,"0")}`}{const t=o.toChecksumAddress(e),r=this.paths[t];if(void 0===r)throw new Error("Unknown address");return r}}}m.type=d,r.BaseKeyring=m}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@keystonehq/metamask-airgapped-keyring>@keystonehq/base-eth-keyring",file:"node_modules/@keystonehq/base-eth-keyring/dist/base-eth-keyring.cjs.development.js"}],[53,{"../../../../shared/modules/fetch-with-timeout":4388,"./resolver":52,"base32-encode":2697,"base64-js":2698,"webextension-polyfill":4322},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function({provider:e,getCurrentChainId:t,getIpfsGateway:r,getUseAddressBarEnsResolution:i}){const l=d.map((e=>`*://*.${e}/*`));return o.default.webRequest.onErrorOccurred.addListener(u,{urls:l,types:["main_frame"]}),{remove(){o.default.webRequest.onErrorOccurred.removeListener(u)}};async function u(l){const{tabId:u,url:h}=l;if(-1===u||"0x1"!==t())return;const{hostname:p,pathname:g,search:m,hash:f}=new URL(h),y=p.split("."),b=y[y.length-1];d.includes(b)&&async function({tabId:t,name:l,pathname:d,search:u,fragment:h}){const p=r(),g=i(),m=`https://app.ens.domains/name/${l}`;g&&p&&o.default.tabs.update(t,{url:"loading.html"});let f=m;0;try{const{type:t,hash:r}=await(0,a.default)({provider:e,name:l});if("ipfs-ns"===t||"ipns-ns"===t){if(""===p)return void(f=null);const e=`https://${r}.${t.slice(0,4)}.${p}${d}${u||""}${h||""}`;try{200===(await c(e,{method:"HEAD"})).status&&(f=e)}catch(e){console.warn(e)}}else if("swarm-ns"===t)f=`https://swarm-gateways.net/bzz:/${r}${d}${u||""}${h||""}`;else if("onion"===t||"onion3"===t)f=`http://${r}.onion${d}${u||""}${h||""}`;else if("zeronet"===t)f=`http://127.0.0.1:43110/${r}${d}${u||""}${h||""}`;else if("skynet-ns"===t){const e=r.padEnd(r.length+4-r.length%4,"="),t=s.default.toByteArray(e),o={padding:!1};f=`https://${(0,n.default)(t,"RFC4648-HEX",o).toLowerCase()}.siasky.net${d}${u||""}${h||""}`}}catch(e){console.warn(e)}finally{f&&(g||!g&&f!==m)&&o.default.tabs.update(t,{url:f})}}({tabId:u,name:p,pathname:g,search:m,fragment:f})}};var n=l(e("base32-encode")),s=l(e("base64-js")),o=l(e("webextension-polyfill")),i=l(e("../../../../shared/modules/fetch-with-timeout")),a=l(e("./resolver"));function l(e){return e&&e.__esModule?e:{default:e}}const c=(0,i.default)(),d=["eth"]}}},{package:"$root$",file:"app/scripts/lib/ens-ipfs/setup.js"}],[530,{"@ethereumjs/tx":395,"@ethereumjs/util":407,"@keystonehq/bc-ur-registry-eth":534,buffer:2795,hdkey:3406,rlp:4081,uuid:4259},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){function n(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(r,"__esModule",{value:!0});var s,o,i=n(e("hdkey")),a=e("@ethereumjs/util"),l=n(e("rlp")),c=e("@ethereumjs/tx"),d=e("@keystonehq/bc-ur-registry-eth"),u=e("uuid");!function(e){e.hd="hd",e.pubkey="pubkey"}(s||(s={})),function(e){e.standard="account.standard",e.ledger_live="account.ledger_live",e.ledger_legacy="account.ledger_legacy"}(o||(o={}));class h{constructor(e){this.version=1,this.getInteraction=()=>{throw new Error("KeystoneError#invalid_extends: method getInteraction not implemented, please extend BaseKeyring by overwriting this method.")},this.type="QR Hardware Wallet Device",this.requestSignature=async(e,t,r,n)=>{const s=await this.getInteraction().requestSignature(t,r,n),o=s.getRequestId(),i=s.getSignature();if(o&&u.stringify(o)!==e)throw new Error("KeystoneError#invalid_data: read signature error: mismatched requestId");return{r:i.slice(0,32),s:i.slice(32,64),v:i.slice(64)}},this.__readCryptoHDKey=e=>{var t,r;const n="m/"+e.getOrigin().getPath(),s=null==(t=e.getOrigin().getSourceFingerprint())?void 0:t.toString("hex"),i=(null==(r=e.getChildren())?void 0:r.getPath())||"0/*",a=e.getName();if(e.getNote()===o.standard?this.keyringAccount=o.standard:e.getNote()===o.ledger_legacy&&(this.keyringAccount=o.ledger_legacy),!s)throw new Error("KeystoneError#invalid_data: invalid crypto-hdkey, cannot get source fingerprint");const l=e.getBip32Key();this.xfp=s,this.xpub=l,this.hdPath=n,this.childrenPath=i,void 0!==a&&""!==a&&(this.name=a),this.initialized=!0},this.__readCryptoAccount=e=>{var t,r;const n=null==(t=e.getMasterFingerprint())?void 0:t.toString("hex");if(!n)throw new Error("KeystoneError#invalid_data: invalid crypto-account, cannot get master fingerprint");this.xfp=n,this.initialized=!0;let s=!1;const i=e.getOutputDescriptors();if(!i||0===i.length)throw new Error("KeystoneError#invalid_data: invalid crypto-account, no crypto output found");if(i.length%5!=0)throw new Error("KeystoneError#invalid_data: only support 5x pubkey accounts for now");return null==(r=e.getOutputDescriptors())||r.forEach((e=>{try{const t=e.getHDKey();if(t){const e=t.getKey(),r="M/"+t.getOrigin().getPath(),n="0x"+a.publicToAddress(e,!0).toString("hex");this.name=t.getName(),t.getNote()===o.ledger_live&&(this.keyringAccount=o.ledger_live),void 0===this.paths[a.toChecksumAddress(n)]&&(s=!0),this.paths[a.toChecksumAddress(n)]=r}}catch(e){throw new Error("KeystoneError#invalid_data: "+e)}})),s},this.getName=()=>this.name,this.setAccountToUnlock=e=>{this.unlockedAccount=parseInt(e,10)},this.__getNormalPage=async e=>{this.page+=e,this.page<=0&&(this.page=1);const t=(this.page-1)*this.perPage,r=t+this.perPage,n=[];for(let e=t;e<r;e++){const t=await this.__addressFromIndex("m",e);n.push({address:t,balance:null,index:e}),this.indexes[a.toChecksumAddress(t)]=e}return n},this.__getLedgerLivePage=async e=>{const t=(this.page+e-1)*this.perPage,r=t+this.perPage,n=[];for(let e=t;e<r;e++){const t=await this.__addressFromIndex("m",e);n.push({address:t,balance:null,index:e})}return this.page+=e,n},this.__addressFromIndex=async(e,t)=>{if(this.keyringMode===s.hd){this.checkKeyring(),this.hdk||(this.hdk=i.fromExtendedKey(this.xpub));const r=this.childrenPath.replace("*",String(t)).replace(/\*/g,"0"),n=this.hdk.derive(`${e}/${r}`),s="0x"+a.publicToAddress(n.publicKey,!0).toString("hex");return a.toChecksumAddress(s)}{const e=Object.keys(this.paths)[t];if(e)return a.toChecksumAddress(e);throw new Error("KeystoneError#pubkey_account.no_expected_account")}},this.page=0,this.perPage=5,this.accounts=[],this.currentAccount=0,this.unlockedAccount=0,this.name="QR Hardware",this.keyringMode=s.hd,this.keyringAccount=o.standard,this.initialized=!1,this.xfp="",this.xpub="",this.hdPath="",this.childrenPath="0/*",this.indexes={},this.paths={},this.deserialize(e)}async readKeyring(){const e=await this.getInteraction().readCryptoHDKeyOrCryptoAccount();this.syncKeyring(e)}syncKeyring(e){e.getRegistryType().getType()===d.extend.RegistryTypes.CRYPTO_HDKEY.getType()?(this.keyringMode=s.hd,this.__readCryptoHDKey(e)):(this.keyringMode=s.pubkey,this.__readCryptoAccount(e))}checkKeyring(){if(!this.xfp||!this.xpub||!this.hdPath)throw new Error("KeystoneError#invalid_keyring: keyring not fulfilled, please call function `readKeyring` firstly")}serialize(){return Promise.resolve({initialized:this.initialized,accounts:this.accounts,currentAccount:this.currentAccount,page:this.page,perPage:this.perPage,keyringAccount:this.keyringAccount,keyringMode:this.keyringMode,name:this.name,version:this.version,xfp:this.xfp,xpub:this.xpub,hdPath:this.hdPath,childrenPath:this.childrenPath,indexes:this.indexes,paths:this.paths})}deserialize(e){e&&(this.accounts=e.accounts,this.currentAccount=e.currentAccount,this.page=e.page,this.perPage=e.perPage,this.name=e.name,this.initialized=e.initialized,this.keyringMode=e.keyringMode||s.hd,this.keyringAccount=e.keyringAccount||o.standard,this.xfp=e.xfp,this.xpub=e.xpub,this.hdPath=e.hdPath,this.indexes=e.indexes,this.paths=e.paths,this.childrenPath=e.childrenPath||"0/*")}setCurrentAccount(e){this.currentAccount=e}getCurrentAccount(){return this.currentAccount}getCurrentAddress(){return this.accounts[this.currentAccount]}async addAccounts(e=1){const t=this.unlockedAccount,r=t+e,n=[];for(let e=t;e<r;e++){const t=await this.__addressFromIndex("m",e);n.push(t),this.page=0,this.unlockedAccount++}return this.accounts=this.accounts.concat(n),this.accounts}getFirstPage(){return this.page=0,this.__getPage(1)}getNextPage(){return this.__getPage(1)}getPreviousPage(){return this.__getPage(-1)}async __getPage(e){return this.initialized||await this.readKeyring(),this.keyringMode===s.hd?this.__getNormalPage(e):this.__getLedgerLivePage(e)}getAccounts(){return Promise.resolve(this.accounts)}removeAccount(e){if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))}async signTransaction(e,r){const n=0===r.type?d.DataType.transaction:d.DataType.typedTransaction;let s;s=0===r.type?t.from(l.encode(r.getMessageToSign(!1))):r.getMessageToSign(!1);const o=await this._pathFromAddress(e),i=Number(r.common.chainId()),a=u.v4(),h=d.EthSignRequest.constructETHRequest(s,n,o,this.xfp,a,i),{r:p,s:g,v:m}=await this.requestSignature(a,h,"Scan with your Keystone",'After your Keystone has signed the transaction, click on "Scan Keystone" to receive the signature');return c.TransactionFactory.fromTxData({...r.toJSON(),type:r.type,r:p,s:g,v:m},{common:r.common})}signMessage(e,t){return this.signPersonalMessage(e,t)}async signPersonalMessage(e,r){const n=a.stripHexPrefix(r),s=await this._pathFromAddress(e),o=u.v4(),i=d.EthSignRequest.constructETHRequest(t.from(n,"hex"),d.DataType.personalMessage,s,this.xfp,o,void 0,e),{r:l,s:c,v:h}=await this.requestSignature(o,i,"Scan with your Keystone",'After your Keystone has signed this message, click on "Scan Keystone" to receive the signature');return"0x"+t.concat([l,c,h]).toString("hex")}async signTypedData(e,r){const n=await this._pathFromAddress(e),s=u.v4(),o=d.EthSignRequest.constructETHRequest(t.from(JSON.stringify(r),"utf-8"),d.DataType.typedData,n,this.xfp,s,void 0,e),{r:i,s:a,v:l}=await this.requestSignature(s,o,"Scan with your Keystone",'After your Keystone has signed this data, click on "Scan Keystone" to receive the signature');return"0x"+t.concat([i,a,l]).toString("hex")}async _pathFromAddress(e){if(this.keyringMode===s.hd){const t=a.toChecksumAddress(e);let r=this.indexes[t];if(void 0===r)for(let e=0;e<1e3;e++)if(t===await this.__addressFromIndex("m",e)){r=e;break}if(void 0===r)throw new Error("Unknown address");return`${this.hdPath}/${this.childrenPath.replace("*",r.toString()).replace(/\*/g,"0")}`}{const t=a.toChecksumAddress(e),r=this.paths[t];if(void 0===r)throw new Error("Unknown address");return r}}}h.type="QR Hardware Wallet Device",r.BaseKeyring=h}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@keystonehq/metamask-airgapped-keyring>@keystonehq/base-eth-keyring",file:"node_modules/@keystonehq/base-eth-keyring/dist/base-eth-keyring.cjs.production.min.js"}],[531,{"./base-eth-keyring.cjs.development.js":529,"./base-eth-keyring.cjs.production.min.js":530},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=e("./base-eth-keyring.cjs.production.min.js")}}},{package:"@keystonehq/metamask-airgapped-keyring>@keystonehq/base-eth-keyring",file:"node_modules/@keystonehq/base-eth-keyring/dist/index.js"}],[56,{lodash:3638},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(e){return s((0,n.cloneDeep)(e),(e=>null===e?"null":typeof e))};var n=e("lodash");function s(e={},t){return Object.entries(e).forEach((([r,n])=>{e[r]="object"==typeof n&&null!==n?s(n,t):t(n)})),e}}}},{package:"$root$",file:"app/scripts/lib/getObjStructure.js"}],[561,{"./metamask-airgapped-keyring.cjs.development.js":562,"./metamask-airgapped-keyring.cjs.production.min.js":563},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){t.exports=e("./metamask-airgapped-keyring.cjs.production.min.js")}}},{package:"@keystonehq/metamask-airgapped-keyring",file:"node_modules/@keystonehq/metamask-airgapped-keyring/dist/index.js"}],[562,{"@ethereumjs/tx":395,"@keystonehq/base-eth-keyring":531,"@keystonehq/bc-ur-registry-eth":534,"@metamask/obs-store":568,buffer:2795,events:3097,rlp:571,uuid:4259},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0});var n,s=e("@keystonehq/base-eth-keyring"),o=e("events"),i=e("@metamask/obs-store"),a=e("@keystonehq/bc-ur-registry-eth"),l=e("uuid"),c=e("@ethereumjs/tx"),d=(n=e("rlp"))&&"object"==typeof n&&"default"in n?n.default:n;class u extends o.EventEmitter{constructor(){if(super(),this.cleanSyncListeners=()=>{this.removeAllListeners("keystone-sync_success-hdkey"),this.removeAllListeners("keystone-sync_success-account"),this.removeAllListeners("keystone-sync_cancel")},this.cleanSignListeners=e=>{this.removeAllListeners(`${e}-signed`),this.removeAllListeners(`${e}-canceled`)},this.readCryptoHDKeyOrCryptoAccount=()=>new Promise(((e,r)=>{this.memStore.updateState({sync:{reading:!0}}),this.on("keystone-sync_success-hdkey",(r=>{const n=a.CryptoHDKey.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_success-account",(r=>{const n=a.CryptoAccount.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_cancel",(()=>{this.resetState(),r(new Error("KeystoneError#sync_cancel. Sync process canceled, please retry"))}))})),this.submitCryptoHDKey=e=>{this.emit("keystone-sync_success-hdkey",e)},this.submitCryptoAccount=e=>{this.emit("keystone-sync_success-account",e)},this.cancelSync=()=>{this.emit("keystone-sync_cancel")},this.requestSignature=(e,r,n)=>new Promise(((s,o)=>{const i=e.toUR(),c=e.getRequestId(),d=l.stringify(c),u={requestId:d,payload:{type:i.type,cbor:i.cbor.toString("hex")},title:r,description:n};this.memStore.updateState({sign:{request:u}}),this.once(`${d}-signed`,(e=>{const r=a.ETHSignature.fromCBOR(t.from(e,"hex"));this.resetState(),s(r)})),this.once(`${d}-canceled`,(()=>{this.resetState(),o(new Error("KeystoneError#Tx_canceled. Signing canceled, please retry"))}))})),this.submitSignature=(e,t)=>{this.emit(`${e}-signed`,t)},this.cancelRequestSignature=()=>{const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.memStore.updateState({sign:{}}),this.emit(`${t}-canceled`)}},this.reset=()=>{this.cleanSyncListeners();const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.cleanSignListeners(t)}this.resetState()},this.resetState=()=>{this.memStore.updateState({sync:{reading:!1},sign:{}})},u.instance)return u.instance;this.memStore=new i.ObservableStore({sync:{reading:!1},sign:{},_version:1}),u.instance=this}}class h extends s.BaseKeyring{constructor(e){if(super(e),this.getInteraction=()=>new u,this.resetStore=()=>{this.getInteraction().reset()},this.getMemStore=()=>this.getInteraction().memStore,this.removeAccount=e=>{if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))},this.forgetDevice=()=>{this.page=0,this.perPage=5,this.accounts=[],this.currentAccount=0,this.name="QR Hardware",this.initialized=!1,this.xfp="",this.xpub="",this.hdPath="",this.indexes={},this.hdk=undefined,this.paths={}},this.submitCryptoHDKey=this.getInteraction().submitCryptoHDKey,this.submitCryptoAccount=this.getInteraction().submitCryptoAccount,this.submitSignature=this.getInteraction().submitSignature,this.cancelSync=this.getInteraction().cancelSync,this.cancelSignRequest=this.getInteraction().cancelRequestSignature,h.instance)return h.instance.deserialize(e),h.instance;h.instance=this}async signTransaction(e,t){const r=0===t.type?a.DataType.transaction:a.DataType.typedTransaction;let n;n=0===t.type?d.encode(t.getMessageToSign(!1)):t.getMessageToSign(!1);const s=await this._pathFromAddress(e),o=t.common.chainId(),i=l.v4(),u=a.EthSignRequest.constructETHRequest(n,r,s,this.xfp,i,o,e),{r:h,s:p,v:g}=await this.requestSignature(i,u,"Scan with your Keystone",'After your Keystone has signed the transaction, click on "Scan Keystone" to receive the signature'),m=t.toJSON();m.v=g,m.s=p,m.r=h,m.type=t.type;return c.TransactionFactory.fromTxData(m,{common:t.common})}}h.type=s.BaseKeyring.type,r.MetaMaskKeyring=h}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@keystonehq/metamask-airgapped-keyring",file:"node_modules/@keystonehq/metamask-airgapped-keyring/dist/metamask-airgapped-keyring.cjs.development.js"}],[563,{"@ethereumjs/tx":395,"@keystonehq/base-eth-keyring":531,"@keystonehq/bc-ur-registry-eth":534,"@metamask/obs-store":568,buffer:2795,events:3097,rlp:571,uuid:4259},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0});var n,s=e("@keystonehq/base-eth-keyring"),o=e("events"),i=e("@metamask/obs-store"),a=e("@keystonehq/bc-ur-registry-eth"),l=e("uuid"),c=e("@ethereumjs/tx"),d=(n=e("rlp"))&&"object"==typeof n&&"default"in n?n.default:n;class u extends o.EventEmitter{constructor(){if(super(),this.cleanSyncListeners=()=>{this.removeAllListeners("keystone-sync_success-hdkey"),this.removeAllListeners("keystone-sync_success-account"),this.removeAllListeners("keystone-sync_cancel")},this.cleanSignListeners=e=>{this.removeAllListeners(e+"-signed"),this.removeAllListeners(e+"-canceled")},this.readCryptoHDKeyOrCryptoAccount=()=>new Promise(((e,r)=>{this.memStore.updateState({sync:{reading:!0}}),this.on("keystone-sync_success-hdkey",(r=>{const n=a.CryptoHDKey.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_success-account",(r=>{const n=a.CryptoAccount.fromCBOR(t.from(r,"hex"));this.resetState(),e(n)})),this.on("keystone-sync_cancel",(()=>{this.resetState(),r(new Error("KeystoneError#sync_cancel. Sync process canceled, please retry"))}))})),this.submitCryptoHDKey=e=>{this.emit("keystone-sync_success-hdkey",e)},this.submitCryptoAccount=e=>{this.emit("keystone-sync_success-account",e)},this.cancelSync=()=>{this.emit("keystone-sync_cancel")},this.requestSignature=(e,r,n)=>new Promise(((s,o)=>{const i=e.toUR(),c=e.getRequestId(),d=l.stringify(c),u={requestId:d,payload:{type:i.type,cbor:i.cbor.toString("hex")},title:r,description:n};this.memStore.updateState({sign:{request:u}}),this.once(d+"-signed",(e=>{const r=a.ETHSignature.fromCBOR(t.from(e,"hex"));this.resetState(),s(r)})),this.once(d+"-canceled",(()=>{this.resetState(),o(new Error("KeystoneError#Tx_canceled. Signing canceled, please retry"))}))})),this.submitSignature=(e,t)=>{this.emit(e+"-signed",t)},this.cancelRequestSignature=()=>{const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.memStore.updateState({sign:{}}),this.emit(t+"-canceled")}},this.reset=()=>{this.cleanSyncListeners();const e=this.memStore.getState().sign.request;if(e){const{requestId:t}=e;this.cleanSignListeners(t)}this.resetState()},this.resetState=()=>{this.memStore.updateState({sync:{reading:!1},sign:{}})},u.instance)return u.instance;this.memStore=new i.ObservableStore({sync:{reading:!1},sign:{},_version:1}),u.instance=this}}class h extends s.BaseKeyring{constructor(e){if(super(e),this.getInteraction=()=>new u,this.resetStore=()=>{this.getInteraction().reset()},this.getMemStore=()=>this.getInteraction().memStore,this.removeAccount=e=>{if(!this.accounts.map((e=>e.toLowerCase())).includes(e.toLowerCase()))throw new Error(`Address ${e} not found in this keyring`);this.accounts=this.accounts.filter((t=>t.toLowerCase()!==e.toLowerCase()))},this.forgetDevice=()=>{this.page=0,this.perPage=5,this.accounts=[],this.currentAccount=0,this.name="QR Hardware",this.initialized=!1,this.xfp="",this.xpub="",this.hdPath="",this.indexes={},this.hdk=void 0,this.paths={}},this.submitCryptoHDKey=this.getInteraction().submitCryptoHDKey,this.submitCryptoAccount=this.getInteraction().submitCryptoAccount,this.submitSignature=this.getInteraction().submitSignature,this.cancelSync=this.getInteraction().cancelSync,this.cancelSignRequest=this.getInteraction().cancelRequestSignature,h.instance)return h.instance.deserialize(e),h.instance;h.instance=this}async signTransaction(e,t){const r=0===t.type?a.DataType.transaction:a.DataType.typedTransaction;let n;n=0===t.type?d.encode(t.getMessageToSign(!1)):t.getMessageToSign(!1);const s=await this._pathFromAddress(e),o=t.common.chainId(),i=l.v4(),u=a.EthSignRequest.constructETHRequest(n,r,s,this.xfp,i,o,e),{r:h,s:p,v:g}=await this.requestSignature(i,u,"Scan with your Keystone",'After your Keystone has signed the transaction, click on "Scan Keystone" to receive the signature'),m=t.toJSON();return m.v=g,m.s=p,m.r=h,m.type=t.type,c.TransactionFactory.fromTxData(m,{common:t.common})}}h.type=s.BaseKeyring.type,r.MetaMaskKeyring=h}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@keystonehq/metamask-airgapped-keyring",file:"node_modules/@keystonehq/metamask-airgapped-keyring/dist/metamask-airgapped-keyring.cjs.production.min.js"}],[564,{"./ObservableStore":566},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.ComposedStore=void 0;const n=e("./ObservableStore");class s extends n.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach((e=>{const t=this._children[e];this._addChild(e,t)}))}_addChild(e,t){const r=t=>{const r=this.getState();r[e]=t,this.putState(r)};t.subscribe(r),r(t.getState())}}r.ComposedStore=s}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[565,{"./ObservableStore":566},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.MergedStore=void 0;const n=e("./ObservableStore");class s extends n.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach((e=>this._addChild(e))),this._updateWholeState()}_addChild(e){e.subscribe((()=>this._updateWholeState()))}_updateWholeState(){const e=this._children.map((e=>e.getState())),t=Object.assign({},...e);this.putState(t)}}r.MergedStore=s}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/MergedStore.js"}],[566,{"@metamask/safe-event-emitter":570},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.ObservableStore=void 0;const s=n(e("@metamask/safe-event-emitter"));class o extends s.default{constructor(e){super(),this._state=e||{}}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}r.ObservableStore=o}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[567,{stream:4154},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeAsStream=void 0;const n=e("stream");class s extends n.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const r=super.pipe(e,t);return e.write(this.obsStore.getState()),r}_write(e,t,r){this.obsStore.putState(e),r()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}r.storeAsStream=function(e){return new s(e)}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/asStream.js"}],[568,{"./ComposedStore":564,"./MergedStore":565,"./ObservableStore":566,"./asStream":567,"./transform":569},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){n===undefined&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===undefined&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(r,"__esModule",{value:!0}),s(e("./asStream"),r),s(e("./ComposedStore"),r),s(e("./MergedStore"),r),s(e("./ObservableStore"),r),s(e("./transform"),r)}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/index.js"}],[569,{through2:572},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.storeTransformStream=void 0;const n=e("through2");r.storeTransformStream=function(e){return n.obj(((t,r,n)=>{try{return n(null,e(t)),undefined}catch(e){return n(e),undefined}}))}}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/obs-store/dist/transform.js"}],[57,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.hardwareKeyringBuilderFactory=function(e,t){const r=()=>new e({bridge:new t});return r.type=e.type,r}}}},{package:"$root$",file:"app/scripts/lib/hardware-keyring-builder-factory.ts"}],[570,{events:3097},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});const n=e("events");function s(e,t,r){try{Reflect.apply(e,t,r)}catch(e){setTimeout((()=>{throw e}))}}class o extends n.EventEmitter{emit(e,...t){let r="error"===e;const n=this._events;if(n!==undefined)r=r&&n.error===undefined;else if(!r)return!1;if(r){let e;if(t.length>0&&([e]=t),e instanceof Error)throw e;const r=new Error("Unhandled error."+(e?` (${e.message})`:""));throw r.context=e,r}const o=n[e];if(o===undefined)return!1;if("function"==typeof o)s(o,this,t);else{const e=o.length,r=function(e){const t=e.length,r=new Array(t);for(let n=0;n<t;n+=1)r[n]=e[n];return r}(o);for(let n=0;n<e;n+=1)s(r[n],this,t)}return!0}}r.default=o}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>@metamask/safe-event-emitter",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/@metamask/safe-event-emitter/index.js"}],[571,{"bn.js":2747,buffer:2795},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0}),r.getLength=r.decode=r.encode=void 0;var s=n(e("bn.js"));function o(e,t){if("0"===e[0]&&"0"===e[1])throw new Error("invalid RLP: extra zeros");return parseInt(e,t)}function i(e,r){if(e<56)return t.from([e+r]);var n=c(e),s=c(r+55+n.length/2);return t.from(s+n,"hex")}function a(e){var r,n,s,i,l,c=[],d=e[0];if(d<=127)return{data:e.slice(0,1),remainder:e.slice(1)};if(d<=183){if(r=d-127,s=128===d?t.from([]):e.slice(1,r),2===r&&s[0]<128)throw new Error("invalid rlp encoding: byte must be less 0x80");return{data:s,remainder:e.slice(r)}}if(d<=191){if(n=d-182,e.length-1<n)throw new Error("invalid RLP: not enough bytes for string length");if((r=o(e.slice(1,n).toString("hex"),16))<=55)throw new Error("invalid RLP: expected string length to be greater than 55");if((s=e.slice(n,r+n)).length<r)throw new Error("invalid RLP: not enough bytes for string");return{data:s,remainder:e.slice(r+n)}}if(d<=247){for(r=d-191,i=e.slice(1,r);i.length;)l=a(i),c.push(l.data),i=l.remainder;return{data:c,remainder:e.slice(r)}}var u=(n=d-246)+(r=o(e.slice(1,n).toString("hex"),16));if(u>e.length)throw new Error("invalid rlp: total length is larger than the data");if(0===(i=e.slice(n,u)).length)throw new Error("invalid rlp, List has a invalid length");for(;i.length;)l=a(i),c.push(l.data),i=l.remainder;return{data:c,remainder:e.slice(u)}}function l(e){return"0x"===e.slice(0,2)}function c(e){if(e<0)throw new Error("Invalid integer as argument, must be unsigned!");var t=e.toString(16);return t.length%2?"0"+t:t}function d(e){if(!t.isBuffer(e)){if("string"==typeof e)return l(e)?t.from((n="string"!=typeof(o=e)?o:l(o)?o.slice(2):o).length%2?"0"+n:n,"hex"):t.from(e);if("number"==typeof e||"bigint"==typeof e)return e?(r=c(e),t.from(r,"hex")):t.from([]);if(null===e||e===undefined)return t.from([]);if(e instanceof Uint8Array)return t.from(e);if(s.default.isBN(e))return t.from(e.toArray());throw new Error("invalid type")}var r,n,o;return e}r.encode=function e(r){if(Array.isArray(r)){for(var n=[],s=0;s<r.length;s++)n.push(e(r[s]));var o=t.concat(n);return t.concat([i(o.length,192),o])}var a=d(r);return 1===a.length&&a[0]<128?a:t.concat([i(a.length,128),a])},r.decode=function(e,r){if(void 0===r&&(r=!1),!e||0===e.length)return t.from([]);var n=a(d(e));if(r)return n;if(0!==n.remainder.length)throw new Error("invalid remainder");return n.data},r.getLength=function(e){if(!e||0===e.length)return t.from([]);var r=d(e),n=r[0];if(n<=127)return r.length;if(n<=183)return n-127;if(n<=191)return n-182;if(n<=247)return n-191;var s=n-246;return s+o(r.slice(1,s).toString("hex"),16)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@keystonehq/metamask-airgapped-keyring>rlp",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/rlp/dist.browser/index.js"}],[572,{_process:3789,"readable-stream":4049,util:4258,xtend:4328},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(r){(function(){var n=e("readable-stream").Transform,s=e("util").inherits,o=e("xtend");function i(e){n.call(this,e),this._destroyed=!1}function a(e,t,r){r(null,e)}function l(e){return function(t,r,n){return"function"==typeof t&&(n=r,r=t,t={}),"function"!=typeof r&&(r=a),"function"!=typeof n&&(n=null),e(t,r,n)}}s(i,n),i.prototype.destroy=function(e){if(!this._destroyed){this._destroyed=!0;var t=this;r.nextTick((function(){e&&t.emit("error",e),t.emit("close")}))}},t.exports=l((function(e,t,r){var n=new i(e);return n._transform=t,r&&(n._flush=r),n})),t.exports.ctor=l((function(e,t,r){function n(t){if(!(this instanceof n))return new n(t);this.options=o(e,t),i.call(this,this.options)}return s(n,i),n.prototype._transform=t,r&&(n.prototype._flush=r),n})),t.exports.obj=l((function(e,t,r){var n=new i(o({objectMode:!0,highWaterMark:16},e));return n._transform=t,r&&(n._flush=r),n}))}).call(this)}).call(this,e("_process"))}}},{package:"@keystonehq/metamask-airgapped-keyring>@metamask/obs-store>through2",file:"node_modules/@keystonehq/metamask-airgapped-keyring/node_modules/through2/through2.js"}],[58,{"@metamask/keyring-api":1377,"@metamask/permission-controller":1539},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isProtocolAllowed=l,r.keyringSnapPermissionsBuilder=function(e,t){return()=>{if("metamask"===t)return o;const r=e.getSubjectMetadata(t);return(null==r?void 0:r.subjectType)===n.SubjectType.Website&&l(t)?i:[]}};var n=e("@metamask/permission-controller"),s=e("@metamask/keyring-api");const o=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.FilterAccountChains,s.KeyringRpcMethod.DeleteAccount,s.KeyringRpcMethod.ListRequests,s.KeyringRpcMethod.GetRequest,s.KeyringRpcMethod.SubmitRequest,s.KeyringRpcMethod.RejectRequest],i=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.CreateAccount,s.KeyringRpcMethod.FilterAccountChains,s.KeyringRpcMethod.UpdateAccount,s.KeyringRpcMethod.DeleteAccount,s.KeyringRpcMethod.ExportAccount,s.KeyringRpcMethod.ListRequests,s.KeyringRpcMethod.GetRequest,s.KeyringRpcMethod.ApproveRequest,s.KeyringRpcMethod.RejectRequest,s.KeyringRpcMethod.SubmitRequest],a=["https:"];function l(e){try{const t=new URL(e);return a.includes(t.protocol)}catch(e){return!1}}}}},{package:"$root$",file:"app/scripts/lib/keyring-snaps-permissions.ts"}],[6,{"@metamask/base-controller":1085},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.AccountOrderController=void 0;var n=e("@metamask/base-controller");const s={pinnedAccountList:[],hiddenAccountList:[]},o={pinnedAccountList:{persist:!0,anonymous:!0},hiddenAccountList:{persist:!0,anonymous:!0}};class i extends n.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:o,name:"AccountOrderController",state:{...s,...t}})}updateAccountsList(e){this.update((t=>(t.pinnedAccountList=e,t)))}updateHiddenAccountsList(e){this.update((t=>(t.hiddenAccountList=e,t)))}}r.AccountOrderController=i}}},{package:"$root$",file:"app/scripts/controllers/account-order.ts"}],[61,{"../util":97,"json-rpc-engine":3457},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createPendingNonceMiddleware=function({getPendingNonce:e}){return(0,n.createAsyncMiddleware)((async(t,r,n)=>{const{method:s,params:o}=t;if("eth_getTransactionCount"!==s)return void n();const[i,a]=o;"pending"===a?r.result=await e(i,t.networkClientId):n()}))},r.createPendingTxMiddleware=function({getPendingTransactionByHash:e}){return(0,n.createAsyncMiddleware)((async(t,r,n)=>{const{method:o,params:i}=t;if("eth_getTransactionByHash"!==o)return void n();const[a]=i,l=e(a);l?r.result=(0,s.formatTxMetaForRpcResult)(l):n()}))};var n=e("json-rpc-engine"),s=e("../util")}}},{package:"$root$",file:"app/scripts/lib/middleware/pending.js"}],[62,{events:3097,loglevel:3644},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=o(e("events")),s=o(e("loglevel"));function o(e){return e&&e.__esModule?e:{default:e}}class i extends n.default{constructor(e={}){super();const t=e.migrations||[];this.migrations=t.sort(((e,t)=>e.version-t.version));const r=this.migrations.slice(-1)[0];this.defaultVersion=e.defaultVersion||r&&r.version||0}async migrateData(e=this.generateInitialState()){const t=this.migrations.filter((function(t){return t.version>e.meta.version}));for(const r of t)try{s.default.info(`Running migration ${r.version}...`);const t=await r.migrate(e);if(!t.data)throw new Error("Migrator - migration returned empty data");if(t.version!==undefined&&t.meta.version!==r.version)throw new Error("Migrator - Migration did not update version number correctly");e=t,s.default.info(`Migration ${r.version} complete`)}catch(t){const n=t.message;return t.message=`MetaMask Migration Error #${r.version}: ${n}`,this.emit("error",t),e}return e}generateInitialState(e){return{meta:{version:this.defaultVersion},data:e}}}r.default=i}}},{package:"$root$",file:"app/scripts/lib/migrator/index.js"}],[64,{"../../../shared/constants/notifications":4356,"../platforms/extension":223,"@metamask/safe-event-emitter":1626},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.NOTIFICATION_MANAGER_EVENTS=void 0;var n=i(e("@metamask/safe-event-emitter")),s=i(e("../platforms/extension")),o=e("../../../shared/constants/notifications");function i(e){return e&&e.__esModule?e:{default:e}}const a=r.NOTIFICATION_MANAGER_EVENTS={POPUP_CLOSED:"onPopupClosed"};class l extends n.default{constructor(){super(),this.platform=new s.default,this.platform.addOnRemovedListener(this._onWindowClosed.bind(this))}markAsAutomaticallyClosed(){this._popupAutomaticallyClosed=!0}async showPopup(e,t){this._popupId=t,this._setCurrentPopupId=e;const r=await this._getPopup(t);if(r)await this.platform.focusWindow(r.id);else{let e=0,t=0;try{const r=await this.platform.getLastFocusedWindow();t=r.top,e=Math.max(r.left+(r.width-o.NOTIFICATION_WIDTH),0)}catch(r){const{screenX:n,screenY:s,outerWidth:i}=window;t=Math.max(s,0),e=Math.max(n+(i-o.NOTIFICATION_WIDTH),0)}const r=await this.platform.openWindow({url:"notification.html",type:"popup",width:o.NOTIFICATION_WIDTH,height:o.NOTIFICATION_HEIGHT,left:e,top:t});r.left!==e&&"fullscreen"!==r.state&&await this.platform.updateWindowPosition(r.id,e,t),this._setCurrentPopupId(r.id),this._popupId=r.id}}_onWindowClosed(e){e===this._popupId&&(this._setCurrentPopupId(undefined),this._popupId=undefined,this.emit(a.POPUP_CLOSED,{automaticallyClosed:this._popupAutomaticallyClosed}),this._popupAutomaticallyClosed=undefined)}async _getPopup(){const e=await this.platform.getAllWindows();return this._getPopupIn(e)}_getPopupIn(e){return e?e.find((e=>e&&"popup"===e.type&&e.id===this._popupId)):null}}r.default=l}}},{package:"$root$",file:"app/scripts/lib/notification-manager.js"}],[65,{"../../../../shared/constants/offscreen-communication":4357,"eth-lattice-keyring":2995},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LatticeKeyringOffscreen=void 0;var n,s=(n=e("eth-lattice-keyring"))&&n.__esModule?n:{default:n},o=e("../../../../shared/constants/offscreen-communication");class i extends s.default{constructor(e={}){super(e)}async _getCreds(){try{const e=this.appName?this.appName:"Unknown",t=`${o.KnownOrigins.lattice}?keyring=${e}&forceLogin=true`;return await new Promise(((e,r)=>{chrome.runtime.sendMessage({target:o.OffscreenCommunicationTarget.latticeOffscreen,params:{url:t}},(t=>{t.error&&r(t.error),e(t.result)}))}))}catch(e){throw new Error(e)}}}r.LatticeKeyringOffscreen=i,function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(i,"type",void 0),i.type=s.default.type}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/lattice-offscreen-keyring.ts"}],[66,{"../../../../shared/constants/offscreen-communication":4357},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.LedgerOffscreenBridge=void 0;var n=e("../../../../shared/constants/offscreen-communication");function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.LedgerOffscreenBridge=class{constructor(){s(this,"isDeviceConnected",!1)}init(){return chrome.runtime.onMessage.addListener((e=>{e.target===n.OffscreenCommunicationTarget.extension&&e.event===n.OffscreenCommunicationEvents.ledgerDeviceConnect&&(this.isDeviceConnected=!0)})),Promise.resolve()}destroy(){return Promise.resolve()}attemptMakeApp(){return new Promise(((e,t)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.makeApp},(r=>{r.success?e(!0):r.error?t(r.error):t(new Error("Unknown error occurred"))}))}))}updateTransportMethod(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.updateTransport,params:{transportType:e}},(e=>{e.success?t(!0):r(new Error("Ledger transport could not be updated"))}))}))}getPublicKey(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.getPublicKey,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}deviceSignTransaction(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.signTransaction,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}deviceSignMessage(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.signPersonalMessage,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}deviceSignTypedData(e){return new Promise(((t,r)=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.ledgerOffscreen,action:n.LedgerAction.signTypedData,params:e},(e=>{e.success?t(e.payload):r(e.payload.error)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/ledger-offscreen-bridge.ts"}],[67,{"../../../../shared/constants/offscreen-communication":4357},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.TrezorOffscreenBridge=void 0;var n=e("../../../../shared/constants/offscreen-communication");function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.TrezorOffscreenBridge=class{constructor(){s(this,"model",void 0)}init(e){return chrome.runtime.onMessage.addListener((e=>{e.target===n.OffscreenCommunicationTarget.extension&&e.event===n.OffscreenCommunicationEvents.trezorDeviceConnect&&(this.model=e.payload)})),new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.init,params:e},(()=>{t()}))}))}dispose(){return new Promise((e=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.dispose},(()=>{e()}))}))}getPublicKey(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.getPublicKey,params:e},(e=>{t(e)}))}))}ethereumSignTransaction(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.signTransaction,params:e},(e=>{t(e)}))}))}ethereumSignMessage(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.signMessage,params:e},(e=>{t(e)}))}))}ethereumSignTypedData(e){return new Promise((t=>{chrome.runtime.sendMessage({target:n.OffscreenCommunicationTarget.trezorOffscreen,action:n.TrezorAction.signTypedData,params:e},(e=>{t(e)}))}))}}}}},{package:"$root$",file:"app/scripts/lib/offscreen-bridge/trezor-offscreen-bridge.ts"}],[68,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){function n(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function s(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(r,"__esModule",{value:!0}),r.IndexedDBPPOMStorage=void 0;const o=async(e,t,r)=>{const n=await crypto.subtle.digest("SHA-256",t);if(Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")!==r)throw new Error(`Checksum mismatch for key ${e}`)};var i=new WeakSet;function a(e){return new Promise(((t,r)=>{const n=indexedDB.open(this.storeName,this.dbVersion);n.onerror=e=>{var t;r(new Error(`Failed to open database ${this.storeName}: ${null===(t=e.target)||void 0===t?void 0:t.error}`))},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this.storeName)||t.createObjectStore(this.storeName,{keyPath:["name","chainId"]})},n.onsuccess=r=>{const n=r.target.result.transaction([this.storeName],e).objectStore(this.storeName);t(n)}}))}r.IndexedDBPPOMStorage=class{constructor(e,t){n(this,i),s(this,"storeName",void 0),s(this,"dbVersion",void 0),this.storeName=e,this.dbVersion=t}async objectStoreAction(e,t,r="readonly"){return new Promise(((n,s)=>{(function(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r})(this,i,a).call(this,r).then((r=>{const o=r[e](t);o.onsuccess=async e=>{n(e)},o.onerror=t=>{var r;s(new Error(`Error in indexDB operation ${e}: ${null===(r=t.target)||void 0===r?void 0:r.error}`))}})).catch((e=>{s(e)}))}))}async read(e,t){var r;const n=null===(r=(await this.objectStoreAction("get",[e.name,e.chainId])).target)||void 0===r||null===(r=r.result)||void 0===r?void 0:r.data;return await o(e,n,t),n}async write(e,t,r){await o(e,t,r),await this.objectStoreAction("put",{...e,data:t},"readwrite")}async delete(e){await this.objectStoreAction("delete",[e.name,e.chainId],"readwrite")}async dir(){var e;return null===(e=(await this.objectStoreAction("getAllKeys")).target)||void 0===e?void 0:e.result.map((([e,t])=>({name:e,chainId:t})))}}}}},{package:"$root$",file:"app/scripts/lib/ppom/indexed-db-backend.ts"}],[7,{"../../../shared/constants/alerts":4342,"@metamask/obs-store":1523},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("@metamask/obs-store"),s=e("../../../shared/constants/alerts");const o={alertEnabledness:s.TOGGLEABLE_ALERT_TYPES.reduce(((e,t)=>(e[t]=!0,e)),{}),unconnectedAccountAlertShownOrigins:{},web3ShimUsageOrigins:{}};r.default=class{constructor(e={}){const{initState:t={},controllerMessenger:r}=e,s={...o,alertEnabledness:{...o.alertEnabledness,...t.alertEnabledness}};this.store=new n.ObservableStore(s),this.controllerMessenger=r,this.selectedAddress=this.controllerMessenger.call("AccountsController:getSelectedAccount"),this.controllerMessenger.subscribe("AccountsController:selectedAccountChange",(e=>{this.store.getState().unconnectedAccountAlertShownOrigins&&this.selectedAddress!==e.address&&(this.selectedAddress=e.address,this.store.updateState({unconnectedAccountAlertShownOrigins:{}}))}))}setAlertEnabledness(e,t){let{alertEnabledness:r}=this.store.getState();r={...r},r[e]=t,this.store.updateState({alertEnabledness:r})}setUnconnectedAccountAlertShown(e){let{unconnectedAccountAlertShownOrigins:t}=this.store.getState();t={...t},t[e]=!0,this.store.updateState({unconnectedAccountAlertShownOrigins:t})}getWeb3ShimUsageState(e){return this.store.getState().web3ShimUsageOrigins[e]}setWeb3ShimUsageRecorded(e){this._setWeb3ShimUsageState(e,s.Web3ShimUsageAlertStates.recorded)}setWeb3ShimUsageAlertDismissed(e){this._setWeb3ShimUsageState(e,s.Web3ShimUsageAlertStates.dismissed)}_setWeb3ShimUsageState(e,t){let{web3ShimUsageOrigins:r}=this.store.getState();r={...r},r[e]=t,this.store.updateState({web3ShimUsageOrigins:r})}}}}},{package:"$root$",file:"app/scripts/controllers/alert.js"}],[71,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){let n;Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.PPOM=void 0,r.initSync=function(e){if(n!==undefined)return n;const t=E();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const r=new WebAssembly.Instance(e,t);return A(r,e)},r.main=function(){n.main()};const s="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&s.decode();let o=null;function i(){return null!==o&&0!==o.byteLength||(o=new Uint8Array(n.memory.buffer)),o}function a(e,t){return e>>>=0,s.decode(i().subarray(e,e+t))}const l=new Array(128).fill(undefined);l.push(undefined,null,!0,!1);let c=l.length;function d(e){c===l.length&&l.push(l.length+1);const t=c;return c=l[t],l[t]=e,t}function u(e){return l[e]}function h(e){const t=u(e);return function(e){e<132||(l[e]=c,c=e)}(e),t}let p=0;const g="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},m="function"==typeof g.encodeInto?function(e,t){return g.encodeInto(e,t)}:function(e,t){const r=g.encode(e);return t.set(r),{read:e.length,written:r.length}};function f(e,t,r){if(r===undefined){const r=g.encode(e),n=t(r.length,1)>>>0;return i().subarray(n,n+r.length).set(r),p=r.length,n}let n=e.length,s=t(n,1)>>>0;const o=i();let a=0;for(;a<n;a++){const t=e.charCodeAt(a);if(t>127)break;o[s+a]=t}if(a!==n){0!==a&&(e=e.slice(a)),s=r(s,n,n=a+3*e.length,1)>>>0;const t=i().subarray(s+a,s+n);a+=m(e,t).written}return p=a,s}let y=null;function b(){return null!==y&&0!==y.byteLength||(y=new Int32Array(n.memory.buffer)),y}function w(e){const t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){const t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){const t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){const t=e.length;let r="[";t>0&&(r+=w(e[0]));for(let n=1;n<t;n++)r+=", "+w(e[n]);return r+="]",r}const r=/\[object ([^\]]+)\]/.exec(toString.call(e));let n;if(!(r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch(e){return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}function C(e,t,r){n.wasm_bindgen__convert__closures__invoke1_mut(e,t,d(r))}function v(e,t){n._dyn_core__ops__function__FnMut__A____Output___R_as_wasm_bindgen__closure__WasmClosure___describe__destroy(e,t)}let _=null;function S(e,t){const r=t(4*e.length,4)>>>0,s=(null!==_&&0!==_.byteLength||(_=new Uint32Array(n.memory.buffer)),_);for(let t=0;t<e.length;t++)s[r/4+t]=d(e[t]);return p=e.length,r}function k(e,t){try{return e.apply(this,t)}catch(e){n.__wbindgen_exn_store(d(e))}}class T{static __wrap(e){e>>>=0;const t=Object.create(T.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();n.__wbg_ppom_free(e)}static new(e,t){const r=S(t,n.__wbindgen_malloc),s=p;return h(n.ppom_new(d(e),r,s))}validateJsonRpc(e){return h(n.ppom_validateJsonRpc(this.__wbg_ptr,d(e)))}static version(){return h(n.ppom_version())}}function E(){const e={wbg:{}};return e.wbg.__wbg_buffer_085ec1f694018c4f=function(e){return d(u(e).buffer)},e.wbg.__wbg_call_01734de55d61e11d=function(){return k((function(e,t,r){return d(u(e).call(u(t),u(r)))}),arguments)},e.wbg.__wbg_call_4c92f6aec1e1d6e6=function(){return k((function(e,t,r,n){return d(u(e).call(u(t),u(r),u(n)))}),arguments)},e.wbg.__wbg_from_d7c216d4616bb368=function(e){return d(Array.from(u(e)))},e.wbg.__wbg_get_44be0491f933a435=function(e,t){return d(u(e)[t>>>0])},e.wbg.__wbg_length_72e2208bbc0efc61=function(e){return u(e).length},e.wbg.__wbg_length_d813e535247d427e=function(e){return u(e).length},e.wbg.__wbg_length_fff51ee6522a1a18=function(e){return u(e).length},e.wbg.__wbg_new_43f1b47c28813cbd=function(e,t){try{var r={a:e,b:t};const s=new Promise(((e,t)=>{const s=r.a;r.a=0;try{return function(e,t,r,s){n.wasm_bindgen__convert__closures__invoke2_mut(e,t,d(r),d(s))}(s,r.b,e,t)}finally{r.a=s}}));return d(s)}finally{r.a=r.b=0}},e.wbg.__wbg_new_8125e318e6245eed=function(e){return d(new Uint8Array(u(e)))},e.wbg.__wbg_parse_670c19d4e984792e=function(){return k((function(e,t){return d(JSON.parse(a(e,t)))}),arguments)},e.wbg.__wbg_ppom_new=function(e){return d(T.__wrap(e))},e.wbg.__wbg_resolve_53698b95aaf7fcf8=function(e){return d(Promise.resolve(u(e)))},e.wbg.__wbg_set_5cf90238115182c3=function(e,t,r){u(e).set(u(t),r>>>0)},e.wbg.__wbg_stringify_e25465938f3f611f=function(){return k((function(e){return d(JSON.stringify(u(e)))}),arguments)},e.wbg.__wbg_then_b2267541e2a73865=function(e,t,r){return d(u(e).then(u(t),u(r)))},e.wbg.__wbg_then_f7e06ee3c11698eb=function(e,t){return d(u(e).then(u(t)))},e.wbg.__wbindgen_cb_drop=function(e){const t=h(e).original;if(1==t.cnt--)return t.a=0,!0;return!1},e.wbg.__wbindgen_closure_wrapper_wasm_bindgen__closure__Closure_T___wrap__breaks_if_inlined=function(e,t,r){const n=function(e,t,r,n){const s={a:e,b:t,cnt:1},o=(...e)=>{s.cnt++;const t=s.a;s.a=0;try{return n(t,s.b,...e)}finally{0==--s.cnt?r(t,s.b):s.a=t}};return o.original=s,o}(e,t,v,C);return d(n)},e.wbg.__wbindgen_debug_string=function(e,t){const r=f(w(u(t)),n.__wbindgen_malloc,n.__wbindgen_realloc),s=p;b()[e/4+1]=s,b()[e/4+0]=r},e.wbg.__wbindgen_error_new=function(e,t){return d(new Error(a(e,t)))},e.wbg.__wbindgen_is_undefined=function(e){return u(e)===undefined},e.wbg.__wbindgen_memory=function(){return d(n.memory)},e.wbg.__wbindgen_object_drop_ref=function(e){h(e)},e.wbg.__wbindgen_string_get=function(e,t){const r=u(t),s="string"==typeof r?r:undefined;var o,i=(o=s)===undefined||null===o?0:f(s,n.__wbindgen_malloc,n.__wbindgen_realloc),a=p;b()[e/4+1]=a,b()[e/4+0]=i},e.wbg.__wbindgen_string_new=function(e,t){return d(a(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(a(e,t))},e}function A(e,t){return n=e.exports,M.__wbindgen_wasm_module=t,y=null,_=null,o=null,n.__wbindgen_start(),n}async function M(e){if(n!==undefined)return n;const t=E();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:r,module:s}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,t);return A(r,s)}r.PPOM=T;r.default=M}}},{package:"$root$",file:"app/scripts/lib/ppom/ppom.js"}],[72,{"../../../../shared/constants/network":4355,"./handlers":76,"@metamask/permission-controller":1539,"@metamask/snaps-rpc-methods":1952,"eth-rpc-errors":3026,lodash:3638},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.createMethodMiddleware=function(e){const t=u.filter((t=>!Object.hasOwnProperty.call(e,t)));if(t.length>0)throw new Error(`Missing expected hooks:\n\n${t.join("\n")}\n`);return async function(t,r,n,s){if(l.UNSUPPORTED_RPC_METHODS.has(t.method))return s(i.ethErrors.rpc.methodNotSupported());const a=d.get(t.method);if(a){const{implementation:i,hookNames:l}=a;try{return await i(t,r,n,s,(0,o.selectHooks)(e,l))}catch(e){return s(e)}}return n()}};var n,s=e("@metamask/permission-controller"),o=e("@metamask/snaps-rpc-methods"),i=e("eth-rpc-errors"),a=e("lodash"),l=e("../../../../shared/constants/network");const c=[...((n=e("./handlers"))&&n.__esModule?n:{default:n}).default,...s.permissionRpcMethods.handlers],d=c.reduce(((e,t)=>{for(const r of t.methodNames)e.set(r,t);return e}),new Map),u=Array.from(new Set((0,a.flatten)(c.map((({hookNames:e})=>Object.keys(e))))).values())}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/createMethodMiddleware.js"}],[73,{"../../../../../shared/constants/app":4343,"../../../../../shared/constants/metametrics":4353,"../../../../../shared/modules/network.utils":4394,"../../util":97,"@metamask/controller-utils":1094,"eth-rpc-errors":3026,lodash:3638},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("@metamask/controller-utils"),s=e("eth-rpc-errors"),o=e("lodash"),i=e("../../../../../shared/constants/app"),a=e("../../../../../shared/constants/metametrics"),l=e("../../../../../shared/modules/network.utils"),c=e("../../util");const d={methodNames:[i.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN],implementation:async function(e,t,r,d,{upsertNetworkConfiguration:u,getCurrentChainId:h,getCurrentRpcUrl:p,findNetworkConfigurationBy:g,setNetworkClientIdForDomain:m,setActiveNetwork:f,requestUserApproval:y,startApprovalFlow:b,endApprovalFlow:w,getProviderConfig:C,hasPermissions:v}){var _;if(null===(_=e.params)||void 0===_||!_[0]||"object"!=typeof e.params[0])return d(s.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`}));const{origin:S}=e,{chainId:k,chainName:T=null,blockExplorerUrls:E=null,nativeCurrency:A=null,rpcUrls:M}=e.params[0],P=Object.keys((0,o.omit)(e.params[0],["chainId","chainName","blockExplorerUrls","iconUrls","rpcUrls","nativeCurrency"]));if(P.length>0)return d(s.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${P}`}));function N(e){const t=(0,c.getValidUrl)(e);return null!==t&&("localhost"===t.hostname||"127.0.0.1"===t.hostname||"https:"===t.protocol)}const I=Array.isArray(M)?M.find((e=>N(e))):null,R=null!==E&&Array.isArray(E)?E.find((e=>N(e))):null;if(!I)return d(s.ethErrors.rpc.invalidParams({message:`Expected an array with at least one valid string HTTPS url 'rpcUrls', Received:\n${M}`}));if(null!==E&&!R)return d(s.ethErrors.rpc.invalidParams({message:`Expected null or array with at least one valid string HTTPS URL 'blockExplorerUrl'. Received: ${E}`}));const x="string"==typeof k&&k.toLowerCase();if(!(0,l.isPrefixedFormattedHexString)(x))return d(s.ethErrors.rpc.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${k}`}));if(!(0,l.isSafeChainId)(parseInt(x,16)))return d(s.ethErrors.rpc.invalidParams({message:`Invalid chain ID "${x}": numerical value greater than max safe value. Received:\n${k}`}));const O=g({chainId:x});if(O&&O.rpcUrl===I){t.result=null;const e=h(),r=p();if(e===x&&r===I)return d();try{await y({origin:S,type:n.ApprovalType.SwitchEthereumChain,requestData:{toNetworkConfiguration:O,fromNetworkConfiguration:C()}}),await f(O.id),t.result=null}catch(e){if(e.code!==s.errorCodes.provider.userRejectedRequest)return d(e)}return d()}if("string"!=typeof T||!T)return d(s.ethErrors.rpc.invalidParams({message:`Expected non-empty string 'chainName'. Received:\n${T}`}));const L=T.length>100?T.substring(0,100):T;if(null!==A){if("object"!=typeof A||Array.isArray(A))return d(s.ethErrors.rpc.invalidParams({message:`Expected null or object 'nativeCurrency'. Received:\n${A}`}));if(18!==A.decimals)return d(s.ethErrors.rpc.invalidParams({message:`Expected the number 18 for 'nativeCurrency.decimals' when 'nativeCurrency' is provided. Received: ${A.decimals}`}));if(!A.symbol||"string"!=typeof A.symbol)return d(s.ethErrors.rpc.invalidParams({message:`Expected a string 'nativeCurrency.symbol'. Received: ${A.symbol}`}))}const D=(null==A?void 0:A.symbol)||i.UNKNOWN_TICKER_SYMBOL;if(D!==i.UNKNOWN_TICKER_SYMBOL&&("string"!=typeof D||D.length<2||D.length>6))return d(s.ethErrors.rpc.invalidParams({message:`Expected 2-6 character string 'nativeCurrency.symbol'. Received:\n${D}`}));if(O&&O.chainId===x&&O.ticker!==D)return d(s.ethErrors.rpc.invalidParams({message:`nativeCurrency.symbol does not match currency symbol for a network the user already has added with the same chainId. Received:\n${D}`}));let U;const{id:j}=await b();try{await y({origin:S,type:n.ApprovalType.AddEthereumChain,requestData:{chainId:x,rpcPrefs:{blockExplorerUrl:R},chainName:L,rpcUrl:I,ticker:D}}),U=await u({chainId:x,rpcPrefs:{blockExplorerUrl:R},nickname:L,rpcUrl:I,ticker:D},{source:a.MetaMetricsNetworkEventSource.Dapp,referrer:S}),t.result=null}catch(e){return w({id:j}),d(e)}try{await y({origin:S,type:n.ApprovalType.SwitchEthereumChain,requestData:{toNetworkConfiguration:{rpcUrl:I,chainId:x,nickname:L,ticker:D,networkConfigurationId:U},fromNetworkConfiguration:C()}}),v(e.origin)&&m(e.origin,U)}catch(e){return d(e.code===s.errorCodes.provider.userRejectedRequest?undefined:e)}finally{w({id:j})}try{await f(U)}catch(e){return d(e)}return d()},hookNames:{upsertNetworkConfiguration:!0,getCurrentChainId:!0,getCurrentRpcUrl:!0,findNetworkConfigurationBy:!0,setNetworkClientIdForDomain:!0,setActiveNetwork:!0,requestUserApproval:!0,startApprovalFlow:!0,endApprovalFlow:!0,getProviderConfig:!0,hasPermissions:!0}};r.default=d}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/add-ethereum-chain.js"}],[74,{"../../../../../shared/constants/app":4343},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;const n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.ETH_ACCOUNTS],implementation:async function(e,t,r,n,{getAccounts:s}){return t.result=await s(),n()},hookNames:{getAccounts:!0}};r.default=n}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/eth-accounts.js"}],[75,{"../../../../../shared/constants/app":4343},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;const n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.GET_PROVIDER_STATE],implementation:async function(e,t,r,n,{getProviderState:s}){return t.result={...await s(e.origin)},n()},hookNames:{getProviderState:!0}};r.default=n}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/get-provider-state.js"}],[76,{"./add-ethereum-chain":73,"./eth-accounts":74,"./get-provider-state":75,"./log-web3-shim-usage":77,"./request-accounts":78,"./send-metadata":79,"./switch-ethereum-chain":80,"./watch-asset":81},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=u(e("./add-ethereum-chain")),s=u(e("./eth-accounts")),o=u(e("./get-provider-state")),i=u(e("./log-web3-shim-usage")),a=u(e("./request-accounts")),l=u(e("./send-metadata")),c=u(e("./switch-ethereum-chain")),d=u(e("./watch-asset"));function u(e){return e&&e.__esModule?e:{default:e}}const h=[n.default,s.default,o.default,i.default,a.default,l.default,c.default,d.default];r.default=h}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/index.js"}],[77,{"../../../../../shared/constants/app":4343},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;const n={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.LOG_WEB3_SHIM_USAGE],implementation:function(e,t,r,n,{getWeb3ShimUsageState:s,setWeb3ShimUsageRecorded:o}){const{origin:i}=e;s(i)===undefined&&o(i);return t.result=!0,n()},hookNames:{getWeb3ShimUsageState:!0,setWeb3ShimUsageRecorded:!0}};r.default=n}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/log-web3-shim-usage.js"}],[78,{"../../../../../shared/constants/app":4343,"../../../../../shared/constants/metametrics":4353,"../../util":97,"eth-rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),s=e("../../../../../shared/constants/app"),o=e("../../../../../shared/constants/metametrics"),i=e("../../util");const a={methodNames:[s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS],implementation:async function(e,t,r,a,{origin:c,getAccounts:d,getUnlockPromise:u,hasPermission:h,requestAccountsPermission:p,sendMetrics:g,getPermissionsForOrigin:m,metamaskState:f}){if(l.has(c))return t.error=n.ethErrors.rpc.resourceUnavailable(`Already processing ${s.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS}. Please wait.`),a();if(h(s.MESSAGE_TYPE.ETH_ACCOUNTS)){try{l.add(c),await u(!0),t.result=await d(),a()}catch(e){a(e)}finally{l.delete(c)}return undefined}try{await p()}catch(e){return t.error=e,a()}const y=await d();if(y.length>0){t.result=y;const e=m(c).eth_accounts.caveats[0].value.length,r=!Object.keys(f.permissionHistory).includes(c);(0,i.shouldEmitDappViewedEvent)(f.metaMetricsId)&&g({event:o.MetaMetricsEventName.DappViewed,category:o.MetaMetricsEventCategory.InpageProvider,referrer:{url:c},properties:{is_first_visit:r,number_of_accounts:Object.keys(f.accounts).length,number_of_accounts_connected:e}})}else t.error=n.ethErrors.rpc.internal("Accounts unexpectedly unavailable. Please report this bug.");return a()},hookNames:{origin:!0,getAccounts:!0,getUnlockPromise:!0,hasPermission:!0,requestAccountsPermission:!0,sendMetrics:!0,getPermissionsForOrigin:!0,metamaskState:!0}};r.default=a;const l=new Set}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/request-accounts.js"}],[79,{"../../../../../shared/constants/app":4343,"eth-rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors");const s={methodNames:[e("../../../../../shared/constants/app").MESSAGE_TYPE.SEND_METADATA],implementation:function(e,t,r,s,{addSubjectMetadata:o,subjectType:i}){const{origin:a,params:l}=e;if(!l||"object"!=typeof l||Array.isArray(l))return s(n.ethErrors.rpc.invalidParams({data:l}));{const{icon:e=null,name:t=null,...r}=l;o({...r,iconUrl:e,name:t,subjectType:i,origin:a})}return t.result=!0,s()},hookNames:{addSubjectMetadata:!0,subjectType:!0}};r.default=s}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/send-metadata.js"}],[8,{"@metamask/obs-store":1523,events:3097},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,s=(n=e("events"))&&n.__esModule?n:{default:n},o=e("@metamask/obs-store");function i(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function a(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}const c={currentAppVersion:"",previousAppVersion:"",previousMigrationVersion:0,currentMigrationVersion:0};var d=new WeakSet,u=new WeakSet;class h extends s.default{constructor({currentAppVersion:e="",currentMigrationVersion:t=0,state:r={}}){super(),i(this,u),i(this,d),a(this,"store",void 0),this.store=new o.ObservableStore({...c,...r}),l(this,d,p).call(this,e),l(this,u,g).call(this,t)}}function p(e){const t=this.store.getState().currentAppVersion;e!==t&&this.store.updateState({currentAppVersion:e,previousAppVersion:t})}function g(e){const t=this.store.getState().currentMigrationVersion;e!==t&&this.store.updateState({previousMigrationVersion:t,currentMigrationVersion:e})}r.default=h}}},{package:"$root$",file:"app/scripts/controllers/app-metadata.ts"}],[80,{"../../../../../shared/constants/app":4343,"../../../../../shared/constants/network":4355,"../../../../../shared/modules/network.utils":4394,"@metamask/controller-utils":1094,"eth-rpc-errors":3026,lodash:3638},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("eth-rpc-errors"),s=e("lodash"),o=e("@metamask/controller-utils"),i=e("../../../../../shared/constants/app"),a=e("../../../../../shared/constants/network"),l=e("../../../../../shared/modules/network.utils");const c={methodNames:[i.MESSAGE_TYPE.SWITCH_ETHEREUM_CHAIN],implementation:async function(e,t,r,c,{getCurrentChainId:u,findNetworkConfigurationBy:h,findNetworkClientIdByChainId:p,setNetworkClientIdForDomain:g,setProviderType:m,setActiveNetwork:f,requestUserApproval:y,getProviderConfig:b,hasPermissions:w}){var C;if(null===(C=e.params)||void 0===C||!C[0]||"object"!=typeof e.params[0])return c(n.ethErrors.rpc.invalidParams({message:`Expected single, object parameter. Received:\n${JSON.stringify(e.params)}`}));const{origin:v}=e,{chainId:_}=e.params[0],S=Object.keys((0,s.omit)(e.params[0],["chainId"]));if(S.length>0)return c(n.ethErrors.rpc.invalidParams({message:`Received unexpected keys on object parameter. Unsupported keys:\n${S}`}));const k="string"==typeof _&&_.toLowerCase();if(!(0,l.isPrefixedFormattedHexString)(k))return c(n.ethErrors.rpc.invalidParams({message:`Expected 0x-prefixed, unpadded, non-zero hexadecimal string 'chainId'. Received:\n${_}`}));if(!(0,l.isSafeChainId)(parseInt(k,16)))return c(n.ethErrors.rpc.invalidParams({message:`Invalid chain ID "${k}": numerical value greater than max safe value. Received:\n${_}`}));const T={toNetworkConfiguration:d(k,h)};if(T.fromNetworkConfiguration=b(),T.toNetworkConfiguration){const r=u(),n=p(k);if(r===k)return w(e.origin)&&g(e.origin,n),t.result=null,c();try{const r=await y({origin:v,type:o.ApprovalType.SwitchEthereumChain,requestData:T});Object.values(a.BUILT_IN_INFURA_NETWORKS).map((({chainId:e})=>e)).includes(k)?await m(r.type):await f(r.id),w(e.origin)&&g(e.origin,n),t.result=null}catch(e){return c(e)}return c()}return c(n.ethErrors.provider.custom({code:4902,message:`Unrecognized chain ID "${_}". Try adding the chain using ${i.MESSAGE_TYPE.ADD_ETHEREUM_CHAIN} first.`}))},hookNames:{getCurrentChainId:!0,findNetworkConfigurationBy:!0,findNetworkClientIdByChainId:!0,setNetworkClientIdForDomain:!0,setProviderType:!0,setActiveNetwork:!0,requestUserApproval:!0,getNetworkConfigurations:!0,getProviderConfig:!0,hasPermissions:!0}};r.default=c;function d(e,t){return Object.values(a.BUILT_IN_INFURA_NETWORKS).map((({chainId:e})=>e)).includes(e)?{chainId:e,ticker:a.CURRENCY_SYMBOLS.ETH,nickname:a.NETWORK_TO_NAME_MAP[e],rpcUrl:a.CHAIN_ID_TO_RPC_URL_MAP[e],type:a.CHAIN_ID_TO_TYPE_MAP[e]}:t({chainId:e})}}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/switch-ethereum-chain.js"}],[81,{"../../../../../shared/constants/app":4343,"@metamask/controller-utils":1094,"eth-rpc-errors":3026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("@metamask/controller-utils"),s=e("eth-rpc-errors"),o=e("../../../../../shared/constants/app");const i={methodNames:[o.MESSAGE_TYPE.WATCH_ASSET,o.MESSAGE_TYPE.WATCH_ASSET_LEGACY],implementation:async function(e,t,r,o,{handleWatchAssetRequest:i}){try{const{params:{options:r,type:a},origin:l,networkClientId:c}=e,{tokenId:d}=r;return[n.ERC721,n.ERC1155].includes(a)&&d!==undefined&&"string"!=typeof d?o(s.ethErrors.rpc.invalidParams({message:`Expected parameter 'tokenId' to be type 'string'. Received type '${typeof d}'`})):(await i({asset:r,type:a,origin:l,networkClientId:c}),t.result=!0,o())}catch(e){return o(e)}},hookNames:{handleWatchAssetRequest:!0}};r.default=i}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/handlers/watch-asset.js"}],[82,{"./createMethodMiddleware":72},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0});var n=e("./createMethodMiddleware");Object.keys(n).forEach((function(e){"default"!==e&&"__esModule"!==e&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))}))}}},{package:"$root$",file:"app/scripts/lib/rpc-method-middleware/index.js"}],[83,{"../util":97,"@segment/loosely-validate-event":2146,buffer:2795,"is-retry-allowed":3436,lodash:3638,"remove-trailing-slash":4073,timers:4200},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t,n){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=c(e("remove-trailing-slash")),o=c(e("@segment/loosely-validate-event")),i=e("lodash"),a=c(e("is-retry-allowed")),l=e("../util");function c(e){return e&&e.__esModule?e:{default:e}}const d=()=>({});r.default=class{constructor(e,t={}){this.writeKey=e,this.host=(0,s.default)(t.host||"https://api.segment.io"),this.flushInterval=t.flushInterval||1e4,this.flushAt=t.flushAt||Math.max(t.flushAt,1)||20,this.queue=[],this.path="/v1/batch",this.maxQueueSize=460800,this.flushed=!1,this.retryCount=3,Object.defineProperty(this,"enable",{configurable:!1,writable:!1,enumerable:!0,value:!0})}_validate(e,t){(0,o.default)(e,t)}_message(e,t,r){return this._validate(t,e),this.enqueue(e,t,r),this}identify(e,t){return this._message("identify",e,t)}track(e,t){return this._message("track",e,t)}page(e,t){return this._message("page",e,t)}enqueue(e,t,r=d){if(!this.enable)return void n(r);const s={...t,type:e};if(s.context={...s.context,library:{name:"analytics-node"}},s.timestamp||(s.timestamp=new Date),s.messageId||(s.messageId=(0,l.generateRandomId)()),s.anonymousId&&!(0,i.isString)(s.anonymousId)&&(s.anonymousId=JSON.stringify(s.anonymousId)),s.userId&&!(0,i.isString)(s.userId)&&(s.userId=JSON.stringify(s.userId)),this.queue.push({message:s,callback:r}),!this.flushed)return this.flushed=!0,void this.flush();const o=this.queue.length>=this.flushAt,a=this.queue.reduce(((e,t)=>e+JSON.stringify(t).length),0)>=this.maxQueueSize;(o||a)&&this.flush(),this.flushInterval&&!this.timer&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))}flush(e=d){if(!this.enable)return n(e),Promise.resolve();if(this.timer&&(clearTimeout(this.timer),this.timer=null),!this.queue.length)return n(e),Promise.resolve();const r=this.queue.splice(0,this.flushAt),s=r.map((e=>e.callback)),o={batch:r.map((e=>e.message)),timestamp:new Date,sentAt:new Date},i={Authorization:`Basic ${t.from(this.writeKey,"utf8").toString("base64")}`};return this._sendRequest(`${this.host}${this.path}`,{method:"POST",body:JSON.stringify(o),headers:i},(t=>{n((()=>{s.forEach((e=>e(t,o))),e(t,o)}))}),0)}_retryRequest(e,t,r,n){const s=100*Math.pow(2,n);setTimeout((()=>{this._sendRequest(e,t,r,n+1)}),s)}async _sendRequest(e,t,r,n){return fetch(e,t).then((async s=>{if(s.ok)r();else if(this._isErrorRetryable({response:s})&&n<=this.retryCount)this._retryRequest(e,t,r,n);else{const e=new Error(s.statusText);r(e)}})).catch((s=>{this._isErrorRetryable(s)&&n<=this.retryCount?this._retryRequest(e,t,r,n):r(s)}))}_isErrorRetryable(e){return!!function(e){return!e.response&&Boolean(e.code)&&"ECONNABORTED"!==e.code&&(0,a.default)(e)}(e)||!!e.response&&(e.response.status>=500&&e.response.status<=599||429===e.response.status)}}}).call(this)}).call(this,e("buffer").Buffer,e("timers").setImmediate)}}},{package:"$root$",file:"app/scripts/lib/segment/analytics.js"}],[84,{"../../../../shared/constants/time":4366,"./analytics":83},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.segment=r.createSegmentMock=void 0;var n,s=e("../../../../shared/constants/time"),o=(n=e("./analytics"))&&n.__esModule?n:{default:n};const i="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP",a=undefined,l=5*s.SECOND,c=(e=a)=>{const t={queue:[],flush(){t.queue.forEach((([e,t])=>{t()})),t.queue=[]},track(r,n=(()=>undefined)){t.queue.push([r,n]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};r.createSegmentMock=c;r.segment=i?new o.default(i,{host:null,flushAt:a,flushInterval:l}):c(a)}}},{package:"$root$",file:"app/scripts/lib/segment/index.js"}],[88,{"./snap-keyring":90},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"getAccountsBySnapId",{enumerable:!0,get:function(){return n.getAccountsBySnapId}}),Object.defineProperty(r,"snapKeyringBuilder",{enumerable:!0,get:function(){return n.snapKeyringBuilder}});var n=e("./snap-keyring")}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/index.ts"}],[89,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.getSnapAndHardwareInfoForMetrics=async function(e,t,r){var n,s,o;if(!r)return{};const i=r.call("AccountsController:getSelectedAccount"),a=i.address,{keyring:l}=i.metadata;let c;var d;null!==(n=i.metadata.snap)&&void 0!==n&&n.id&&(c=r.call("SnapController:get",null===(d=i.metadata.snap)||void 0===d?void 0:d.id));return{account_type:await e(a),device_model:await t(a),account_hardware_type:await async function(){var e;return null!=l&&null!==(e=l.type)&&void 0!==e&&e.includes("Hardware")?l.type:undefined}(),account_snap_type:null===(s=c)||void 0===s?void 0:s.id,account_snap_version:null===(o=c)||void 0===o?void 0:o.version}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/metrics.ts"}],[9,{"../../../shared/constants/alarms":4341,"../../../shared/constants/app":4343,"../../../shared/constants/preferences":4360,"../../../shared/constants/time":4366,"../../../shared/modules/mv3.utils":4393,"../../../ui/helpers/utils/build-types":5166,"../metamask-controller":98,"@metamask/controller-utils":1094,"@metamask/obs-store":1523,events:3097,loglevel:3644,uuid:4259},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=m(e("events")),s=e("@metamask/obs-store"),o=e("uuid"),i=m(e("loglevel")),a=e("@metamask/controller-utils"),l=e("../metamask-controller"),c=e("../../../shared/constants/time"),d=e("../../../shared/constants/alarms"),u=e("../../../shared/modules/mv3.utils"),h=e("../../../ui/helpers/utils/build-types"),p=e("../../../shared/constants/app"),g=e("../../../shared/constants/preferences");function m(e){return e&&e.__esModule?e:{default:e}}class f extends n.default{constructor(e={}){const{addUnlockListener:t,isUnlocked:r,initState:n,onInactiveTimeout:o,preferencesStore:i,messenger:a,extension:l}=e;super(),this.extension=l,this.onInactiveTimeout=o||(()=>undefined),this.store=new s.ObservableStore({timeoutMinutes:g.DEFAULT_AUTO_LOCK_TIME_LIMIT,connectedStatusPopoverHasBeenShown:!0,defaultHomeActiveTabName:null,browserEnvironment:{},popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[],recoveryPhraseReminderHasBeenShown:!1,recoveryPhraseReminderLastShown:(new Date).getTime(),outdatedBrowserWarningLastShown:(new Date).getTime(),nftsDetectionNoticeDismissed:!1,showTestnetMessageInDropdown:!0,showBetaHeader:(0,h.isBeta)(),showPermissionsTour:!0,showNetworkBanner:!0,showAccountBanner:!0,trezorModel:null,currentPopupId:undefined,onboardingDate:null,newPrivacyPolicyToastClickedOrClosed:null,newPrivacyPolicyToastShownDate:null,hadAdvancedGasFeesSetPriorToMigration92_3:!1,...n,qrHardware:{},nftsDropdownState:{},usedNetworks:{"0x1":!0,"0x5":!0,"0x539":!0},surveyLinkLastClickedOrClosed:null,signatureSecurityAlertResponses:{},switchedNetworkDetails:null,switchedNetworkNeverShowMessage:!1,currentExtensionPopupId:0}),this.timer=null,this.isUnlocked=r,this.waitingForUnlock=[],t(this.handleUnlock.bind(this)),i.subscribe((({preferences:e})=>{this.store.getState().timeoutMinutes!==e.autoLockTimeLimit&&this._setInactiveTimeout(e.autoLockTimeLimit)})),a.subscribe("KeyringController:qrKeyringStateChange",(e=>this.store.updateState({qrHardware:e})));const{preferences:c}=i.getState();this._setInactiveTimeout(c.autoLockTimeLimit),this.messagingSystem=a,this._approvalRequestId=null}getUnlockPromise(e){return new Promise((t=>{this.isUnlocked()?t():this.waitForUnlock(t,e)}))}waitForUnlock(e,t){this.waitingForUnlock.push({resolve:e}),this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE),t&&this._requestApproval()}handleUnlock(){if(this.waitingForUnlock.length>0){for(;this.waitingForUnlock.length>0;)this.waitingForUnlock.shift().resolve();this.emit(l.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE)}this._acceptApproval()}setDefaultHomeActiveTabName(e){this.store.updateState({defaultHomeActiveTabName:e})}setConnectedStatusPopoverHasBeenShown(){this.store.updateState({connectedStatusPopoverHasBeenShown:!0})}setRecoveryPhraseReminderHasBeenShown(){this.store.updateState({recoveryPhraseReminderHasBeenShown:!0})}setSurveyLinkLastClickedOrClosed(e){this.store.updateState({surveyLinkLastClickedOrClosed:e})}setOnboardingDate(){this.store.updateState({onboardingDate:Date.now()})}setNewPrivacyPolicyToastClickedOrClosed(){this.store.updateState({newPrivacyPolicyToastClickedOrClosed:!0})}setNewPrivacyPolicyToastShownDate(e){this.store.updateState({newPrivacyPolicyToastShownDate:e})}setRecoveryPhraseReminderLastShown(e){this.store.updateState({recoveryPhraseReminderLastShown:e})}setTermsOfUseLastAgreed(e){this.store.updateState({termsOfUseLastAgreed:e})}setSnapsInstallPrivacyWarningShownStatus(e){this.store.updateState({snapsInstallPrivacyWarningShown:e})}setOutdatedBrowserWarningLastShown(e){this.store.updateState({outdatedBrowserWarningLastShown:e})}setLastActiveTime(){this._resetTimer()}_setInactiveTimeout(e){this.store.updateState({timeoutMinutes:e}),this._resetTimer()}_resetTimer(){const{timeoutMinutes:e}=this.store.getState();if(this.timer?clearTimeout(this.timer):u.isManifestV3&&this.extension.alarms.clear(d.AUTO_LOCK_TIMEOUT_ALARM),!e)return;const t=Number(e);u.isManifestV3?(this.extension.alarms.create(d.AUTO_LOCK_TIMEOUT_ALARM,{delayInMinutes:t,periodInMinutes:t}),this.extension.alarms.onAlarm.addListener((e=>{e.name===d.AUTO_LOCK_TIMEOUT_ALARM&&(this.onInactiveTimeout(),this.extension.alarms.clear(d.AUTO_LOCK_TIMEOUT_ALARM))}))):this.timer=setTimeout((()=>this.onInactiveTimeout()),t*c.MINUTE)}setBrowserEnvironment(e,t){this.store.updateState({browserEnvironment:{os:e,browser:t}})}addPollingToken(e,t){if(t!==p.POLLING_TOKEN_ENVIRONMENT_TYPES[p.ENVIRONMENT_TYPE_BACKGROUND]){const r=this.store.getState()[t];this.store.updateState({[t]:[...r,e]})}}removePollingToken(e,t){if(t!==p.POLLING_TOKEN_ENVIRONMENT_TYPES[p.ENVIRONMENT_TYPE_BACKGROUND]){const r=this.store.getState()[t];this.store.updateState({[t]:r.filter((t=>t!==e))})}}clearPollingTokens(){this.store.updateState({popupGasPollTokens:[],notificationGasPollTokens:[],fullScreenGasPollTokens:[]})}setShowTestnetMessageInDropdown(e){this.store.updateState({showTestnetMessageInDropdown:e})}setShowBetaHeader(e){this.store.updateState({showBetaHeader:e})}setShowPermissionsTour(e){this.store.updateState({showPermissionsTour:e})}setShowNetworkBanner(e){this.store.updateState({showNetworkBanner:e})}setShowAccountBanner(e){this.store.updateState({showAccountBanner:e})}setCurrentExtensionPopupId(e){this.store.updateState({currentExtensionPopupId:e})}setSwitchedNetworkDetails(e){this.store.updateState({switchedNetworkDetails:e})}clearSwitchedNetworkDetails(){this.store.updateState({switchedNetworkDetails:null})}setSwitchedNetworkNeverShowMessage(e){this.store.updateState({switchedNetworkDetails:null,switchedNetworkNeverShowMessage:e})}setTrezorModel(e){this.store.updateState({trezorModel:e})}updateNftDropDownState(e){this.store.updateState({nftsDropdownState:e})}setFirstTimeUsedNetwork(e){const t=this.store.getState(),{usedNetworks:r}=t;r[e]=!0,this.store.updateState({usedNetworks:r})}getSignatureSecurityAlertResponse(e){return this.store.getState().signatureSecurityAlertResponses[e]}addSignatureSecurityAlertResponse(e){const t=this.store.getState(),{signatureSecurityAlertResponses:r}=t;this.store.updateState({signatureSecurityAlertResponses:{...r,[e.securityAlertId]:e}})}setCurrentPopupId(e){this.store.updateState({currentPopupId:e})}getCurrentPopupId(){return this.store.getState().currentPopupId}_requestApproval(){this._approvalRequestId||(this._approvalRequestId=(0,o.v4)(),this.messagingSystem.call("ApprovalController:addRequest",{id:this._approvalRequestId,origin:p.ORIGIN_METAMASK,type:a.ApprovalType.Unlock},!0).catch((()=>{this._approvalRequestId=null})))}_acceptApproval(){if(this._approvalRequestId){try{this.messagingSystem.call("ApprovalController:acceptRequest",this._approvalRequestId)}catch(e){i.default.error("Failed to unlock approval request",e)}this._approvalRequestId=null}}}r.default=f}}},{package:"$root$",file:"app/scripts/controllers/app-state.js"}],[90,{"../../../../shared/constants/app":4343,"../../../../shared/constants/metametrics":4353,"../../../../ui/components/component-library/icon":4774,"../../translate":225,"./utils/isBlockedUrl":91,"./utils/showResult":92,"@metamask/eth-snap-keyring":1224,"webextension-polyfill":4322},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.snapKeyringBuilder=r.getAccountsBySnapId=void 0;var n,s=e("@metamask/eth-snap-keyring"),o=(n=e("webextension-polyfill"))&&n.__esModule?n:{default:n},i=e("../../../../shared/constants/metametrics"),a=e("../../../../shared/constants/app"),l=e("../../translate"),c=e("../../../../ui/components/component-library/icon"),d=e("./utils/isBlockedUrl"),u=e("./utils/showResult");r.getAccountsBySnapId=async(e,t)=>{const r=await e.getSnapKeyring();return await r.getAccountsBySnapId(t)};r.snapKeyringBuilder=(e,t,r,n,h,p,g)=>{const m=()=>new s.SnapKeyring(t(),{addressExists:async t=>(await e.call("KeyringController:getAccounts")).includes(t.toLowerCase()),redirectUser:async(t,r,n)=>{if(r.length>0||n.length>0){const s=await(0,d.isBlockedUrl)(r,(async()=>await e.call("PhishingController:maybeUpdateState")),(t=>e.call("PhishingController:testOrigin",t))),i=await e.call("ApprovalController:addRequest",{origin:t,requestData:{url:r,message:n,isBlockedUrl:s},type:a.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect},!0);Boolean(i)&&r.length>0?o.default.tabs.create({url:r}):console.log("User refused snap account redirection to:",r)}else console.log("Error occurred when redirecting snap account. url or message must be defined")},saveState:async()=>{await r()},addAccount:async(t,s,o)=>{const d=g(s),{id:h}=e.call("ApprovalController:startFlow"),m=e=>{p({event:e,category:i.MetaMetricsEventCategory.Accounts,properties:{account_type:i.MetaMetricsEventAccountType.Snap,snap_id:s,snap_name:d}})},f="https://support.metamask.io/hc/en-us/articles/360015289452-How-to-add-accounts-in-your-wallet";let y=!1;try{if(y=Boolean(await e.call("ApprovalController:addRequest",{origin:s,type:a.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation},!0)),!y)throw await o(y),new Error("User denied account creation");try{await o(y),await r(),n(t);const a=e.call("AccountsController:getAccountByAddress",t);if(!a)throw new Error(`Internal account not found for address: ${t}`);e.call("AccountsController:setSelectedAccount",a.id),m(i.MetaMetricsEventName.AddSnapAccountSuccessViewed),await(0,u.showSuccess)(e,s,{icon:c.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreated")},{message:(0,l.t)("snapAccountCreatedDescription"),address:t,learnMoreLink:f}),m(i.MetaMetricsEventName.AddSnapAccountSuccessClicked)}catch(t){const r=t.message;throw await(0,u.showError)(e,s,{icon:c.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreationFailed")},{message:(0,l.t)("snapAccountCreationFailedDescription",d),learnMoreLink:f,error:r}),m(i.MetaMetricsEventName.AccountAddFailed),new Error(`Error occurred while creating snap account: ${r}`)}}finally{y&&m(i.MetaMetricsEventName.AccountAdded),e.call("ApprovalController:endFlow",{id:h})}},removeAccount:async(t,n,s)=>{const o=g(n),{id:d}=e.call("ApprovalController:startFlow"),m="https://support.metamask.io/hc/en-us/articles/360057435092-How-to-remove-an-account-from-your-MetaMask-wallet",f=e=>{p({event:e,category:i.MetaMetricsEventCategory.Accounts,properties:{account_type:i.MetaMetricsEventAccountType.Snap,snap_id:n,snap_name:o}})};let y=!1;try{if(y=Boolean(await e.call("ApprovalController:addRequest",{origin:n,type:a.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval,requestData:{publicAddress:t}},!0)),!y)throw await s(y),new Error("User denied account removal");try{await h(t),await s(y),await r(),f(i.MetaMetricsEventName.RemoveSnapAccountSuccessViewed),await(0,u.showError)(e,n,{icon:c.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemoved")},{message:(0,l.t)("snapAccountRemovedDescription"),learnMoreLink:m}),f(i.MetaMetricsEventName.RemoveSnapAccountSuccessClicked)}catch(t){const r=t.message;throw await(0,u.showError)(e,n,{icon:c.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemovalFailed")},{message:(0,l.t)("snapAccountRemovalFailedDescription",o),learnMoreLink:m,error:r}),f(i.MetaMetricsEventName.AccountRemoveFailed),new Error(`Error occurred while removing snap account: ${r}`)}}finally{y&&f(i.MetaMetricsEventName.AccountRemoved),e.call("ApprovalController:endFlow",{id:d})}}});return m.type=s.SnapKeyring.type,m}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/snap-keyring.ts"}],[91,{"../../keyring-snaps-permissions":58},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.isBlockedUrl=void 0;var n=e("../../keyring-snaps-permissions");r.isBlockedUrl=async(e,t,r)=>{try{return!(0,n.isProtocolAllowed)(e)||(await t(),r(e).result)}catch(e){return console.error("Invalid URL passed into snap-keyring:",e),!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/isBlockedUrl.ts"}],[92,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.showSuccess=r.showError=void 0;const n=e=>({name:"SnapAuthorshipHeader",key:"snapHeader",properties:{snapId:e}});r.showError=(e,t,r,s)=>e.call("ApprovalController:showError",{header:[n(t)],title:r.title,icon:r.icon,error:{key:"snapAccountErrorMessage",name:"SnapAccountErrorMessage",properties:s}});r.showSuccess=(e,t,r,s)=>e.call("ApprovalController:showSuccess",{header:[n(t)],title:r.title,icon:r.icon,message:{key:"snapAccountSuccessMessage",name:"SnapAccountSuccessMessage",properties:s}})}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/showResult.ts"}],[94,{"../../../../shared/constants/app":4343,"../../../../shared/constants/gas":4348,"../../../../shared/constants/metametrics":4353,"../../../../shared/constants/transaction":4368,"../../../../shared/lib/transactions-controller-utils":4377,"../../../../shared/modules/conversion.utils":4383,"../../../../shared/modules/metametrics":4392,"../../../../shared/modules/transaction.utils":4405,"../../../../ui/helpers/utils/metrics":5176,"../snap-keyring/metrics":89,"@metamask/eth-query":1211,"@metamask/transaction-controller":2025,"bignumber.js":2700,"ethereumjs-util":3057},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.handleTransactionSubmitted=r.handleTransactionRejected=r.handleTransactionFailed=r.handleTransactionDropped=r.handleTransactionConfirmed=r.handleTransactionApproved=r.handleTransactionAdded=r.handlePostTransactionBalanceUpdate=r.createTransactionEventFragmentWithTxId=r.METRICS_STATUS_FAILED=void 0;var n,s=e("ethereumjs-util"),o=(n=e("@metamask/eth-query"))&&n.__esModule?n:{default:n},i=e("bignumber.js"),a=e("@metamask/transaction-controller"),l=e("../../../../shared/constants/app"),c=e("../../../../shared/modules/transaction.utils"),d=e("../../../../shared/modules/conversion.utils"),u=e("../../../../shared/constants/transaction"),h=e("../../../../shared/constants/metametrics"),p=e("../../../../shared/constants/gas"),g=e("../../../../shared/lib/transactions-controller-utils"),m=e("../../../../ui/helpers/utils/metrics"),f=e("../../../../shared/modules/metametrics"),y=e("../snap-keyring/metrics");const b=r.METRICS_STATUS_FAILED="failed on-chain";r.handleTransactionAdded=async(e,t)=>{if(!t.transactionMeta)return;const{properties:r,sensitiveProperties:n}=await _({transactionEventPayload:t,transactionMetricsRequest:e});w({eventName:u.TransactionMetaMetricsEvent.added,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:r,sensitiveProperties:n}})};r.handleTransactionApproved=async(e,t)=>{t.transactionMeta&&await C({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionFailed=async(e,t)=>{if(!t.transactionMeta)return;const r={};t.error&&(r.error=t.error),await C({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:r,transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionConfirmed=async(e,t)=>{if(0===Object.keys(t).length)return;const r={},n={...t},{txReceipt:s}=n;r.gas_used=null==s?void 0:s.gasUsed;const{submittedTime:o}=n;o&&(r.completion_time=function(e){return Math.round((Date.now()-e)/1e3).toString()}(o)),"0x0"===(null==s?void 0:s.status)&&(r.status=b),await C({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:r,transactionEventPayload:{actionId:n.actionId,transactionMeta:n},transactionMetricsRequest:e})};r.handleTransactionDropped=async(e,t)=>{if(!t.transactionMeta)return;await C({eventName:u.TransactionMetaMetricsEvent.finalized,extraParams:{dropped:!0},transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionRejected=async(e,t)=>{t.transactionMeta&&await C({eventName:u.TransactionMetaMetricsEvent.rejected,transactionEventPayload:t,transactionMetricsRequest:e})};r.handleTransactionSubmitted=async(e,t)=>{if(!t.transactionMeta)return;const{properties:r,sensitiveProperties:n}=await _({transactionEventPayload:t,transactionMetricsRequest:e});w({eventName:u.TransactionMetaMetricsEvent.submitted,transactionEventPayload:t,transactionMetricsRequest:e,payload:{properties:r,sensitiveProperties:n}})};r.createTransactionEventFragmentWithTxId=async(e,{transactionId:t,actionId:r})=>{const n={...e.getTransaction(t),actionId:r},{properties:s,sensitiveProperties:o}=await _({transactionEventPayload:{transactionMeta:n},transactionMetricsRequest:e});w({eventName:u.TransactionMetaMetricsEvent.approved,transactionEventPayload:{actionId:n.actionId,transactionMeta:n},transactionMetricsRequest:e,payload:{properties:s,sensitiveProperties:o}})};function w({eventName:e,transactionEventPayload:{transactionMeta:t,actionId:r},transactionMetricsRequest:n,payload:s}){if(function(e,t,r){const n=v(t,r.id);return void 0!==e(n)}(n.getEventFragmentById,e,t))return;const o=v(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.added:n.createEventFragment({category:h.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.added,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:s.properties,sensitiveProperties:s.sensitiveProperties,actionId:r,uniqueIdentifier:o,persist:!0});break;case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:n.createEventFragment({category:h.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.approved,failureEvent:u.TransactionMetaMetricsEvent.rejected,properties:s.properties,sensitiveProperties:s.sensitiveProperties,actionId:r,uniqueIdentifier:o,persist:!0});break;case u.TransactionMetaMetricsEvent.submitted:n.createEventFragment({category:h.MetaMetricsEventCategory.Transactions,initialEvent:u.TransactionMetaMetricsEvent.submitted,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:s.properties,sensitiveProperties:s.sensitiveProperties,actionId:r,uniqueIdentifier:o,persist:!0});break;case u.TransactionMetaMetricsEvent.finalized:n.createEventFragment({category:h.MetaMetricsEventCategory.Transactions,successEvent:u.TransactionMetaMetricsEvent.finalized,properties:s.properties,sensitiveProperties:s.sensitiveProperties,actionId:r,uniqueIdentifier:o,persist:!0})}}async function C({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r,extraParams:n={}}){const{properties:s,sensitiveProperties:o}=await _({transactionEventPayload:t,transactionMetricsRequest:r,extraParams:n});w({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r,payload:{properties:s,sensitiveProperties:o}}),function({eventName:e,transactionEventPayload:{transactionMeta:t},transactionMetricsRequest:r,payload:n}){const s=v(e,t.id);switch(e){case u.TransactionMetaMetricsEvent.approved:case u.TransactionMetaMetricsEvent.rejected:case u.TransactionMetaMetricsEvent.finalized:r.updateEventFragment(s,{properties:n.properties,sensitiveProperties:n.sensitiveProperties})}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r,payload:{properties:s,sensitiveProperties:o}}),function({eventName:e,transactionMetricsRequest:t,transactionEventPayload:{transactionMeta:r}}){const n=v(e,r.id);switch(e){case u.TransactionMetaMetricsEvent.approved:t.finalizeEventFragment(n);break;case u.TransactionMetaMetricsEvent.rejected:t.finalizeEventFragment(n,{abandoned:!0});break;case u.TransactionMetaMetricsEvent.finalized:t.finalizeEventFragment(n)}}({eventName:e,transactionEventPayload:t,transactionMetricsRequest:r})}function v(e,t){return`transaction-${e===u.TransactionMetaMetricsEvent.finalized||e===u.TransactionMetaMetricsEvent.submitted?"submitted":"added"}-${t}`}async function _({transactionEventPayload:{transactionMeta:e},transactionMetricsRequest:t,extraParams:r={}}){var n;const{type:b,time:w,status:C,chainId:v,origin:_,txParams:{gasPrice:S,gas:k,maxFeePerGas:T,maxPriorityFeePerGas:E,estimateSuggested:A,estimateUsed:M},defaultGasEstimates:P,originalType:N,replacedById:I,customTokenAmount:R,dappProposedTokenAmount:x,currentTokenBalance:O,originalApprovalAmount:L,finalApprovalAmount:D,contractMethodName:U,securityProviderResponse:j,simulationFails:F}=e,B=new o.default(t.provider),q=_===l.ORIGIN_METAMASK?"user":"dapp",{assetType:K,tokenStandard:$}=await(0,c.determineTransactionAssetType)(e,B,t.getTokenStandardAndDetails),H={};if((0,c.isEIP1559Transaction)(e)?(H.max_fee_per_gas=T,H.max_priority_fee_per_gas=E):H.gas_price=S,P){var G,W;const{estimateType:r}=P;if(r){var z,V;H.default_estimate=r;let n=null===(z=e.defaultGasEstimates)||void 0===z?void 0:z.maxFeePerGas,s=null===(V=e.defaultGasEstimates)||void 0===V?void 0:V.maxPriorityFeePerGas;if([p.GasRecommendations.low,p.GasRecommendations.medium,p.GasRecommendations.high].includes(r)){var Y,Q;const{gasFeeEstimates:e}=await t.getEIP1559GasFeeEstimates();var J,X;if(null!=e&&null!==(Y=e[r])&&void 0!==Y&&Y.suggestedMaxFeePerGas)n=null===(J=e[r])||void 0===J?void 0:J.suggestedMaxFeePerGas,H.default_max_fee_per_gas=n;if(null!=e&&null!==(Q=e[r])&&void 0!==Q&&Q.suggestedMaxPriorityFeePerGas)s=null===(X=e[r])||void 0===X?void 0:X.suggestedMaxPriorityFeePerGas,H.default_max_priority_fee_per_gas=s}}null!==(G=e.defaultGasEstimates)&&void 0!==G&&G.gas&&(H.default_gas=e.defaultGasEstimates.gas),null!==(W=e.defaultGasEstimates)&&void 0!==W&&W.gasPrice&&(H.default_gas_price=e.defaultGasEstimates.gasPrice)}A&&(H.estimate_suggested=A),M&&(H.estimate_used=M),null!=r&&r.gas_used&&(H.gas_used=r.gas_used);const Z=function(e){const t={};for(const r in e)(0,s.isHexString)(e[r])?t[r]=(0,d.hexWEIToDecGWEI)(e[r]):t[r]=e[r];return t}(H);let ee="0";e.txParams.maxFeePerGas&&(ee="2");const te=b&&[a.TransactionType.contractInteraction,a.TransactionType.tokenMethodApprove,a.TransactionType.tokenMethodIncreaseAllowance,a.TransactionType.tokenMethodSafeTransferFrom,a.TransactionType.tokenMethodSetApprovalForAll,a.TransactionType.tokenMethodTransfer,a.TransactionType.tokenMethodTransferFrom,a.TransactionType.swap,a.TransactionType.swapApproval].includes(b),re="Approve";let ne,se,oe,ie,ae=a.TransactionType.simpleSend;b===a.TransactionType.cancel?ae=a.TransactionType.cancel:b===a.TransactionType.retry&&N?ae=N:b===a.TransactionType.deployContract?ae=a.TransactionType.deployContract:te&&(ae=a.TransactionType.contractInteraction,se=U,se===re&&$===u.TokenStandard.ERC20&&("0"===x||"0"===R?ne=u.TransactionApprovalAmountType.revoke:R&&R!==x?ne=u.TransactionApprovalAmountType.custom:x&&(ne=u.TransactionApprovalAmountType.dappProposed),oe=function(e,t,r){if(e===u.TransactionApprovalAmountType.custom&&t&&r)return`${new i.BigNumber(t,10).div(r,10).times(100).round(2)}`;return null}(ne,L,D),ie=function(e,t,r){if((e===u.TransactionApprovalAmountType.custom||e===u.TransactionApprovalAmountType.dappProposed)&&t&&r)return`${new i.BigNumber(t,16).div(r,10).times(100).round(2)}`;return null}(ne,x,O)));const le=t.getTransaction(I),ce={RETRY:a.TransactionType.retry,CANCEL:a.TransactionType.cancel,SAME_NONCE:"other"};let de;null!=r&&r.dropped&&(de=ce.SAME_NONCE,(null==le?void 0:le.type)===a.TransactionType.cancel?de=ce.CANCEL:(null==le?void 0:le.type)===a.TransactionType.retry&&(de=ce.RETRY));const ue=[];1===(null==j?void 0:j.flagAsDangerous)?ue.push(h.MetaMetricsEventUiCustomization.FlaggedAsMalicious):2===(null==j?void 0:j.flagAsDangerous)&&ue.push(h.MetaMetricsEventUiCustomization.FlaggedAsSafetyUnknown);const he=(0,m.getBlockaidMetricsProps)(e);(null==he||null===(n=he.ui_customizations)||void 0===n?void 0:n.length)>0&&ue.push(...he.ui_customizations),F&&ue.push(h.MetaMetricsEventUiCustomization.GasEstimationFailed);const pe=(0,f.getSmartTransactionMetricsProperties)(t,e);let ge={chain_id:v,referrer:_,source:q,status:C,network:`${parseInt(v,16)}`,eip_1559_version:ee,gas_edit_type:"none",gas_edit_attempted:"none",gas_estimation_failed:Boolean(F),account_type:await t.getAccountType(t.getSelectedAddress()),device_model:await t.getDeviceModel(t.getSelectedAddress()),asset_type:K,token_standard:$,transaction_type:ae,transaction_speed_up:b===a.TransactionType.retry,...he,ui_customizations:ue.length>0?ue:null,...pe};const me=await(0,y.getSnapAndHardwareInfoForMetrics)(t.getAccountType,t.getDeviceModel,t.snapAndHardwareMessenger);Object.assign(ge,me),se===re&&(ge={...ge,transaction_approval_amount_type:ne});let fe={transaction_envelope_type:(0,c.isEIP1559Transaction)(e)?g.TRANSACTION_ENVELOPE_TYPE_NAMES.FEE_MARKET:g.TRANSACTION_ENVELOPE_TYPE_NAMES.LEGACY,first_seen:w,gas_limit:k,transaction_contract_method:se,transaction_replaced:de,...r,...Z};return se===re&&(fe={...fe,transaction_approval_amount_vs_balance_ratio:ie,transaction_approval_amount_vs_proposed_ratio:oe}),{properties:ge,sensitiveProperties:fe}}r.handlePostTransactionBalanceUpdate=async({getParticipateInMetrics:e,trackEvent:t},{transactionMeta:r,approvalTransactionMeta:n})=>{var s;if(e()&&r.swapMetaData)if("0x0"===(null===(s=r.txReceipt)||void 0===s?void 0:s.status))t({event:"Swap Failed",sensitiveProperties:{...r.swapMetaData},category:h.MetaMetricsEventCategory.Swaps});else{var o;const e=(0,g.getSwapsTokensReceivedFromTxMeta)(r.destinationTokenSymbol,r,r.destinationTokenAddress,r.txParams.from,r.destinationTokenDecimals,n,r.chainId),s=e?`${new i.BigNumber(e,10).div(r.swapMetaData.token_to_amount,10).times(100).round(2)}%`:null,a=null!==(o=r.txReceipt)&&void 0!==o&&o.gasUsed&&r.swapMetaData.estimated_gas?`${new i.BigNumber(r.txReceipt.gasUsed,16).div(r.swapMetaData.estimated_gas,10).times(100).round(2)}%`:null,l=function(e,t){var r,n;let s="0x0";null!=t&&t.txReceipt&&(s=(0,g.calcGasTotal)(t.txReceipt.gasUsed,t.txReceipt.effectiveGasPrice));const o=(0,g.calcGasTotal)(null===(r=e.txReceipt)||void 0===r?void 0:r.gasUsed,null===(n=e.txReceipt)||void 0===n?void 0:n.effectiveGasPrice),a=new i.BigNumber(o,16).plus(s,16).toString(16);return{approvalGasCostInEth:Number((0,d.hexWEIToDecETH)(s)),tradeGasCostInEth:Number((0,d.hexWEIToDecETH)(o)),tradeAndApprovalGasCostInEth:Number((0,d.hexWEIToDecETH)(a))}}(r,n);t({event:h.MetaMetricsEventName.SwapCompleted,category:h.MetaMetricsEventCategory.Swaps,sensitiveProperties:{...r.swapMetaData,token_to_amount_received:e,quote_vs_executionRatio:s,estimated_vs_used_gasRatio:a,approval_gas_cost_in_eth:l.approvalGasCostInEth,trade_gas_cost_in_eth:l.tradeGasCostInEth,trade_and_approval_gas_cost_in_eth:l.tradeAndApprovalGasCostInEth,token_to_amount:r.swapMetaData.token_to_amount.toString(10)}})}}}}},{package:"$root$",file:"app/scripts/lib/transaction/metrics.ts"}],[95,{"../../../../shared/constants/app":4343,"../../../../shared/constants/smartTransactions":4362,"../../../../shared/modules/conversion.utils":4383,"@metamask/smart-transactions-controller/dist/types":1659,loglevel:3644},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.submitSmartTransactionHook=void 0;var n,s=e("@metamask/smart-transactions-controller/dist/types"),o=(n=e("loglevel"))&&n.__esModule?n:{default:n},i=e("../../../../shared/modules/conversion.utils"),a=e("../../../../shared/constants/smartTransactions"),l=e("../../../../shared/constants/app");function c(e,t){u(e,t),t.add(e)}function d(e,t,r){u(e,t),t.set(e,r)}function u(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function h(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function p(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,m(e,t,"get"))}function g(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,m(e,t,"set"),r),r}function m(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}var f=new WeakMap,y=new WeakMap,b=new WeakMap,w=new WeakMap,C=new WeakMap,v=new WeakMap,_=new WeakMap,S=new WeakMap,k=new WeakMap,T=new WeakMap,E=new WeakMap,A=new WeakSet,M=new WeakSet,P=new WeakSet,N=new WeakSet,I=new WeakSet,R=new WeakSet,x=new WeakSet,O=new WeakSet;class L{constructor(e){c(this,O),c(this,x),c(this,R),c(this,I),c(this,N),c(this,P),c(this,M),c(this,A),d(this,f,{writable:!0,value:void 0}),d(this,y,{writable:!0,value:void 0}),d(this,b,{writable:!0,value:void 0}),d(this,w,{writable:!0,value:void 0}),d(this,C,{writable:!0,value:void 0}),d(this,v,{writable:!0,value:void 0}),d(this,_,{writable:!0,value:void 0}),d(this,S,{writable:!0,value:void 0}),d(this,k,{writable:!0,value:void 0}),d(this,T,{writable:!0,value:void 0}),d(this,E,{writable:!0,value:void 0});const{transactionMeta:t,smartTransactionsController:r,transactionController:n,isSmartTransaction:s,controllerMessenger:o,featureFlags:i}=e;g(this,y,""),g(this,f,!1),g(this,T,t),g(this,S,r),g(this,k,n),g(this,_,s),g(this,w,o),g(this,C,i),g(this,v,t.origin!==l.ORIGIN_METAMASK),g(this,b,t.chainId),g(this,E,t.txParams)}async submit(){const e={transactionHash:undefined};if(!p(this,_))return e;const{id:t}=await p(this,w).call("ApprovalController:startFlow");let r;g(this,y,t);try{r=await p(this,S).getFees({...p(this,E),chainId:p(this,b)},undefined)}catch(t){return o.default.error("Error in smart transaction publish hook, falling back to regular transaction submission",t),h(this,A,D).call(this),e}try{var n;const e=await h(this,R,q).call(this,{getFeesResponse:r}),t=null==e?void 0:e.uuid;if(!t)throw new Error("No smart transaction UUID");const s=null===(n=p(this,C))||void 0===n||null===(n=n.smartTransactions)||void 0===n?void 0:n.returnTxHashAsap;let o;if(h(this,M,U).call(this,{uuid:t}),h(this,N,F).call(this,{uuid:t}),o=s&&null!=e&&e.txHash?e.txHash:await h(this,I,B).call(this,{uuid:t}),null===o)throw new Error("Transaction does not have a transaction hash, there was a problem");return{transactionHash:o}}catch(e){throw o.default.error("Error in smart transaction publish hook",e),h(this,A,D).call(this),e}}}function D(){p(this,f)||(g(this,f,!0),p(this,w).call("ApprovalController:endFlow",{id:p(this,y)}))}function U({uuid:e}){const t=()=>{h(this,A,D).call(this)};p(this,w).call("ApprovalController:addRequest",{id:p(this,y),origin:origin,type:l.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage,requestState:{smartTransaction:{status:s.SmartTransactionStatuses.PENDING,creationTime:Date.now(),uuid:e},isDapp:p(this,v),txId:p(this,T).id}},!0).then(t,t)}async function j({smartTransaction:e}){return await p(this,w).call("ApprovalController:updateRequestState",{id:p(this,y),requestState:{smartTransaction:e,isDapp:p(this,v),txId:p(this,T).id}})}async function F({uuid:e}){p(this,S).eventEmitter.on(`${e}:smartTransaction`,(async e=>{const{status:t}=e;t&&t!==s.SmartTransactionStatuses.PENDING&&(p(this,f)||await h(this,P,j).call(this,{smartTransaction:e}))}))}function B({uuid:e}){return new Promise((t=>{p(this,S).eventEmitter.on(`${e}:smartTransaction`,(async e=>{const{status:r,statusMetadata:n}=e;r&&r!==s.SmartTransactionStatuses.PENDING&&(o.default.debug("Smart Transaction: ",e),null!=n&&n.minedHash?(o.default.debug("Smart Transaction - Received tx hash: ",null==n?void 0:n.minedHash),t(n.minedHash)):t(null))}))}))}async function q({getFeesResponse:e}){var t,r;const n=await h(this,O,$).call(this,(null===(t=e.tradeTxFees)||void 0===t?void 0:t.fees)??[],!1),s=await h(this,O,$).call(this,(null===(r=e.tradeTxFees)||void 0===r?void 0:r.cancelFees)||[],!0);return await p(this,S).submitSignedTransactions({signedTransactions:n,signedCanceledTransactions:s,txParams:p(this,E),transactionMeta:p(this,T)})}function K(e,t){const r={...p(this,E),maxFeePerGas:`0x${(0,i.decimalToHex)(e.maxFeePerGas)}`,maxPriorityFeePerGas:`0x${(0,i.decimalToHex)(e.maxPriorityFeePerGas)}`,gas:t?`0x${(0,i.decimalToHex)(a.CANCEL_GAS_LIMIT_DEC)}`:p(this,E).gas};return t&&(r.to=r.from,r.data="0x"),r}async function $(e,t){const r=e.map((e=>h(this,x,K).call(this,e,t))).map((e=>({...e,chainId:e.chainId||p(this,b)})));return await p(this,k).approveTransactionsWithSameNonce(r,{hasNonce:!0})}r.submitSmartTransactionHook=e=>new L(e).submit()}}},{package:"$root$",file:"app/scripts/lib/transaction/smart-transactions.ts"}],[96,{"../../../../shared/constants/security-provider":4361,"../ppom/ppom-middleware":69,"../ppom/ppom-util":70,"@metamask/keyring-api":1377,"@metamask/transaction-controller":2025,"@sentry/browser":2179,"ethereumjs-util":3057,uuid:4259},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.addDappTransaction=async function(e){const{dappRequest:t}=e,{id:r,method:n,origin:s}=t,{securityAlertResponse:o}=t,i={actionId:r,method:n,origin:s,requireApproval:!0,securityAlertResponse:o},{waitForHash:a}=await h({...e,transactionOptions:i});return await a()},r.addTransaction=async function(e,t){const{transactionParams:r,transactionOptions:n,ppomController:s,securityAlertsEnabled:i,chainId:p}=e,g=n.type&&u.includes(n.type);if(i&&l.SUPPORTED_CHAIN_IDS.includes(p)&&!g)try{const i=(0,d.normalizePPOMRequest)({method:"eth_sendTransaction",id:"actionId"in n?n.actionId:"",origin:"origin"in n?n.origin:"",params:[{from:r.from,to:r.to,value:r.value,data:r.data}]}),l=(0,a.v4)();s.usePPOM((async e=>{try{return await e.validateJsonRpc(i)}catch(e){(0,o.captureException)(e);const t=e;console.error("Error validating JSON RPC using PPOM: ",e);return{securityAlertId:l,result_type:c.BlockaidResultType.Errored,reason:c.BlockaidReason.errored,description:`${t.name}: ${t.message}`}}})).then((r=>{null==t||t(e.transactionOptions,{...r,securityAlertId:l})})),e.transactionOptions.securityAlertResponse={reason:c.BlockaidResultType.Loading,result_type:c.BlockaidReason.inProgress,securityAlertId:l}}catch(e){console.error("Error validating JSON RPC using PPOM: ",e),(0,o.captureException)(e)}const{transactionMeta:m,waitForHash:f}=await h(e);if(!e.waitForSubmit)return f().catch((()=>{})),m;const y=await f();return function(e,t){return t.state.transactions.find((t=>t.hash===e))}(y,e.transactionController)};var n=e("@metamask/keyring-api"),s=e("@metamask/transaction-controller"),o=e("@sentry/browser"),i=e("ethereumjs-util"),a=e("uuid"),l=e("../ppom/ppom-middleware"),c=e("../../../../shared/constants/security-provider"),d=e("../ppom/ppom-util");const u=[s.TransactionType.swap,s.TransactionType.swapApproval];async function h(e){const{selectedAccount:t}=e;return t.type===n.EthAccountType.Erc4337?async function(e){var t;const{networkClientId:r,transactionController:n,transactionOptions:s,transactionParams:o,userOperationController:a}=e,{maxFeePerGas:l,maxPriorityFeePerGas:c}=o,{origin:d,requireApproval:u,type:h}=s,g={...o,maxFeePerGas:(0,i.addHexPrefix)(l),maxPriorityFeePerGas:(0,i.addHexPrefix)(c)},m=null==s||null===(t=s.swaps)||void 0===t?void 0:t.meta;null!=m&&m.type&&delete m.type;const f={networkClientId:r,origin:d,requireApproval:u,swaps:m,type:h},y=await a.addUserOperationFromTransaction(g,f);a.startPollingByNetworkClientId(r);return{transactionMeta:p(y.id,n),waitForHash:y.transactionHash}}(e):async function(e){const{transactionController:t,transactionOptions:r,transactionParams:n,networkClientId:s}=e,{result:o,transactionMeta:i}=await t.addTransaction(n,{...r});return{transactionMeta:i,waitForHash:()=>o}}(e)}function p(e,t){return t.state.transactions.find((t=>t.id===e))}}}},{package:"$root$",file:"app/scripts/lib/transaction/util.ts"}],[98,{"../../shared/constants/app":4343,"../../shared/constants/hardware-wallets":4349,"../../shared/constants/keyring":4350,"../../shared/constants/logs":4352,"../../shared/constants/metametrics":4353,"../../shared/constants/methods-tags":4354,"../../shared/constants/network":4355,"../../shared/constants/permissions":4359,"../../shared/constants/smartTransactions":4362,"../../shared/constants/swaps":4364,"../../shared/constants/time":4366,"../../shared/constants/tokens":4367,"../../shared/constants/transaction":4368,"../../shared/lib/metamask-controller-utils":4372,"../../shared/lib/token-util":4376,"../../shared/modules/mv3.utils":4393,"../../shared/modules/network.utils":4394,"../../shared/modules/selectors":4400,"../../shared/modules/string-utils":4403,"../../shared/modules/transaction.utils":4405,"../../shared/notifications":4407,"./controllers/account-order":6,"./controllers/alert":7,"./controllers/app-metadata":8,"./controllers/app-state":9,"./controllers/authentication/authentication-controller":11,"./controllers/decrypt-message":13,"./controllers/encryption-public-key":14,"./controllers/metametrics":15,"./controllers/network-order":16,"./controllers/onboarding":17,"./controllers/permissions":21,"./controllers/preferences":24,"./controllers/swaps":25,"./controllers/user-storage/user-storage-controller":29,"./detect-multiple-instances":30,"./lib/AccountIdentitiesPetnamesBridge":33,"./lib/AddressBookPetnamesBridge":34,"./lib/ComposableObservableStore":35,"./lib/SnapsNameProvider":36,"./lib/WeakRefObjectMap":37,"./lib/account-tracker":38,"./lib/backup":39,"./lib/createDupeReqFilterStream":40,"./lib/createLoggerMiddleware":41,"./lib/createMetaRPCHandler":42,"./lib/createMetamaskMiddleware":43,"./lib/createOnboardingMiddleware":44,"./lib/createOriginMiddleware":45,"./lib/createRPCMethodTrackingMiddleware":46,"./lib/createTabIdMiddleware":48,"./lib/encryptor-factory":49,"./lib/hardware-keyring-builder-factory":57,"./lib/keyring-snaps-permissions":58,"./lib/offscreen-bridge/lattice-offscreen-keyring":65,"./lib/offscreen-bridge/ledger-offscreen-bridge":66,"./lib/offscreen-bridge/trezor-offscreen-bridge":67,"./lib/ppom/indexed-db-backend":68,"./lib/ppom/ppom":71,"./lib/ppom/ppom-middleware":69,"./lib/rpc-method-middleware":82,"./lib/segment":84,"./lib/snap-keyring":88,"./lib/stream-utils":93,"./lib/transaction/metrics":94,"./lib/transaction/smart-transactions":95,"./lib/transaction/util":96,"./lib/util":97,"./snaps/preinstalled-snaps":224,"./translate":225,"@keystonehq/metamask-airgapped-keyring":561,"@metamask/accounts-controller":1018,"@metamask/address-book-controller":1021,"@metamask/announcement-controller":1029,"@metamask/approval-controller":1038,"@metamask/assets-controllers":1063,"@metamask/base-controller":1085,"@metamask/controller-utils":1094,"@metamask/ens-controller":1118,"@metamask/eth-json-rpc-filters":1136,"@metamask/eth-json-rpc-filters/subscriptionManager":1146,"@metamask/eth-json-rpc-middleware":1169,"@metamask/eth-keyring-controller":1184,"@metamask/eth-ledger-bridge-keyring":1207,"@metamask/eth-query":1211,"@metamask/eth-trezor-keyring":1269,"@metamask/ethjs-query":1295,"@metamask/gas-fee-controller":1303,"@metamask/keyring-controller":1407,"@metamask/logging-controller":1409,"@metamask/name-controller":1444,"@metamask/network-controller":1459,"@metamask/notification-controller":1475,"@metamask/obs-store":1523,"@metamask/obs-store/dist/asStream":1522,"@metamask/permission-controller":1539,"@metamask/permission-log-controller":1550,"@metamask/phishing-controller":1552,"@metamask/ppom-validator":1591,"@metamask/queued-request-controller":1608,"@metamask/rate-limit-controller":1616,"@metamask/scure-bip39/dist/wordlists/english":1628,"@metamask/selected-network-controller":1640,"@metamask/signature-controller":1648,"@metamask/smart-transactions-controller":1658,"@metamask/snaps-controllers":1874,"@metamask/snaps-rpc-methods":1952,"@metamask/snaps-utils":1989,"@metamask/transaction-controller":2025,"@metamask/user-operation-controller":2044,"@sentry/browser":2179,"await-semaphore":2689,buffer:2795,"eth-lattice-keyring":2995,"eth-rpc-errors":3026,events:3097,"json-rpc-engine":3457,"json-rpc-middleware-stream":3462,lodash:3638,loglevel:3644,nanoid:3731,pump:3852},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){(function(t){(function(){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.METAMASK_CONTROLLER_EVENTS=void 0;var n=yt(e("events")),s=yt(e("pump")),o=e("@metamask/assets-controllers"),i=e("@metamask/obs-store"),a=e("@metamask/obs-store/dist/asStream"),l=e("json-rpc-engine"),c=e("json-rpc-middleware-stream"),d=e("@metamask/eth-json-rpc-middleware"),u=e("lodash"),h=e("@metamask/eth-keyring-controller"),p=e("@metamask/keyring-controller"),g=yt(e("@metamask/eth-json-rpc-filters")),m=yt(e("@metamask/eth-json-rpc-filters/subscriptionManager")),f=e("eth-rpc-errors"),y=e("await-semaphore"),b=yt(e("loglevel")),w=e("@metamask/eth-trezor-keyring"),C=e("@metamask/eth-ledger-bridge-keyring"),v=yt(e("eth-lattice-keyring")),_=e("@keystonehq/metamask-airgapped-keyring"),S=yt(e("@metamask/eth-query")),k=yt(e("@metamask/ethjs-query")),T=yt(e("nanoid")),E=e("@sentry/browser"),A=e("@metamask/address-book-controller"),M=e("@metamask/approval-controller"),P=e("@metamask/base-controller"),N=e("@metamask/ens-controller"),I=e("@metamask/phishing-controller"),R=e("@metamask/announcement-controller"),x=e("@metamask/network-controller"),O=e("@metamask/gas-fee-controller"),L=e("@metamask/permission-controller"),D=yt(e("@metamask/smart-transactions-controller")),U=e("@metamask/selected-network-controller"),j=e("@metamask/logging-controller"),F=e("@metamask/permission-log-controller"),B=e("@metamask/rate-limit-controller"),q=e("@metamask/notification-controller"),K=e("@metamask/snaps-controllers"),$=e("@metamask/snaps-rpc-methods"),H=e("@metamask/accounts-controller"),G=e("@metamask/signature-controller"),W=e("@metamask/ppom-validator"),z=e("@metamask/controller-utils"),V=e("@metamask/scure-bip39/dist/wordlists/english"),Y=e("@metamask/name-controller"),Q=e("@metamask/queued-request-controller"),J=e("@metamask/user-operation-controller"),X=e("@metamask/transaction-controller"),Z=e("@metamask/snaps-utils"),ee=e("../../shared/constants/methods-tags"),te=e("../../shared/constants/transaction"),re=e("../../shared/constants/swaps"),ne=e("../../shared/constants/network"),se=e("../../shared/constants/smartTransactions"),oe=e("../../shared/constants/hardware-wallets"),ie=e("../../shared/constants/keyring"),ae=e("../../shared/constants/permissions"),le=e("../../shared/notifications"),ce=e("../../shared/constants/time"),de=e("../../shared/constants/app"),ue=e("../../shared/constants/metametrics"),he=e("../../shared/constants/logs"),pe=e("../../shared/lib/token-util"),ge=e("../../shared/modules/string-utils"),me=e("../../shared/modules/transaction.utils"),fe=e("../../shared/constants/tokens"),ye=e("../../shared/lib/metamask-controller-utils"),be=e("../../shared/modules/mv3.utils"),we=e("../../shared/modules/network.utils"),Ce=e("../../shared/modules/selectors"),ve=e("./lib/transaction/metrics"),_e=e("./lib/transaction/smart-transactions"),Se=e("./lib/keyring-snaps-permissions"),ke=e("./lib/SnapsNameProvider"),Te=e("./lib/AddressBookPetnamesBridge"),Ee=e("./lib/AccountIdentitiesPetnamesBridge"),Ae=e("./lib/ppom/ppom-middleware"),Me=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=ft(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}(e("./lib/ppom/ppom")),Pe=e("./detect-multiple-instances"),Ne=yt(e("./lib/ComposableObservableStore")),Ie=yt(e("./lib/account-tracker")),Re=yt(e("./lib/createDupeReqFilterStream")),xe=yt(e("./lib/createLoggerMiddleware")),Oe=e("./lib/rpc-method-middleware"),Le=yt(e("./lib/createOriginMiddleware")),De=yt(e("./lib/createTabIdMiddleware")),Ue=e("./controllers/network-order"),je=e("./controllers/account-order"),Fe=yt(e("./lib/createOnboardingMiddleware")),Be=e("./lib/stream-utils"),qe=yt(e("./controllers/preferences")),Ke=yt(e("./controllers/app-state")),$e=yt(e("./controllers/alert")),He=yt(e("./controllers/onboarding")),Ge=yt(e("./lib/backup")),We=yt(e("./controllers/decrypt-message")),ze=yt(e("./controllers/swaps")),Ve=yt(e("./controllers/metametrics")),Ye=e("./lib/segment"),Qe=yt(e("./lib/createMetaRPCHandler")),Je=e("./lib/util"),Xe=yt(e("./lib/createMetamaskMiddleware")),Ze=e("./lib/hardware-keyring-builder-factory"),et=yt(e("./controllers/encryption-public-key")),tt=yt(e("./controllers/app-metadata")),rt=e("./controllers/permissions"),nt=yt(e("./lib/createRPCMethodTrackingMiddleware")),st=e("./lib/ppom/indexed-db-backend"),ot=e("./translate"),it=e("./lib/offscreen-bridge/trezor-offscreen-bridge"),at=e("./lib/offscreen-bridge/ledger-offscreen-bridge"),lt=e("./lib/snap-keyring"),ct=e("./lib/encryptor-factory"),dt=e("./lib/transaction/util"),ut=e("./lib/offscreen-bridge/lattice-offscreen-keyring"),ht=yt(e("./snaps/preinstalled-snaps")),pt=yt(e("./controllers/authentication/authentication-controller")),gt=yt(e("./controllers/user-storage/user-storage-controller")),mt=e("./lib/WeakRefObjectMap");function ft(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(ft=function(e){return e?r:t})(e)}function yt(e){return e&&e.__esModule?e:{default:e}}function bt(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function wt(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(r!==undefined){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ct(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}r.METAMASK_CONTROLLER_EVENTS={UPDATE_BADGE:"updateBadge",APPROVAL_STATE_CHANGE:"ApprovalController:stateChange",QUEUED_REQUEST_STATE_CHANGE:"QueuedRequestController:stateChange"};var vt=new WeakSet,_t=new WeakSet,St=new WeakSet;class kt extends n.default{constructor(e){var t,r;super(),bt(this,St),bt(this,_t),bt(this,vt),wt(this,"_trackSnapExportUsage",(0,u.wrap)((0,u.memoize)((()=>(0,u.throttle)(((e,t,r,n)=>{var s;return this.metaMetricsController.trackEvent({event:ue.MetaMetricsEventName.SnapExportUsed,category:ue.MetaMetricsEventCategory.Snaps,properties:{snap_id:e,export:t,snap_category:null===(s=this._getSnapMetadata(e))||void 0===s?void 0:s.category,success:r,origin:n}})}),60*ce.SECOND)),((e,t,r,n)=>`${e}${t}${n}`)),((e,...t)=>e(...t)(...t)))),wt(this,"handleWatchAssetRequest",(({asset:e,type:t,origin:r,networkClientId:n})=>{switch(t){case z.ERC20:return this.tokensController.watchAsset({asset:e,type:t,networkClientId:n});case z.ERC721:case z.ERC1155:return this.nftController.watchNft(e,t,r);default:throw new Error(`Asset type ${t} not supported`)}})),wt(this,"removePermissionsFor",(e=>{try{this.permissionController.revokePermissions(e)}catch(e){if(!(e instanceof L.PermissionsRequestNotFoundError))throw e}})),wt(this,"updateCaveat",((e,t,r,n)=>{try{this.controllerMessenger.call("PermissionController:updateCaveat",e,t,r,n)}catch(e){if(!(e instanceof L.PermissionsRequestNotFoundError))throw e}})),wt(this,"updateNetworksList",(e=>{try{this.networkOrderController.updateNetworksList(e)}catch(e){throw b.default.error(e.message),e}})),wt(this,"updateAccountsList",(e=>{try{this.accountOrderController.updateAccountsList(e)}catch(e){throw b.default.error(e.message),e}})),wt(this,"updateHiddenAccountsList",(e=>{try{this.accountOrderController.updateHiddenAccountsList(e)}catch(e){throw b.default.error(e.message),e}})),wt(this,"rejectPermissionsRequest",(e=>{try{this.permissionController.rejectPermissionsRequest(e)}catch(e){if(!(e instanceof L.PermissionsRequestNotFoundError))throw e}})),wt(this,"acceptPermissionsRequest",(e=>{try{this.permissionController.acceptPermissionsRequest(e)}catch(e){if(!(e instanceof L.PermissionsRequestNotFoundError))throw e}})),wt(this,"resolvePendingApproval",(async(e,t,r)=>{try{await this.approvalController.accept(e,t,r)}catch(e){if(!(e instanceof M.ApprovalRequestNotFoundError))throw e}})),wt(this,"rejectPendingApproval",((e,t)=>{try{this.approvalController.reject(e,new f.EthereumRpcError(t.code,t.message,t.data))}catch(e){if(!(e instanceof M.ApprovalRequestNotFoundError))throw e}}));const{isFirstMetaMaskControllerSetup:n}=e;this.defaultMaxListeners=20,this.sendUpdate=(0,u.debounce)(this.privateSendUpdate.bind(this),200*ce.MILLISECOND),this.opts=e,this.extension=e.browser,this.platform=e.platform,this.notificationManager=e.notificationManager;const s=e.initState||{},i=this.platform.getVersion();this.recordFirstTimeInfo(s),this.featureFlags=e.featureFlags,this.activeControllerConnections=0,this.getRequestAccountTabIds=e.getRequestAccountTabIds,this.getOpenMetamaskTabsIds=e.getOpenMetamaskTabsIds,this.controllerMessenger=new P.ControllerMessenger,this.loggingController=new j.LoggingController({messenger:this.controllerMessenger.getRestricted({name:"LoggingController"}),state:s.LoggingController}),this.localStoreApiWrapper=e.localStore,this.currentMigrationVersion=e.currentMigrationVersion,this.store=new Ne.default({state:s,controllerMessenger:this.controllerMessenger,persist:!0}),this.connections={},this.createVaultMutex=new y.Mutex,this.extension.runtime.onInstalled.addListener((e=>{"update"===e.reason&&("8.1.0"===i&&this.platform.openExtensionInBrowser(),this.loggingController.add({type:j.LogType.GenericLog,data:{event:he.LOG_EVENT.VERSION_UPDATE,previousVersion:e.previousVersion,version:i}}))})),this.appMetadataController=new tt.default({state:s.AppMetadataController,currentMigrationVersion:this.currentMigrationVersion,currentAppVersion:i});const a=()=>{this.encryptionPublicKeyController.clearUnapproved(),this.decryptMessageController.clearUnapproved(),this.signatureController.clearUnapproved(),this.approvalController.clear(f.ethErrors.provider.userRejectedRequest())};this.queuedRequestController=new Q.QueuedRequestController({messenger:this.controllerMessenger.getRestricted({name:"QueuedRequestController",allowedActions:["NetworkController:getState","NetworkController:setActiveNetwork","SelectedNetworkController:getNetworkClientIdForDomain"],allowedEvents:["SelectedNetworkController:stateChange"]}),methodsRequiringNetworkSwitch:ee.methodsRequiringNetworkSwitch,clearPendingConfirmations:a}),this.approvalController=new M.ApprovalController({messenger:this.controllerMessenger.getRestricted({name:"ApprovalController"}),showApprovalRequest:e.showUserConfirmation,typesExcludedFromRateLimiting:[z.ApprovalType.EthSign,z.ApprovalType.PersonalSign,z.ApprovalType.EthSignTypedData,z.ApprovalType.Transaction,z.ApprovalType.WatchAsset,z.ApprovalType.EthGetEncryptionPublicKey,z.ApprovalType.EthDecrypt]});const l=this.controllerMessenger.getRestricted({name:"NetworkController"});let c={};s.NetworkController&&(c=s.NetworkController),this.networkController=new x.NetworkController({messenger:l,state:c,infuraProjectId:e.infuraProjectId,trackMetaMetricsEvent:(...e)=>this.metaMetricsController.trackEvent(...e)}),this.networkController.initializeProvider(),this.provider=this.networkController.getProviderAndBlockTracker().provider,this.blockTracker=this.networkController.getProviderAndBlockTracker().blockTracker,this.deprecatedNetworkVersions={};const d=this.controllerMessenger.getRestricted({name:"TokenListController",allowedEvents:["NetworkController:stateChange"]}),g=this.controllerMessenger.getRestricted({name:"PreferencesController",allowedActions:[],allowedEvents:[]});this.preferencesController=new qe.default({initState:s.PreferencesController,initLangCode:e.initLangCode,messenger:g,provider:this.provider,networkConfigurations:this.networkController.state.networkConfigurations,onKeyringStateChange:e=>this.controllerMessenger.subscribe("KeyringController:stateChange",e)}),this.tokenListController=new o.TokenListController({chainId:this.networkController.state.providerConfig.chainId,preventPollingOnNetworkRestart:!Ct(this,St,At).call(this,this.preferencesController.store.getState()),messenger:d,state:s.TokenListController}),this.assetsContractController=new o.AssetsContractController({chainId:this.networkController.state.providerConfig.chainId,onPreferencesStateChange:e=>this.preferencesController.store.subscribe(e),onNetworkDidChange:e=>l.subscribe("NetworkController:networkDidChange",(()=>{const t=this.networkController.state;return e(t)})),getNetworkClientById:this.networkController.getNetworkClientById.bind(this.networkController)},{provider:this.provider},s.AssetsContractController);const m=this.controllerMessenger.getRestricted({name:"TokensController",allowedActions:["ApprovalController:addRequest","NetworkController:getNetworkClientById"],allowedEvents:["NetworkController:networkDidChange","AccountsController:selectedAccountChange","PreferencesController:stateChange","TokenListController:stateChange"]});this.tokensController=new o.TokensController({messenger:m,chainId:this.networkController.state.providerConfig.chainId,onPreferencesStateChange:e=>this.controllerMessenger.subscribe("AccountsController:selectedAccountChange",(t=>{e({selectedAddress:t.address})})),onNetworkDidChange:e=>l.subscribe("NetworkController:networkDidChange",(()=>{const t=this.networkController.state;return e(t)})),onTokenListStateChange:e=>this.controllerMessenger.subscribe(`${this.tokenListController.name}:stateChange`,e),getNetworkClientById:this.networkController.getNetworkClientById.bind(this.networkController),config:{provider:this.provider,selectedAddress:(null===(t=s.AccountsController)||void 0===t||null===(t=t.internalAccounts)||void 0===t||null===(t=t.accounts[null===(r=s.AccountsController)||void 0===r||null===(r=r.internalAccounts)||void 0===r?void 0:r.selectedAccount])||void 0===t?void 0:t.address)??""},state:s.TokensController}),this.controllerMessenger.registerActionHandler("TokensController:getState",(()=>this.tokensController.state));const S=this.controllerMessenger.getRestricted({name:"NftController",allowedActions:[`${this.approvalController.name}:addRequest`]});this.nftController=new o.NftController({messenger:S,chainId:this.networkController.state.providerConfig.chainId,onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:l.subscribe.bind(l,"NetworkController:stateChange"),getERC721AssetName:this.assetsContractController.getERC721AssetName.bind(this.assetsContractController),getERC721AssetSymbol:this.assetsContractController.getERC721AssetSymbol.bind(this.assetsContractController),getERC721TokenURI:this.assetsContractController.getERC721TokenURI.bind(this.assetsContractController),getERC721OwnerOf:this.assetsContractController.getERC721OwnerOf.bind(this.assetsContractController),getERC1155BalanceOf:this.assetsContractController.getERC1155BalanceOf.bind(this.assetsContractController),getERC1155TokenURI:this.assetsContractController.getERC1155TokenURI.bind(this.assetsContractController),onNftAdded:({address:e,symbol:t,tokenId:r,standard:n,source:s})=>this.metaMetricsController.trackEvent({event:ue.MetaMetricsEventName.NftAdded,category:ue.MetaMetricsEventCategory.Wallet,sensitiveProperties:{token_contract_address:e,token_symbol:t,token_id:r,token_standard:n,asset_type:te.AssetType.NFT,source:s}}),getNetworkClientById:this.networkController.getNetworkClientById.bind(this.networkController)},{},s.NftController),this.nftController.setApiKey(null),this.nftDetectionController=new o.NftDetectionController({chainId:this.networkController.state.providerConfig.chainId,onNftsStateChange:e=>this.nftController.subscribe(e),onPreferencesStateChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),onNetworkStateChange:l.subscribe.bind(l,"NetworkController:stateChange"),getOpenSeaApiKey:()=>this.nftController.openSeaApiKey,getBalancesInSingleCall:this.assetsContractController.getBalancesInSingleCall.bind(this.assetsContractController),addNft:this.nftController.addNft.bind(this.nftController),getNftApi:this.nftController.getNftApi.bind(this.nftController),getNftState:()=>this.nftController.state,disabled:this.preferencesController.store.getState().useNftDetection===undefined||!this.preferencesController.store.getState().useNftDetection,selectedAddress:this.preferencesController.store.getState().selectedAddress}),this.metaMetricsController=new Ve.default({segment:Ye.segment,preferencesStore:this.preferencesController.store,onNetworkDidChange:l.subscribe.bind(l,"NetworkController:networkDidChange"),getNetworkIdentifier:()=>{const{type:e,rpcUrl:t}=this.networkController.state.providerConfig;return e===ne.NETWORK_TYPES.RPC?t:e},getCurrentChainId:()=>this.networkController.state.providerConfig.chainId,version:this.platform.getVersion(),environment:"production",extension:this.extension,initState:s.MetaMetricsController,captureException:E.captureException}),this.on("update",(e=>{this.metaMetricsController.handleMetaMaskStateUpdate(e)}));const k=this.controllerMessenger.getRestricted({name:"GasFeeController",allowedActions:["NetworkController:getEIP1559Compatibility","NetworkController:getNetworkClientById","NetworkController:getState"],allowedEvents:["NetworkController:stateChange"]}),T=re.GAS_API_BASE_URL;this.gasFeeController=new O.GasFeeController({state:s.GasFeeController,interval:1e4,messenger:k,clientId:re.SWAPS_CLIENT_ID,getProvider:()=>this.networkController.getProviderAndBlockTracker().provider,onNetworkDidChange:e=>{l.subscribe("NetworkController:networkDidChange",(()=>e(this.networkController.state)))},getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),legacyAPIEndpoint:`${T}/networks/<chain_id>/gasPrices`,EIP1559APIEndpoint:`${T}/networks/<chain_id>/suggestedGasFees`,getCurrentNetworkLegacyGasAPICompatibility:()=>{const{chainId:e}=this.networkController.state.providerConfig;return e===ne.CHAIN_IDS.BSC},getChainId:()=>this.networkController.state.providerConfig.chainId}),this.appStateController=new Ke.default({addUnlockListener:this.on.bind(this,"unlock"),isUnlocked:this.isUnlocked.bind(this),initState:s.AppStateController,onInactiveTimeout:()=>this.setLocked(),preferencesStore:this.preferencesController.store,messenger:this.controllerMessenger.getRestricted({name:"AppStateController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:acceptRequest`],allowedEvents:["KeyringController:qrKeyringStateChange"]}),extension:this.extension});const $=this.controllerMessenger.getRestricted({name:"CurrencyRateController",allowedActions:[`${this.networkController.name}:getNetworkClientById`]});this.currencyRateController=new o.CurrencyRateController({includeUsdRate:!0,messenger:$,state:s.CurrencyController});const V=this.currencyRateController.fetchExchangeRate.bind(this.currencyRateController);this.currencyRateController.fetchExchangeRate=(...e)=>this.preferencesController.store.getState().useCurrencyRateCheck?V(...e):{conversionRate:null,usdConversionRate:null};const oe=this.controllerMessenger.getRestricted({name:"PhishingController"});this.phishingController=new I.PhishingController({messenger:oe,state:s.PhishingController,hotlistRefreshInterval:undefined,stalelistRefreshInterval:undefined}),this.ppomController=new W.PPOMController({messenger:this.controllerMessenger.getRestricted({name:"PPOMController",allowedEvents:["NetworkController:stateChange"]}),storageBackend:new st.IndexedDBPPOMStorage("PPOMDB",1),provider:this.provider,ppomProvider:{PPOM:Me.PPOM,ppomInit:Me.default},state:s.PPOMController,chainId:this.networkController.state.providerConfig.chainId,securityAlertsEnabled:this.preferencesController.store.getState().securityAlertsEnabled,onPreferencesChange:this.preferencesController.store.subscribe.bind(this.preferencesController.store),cdnBaseUrl:"static.cx.metamask.io/api/v1/confirmations/ppom",blockaidPublicKey:"066ad3e8af5583385e312c156d238055215d5f25247c1e91055afa756cb98a88"});const ie=this.controllerMessenger.getRestricted({name:"AnnouncementController"});this.announcementController=new R.AnnouncementController({messenger:ie,allAnnouncements:le.UI_NOTIFICATIONS,state:s.AnnouncementController});const pe=this.controllerMessenger.getRestricted({name:"NetworkOrderController",allowedEvents:["NetworkController:stateChange"]});this.networkOrderController=new Ue.NetworkOrderController({messenger:pe,state:s.NetworkOrderController});const ge=this.controllerMessenger.getRestricted({name:"AccountOrderController"});this.accountOrderController=new je.AccountOrderController({messenger:ge,state:s.AccountOrderController});const me=this.controllerMessenger.getRestricted({name:"AccountsController",allowedEvents:["SnapController:stateChange","KeyringController:accountRemoved","KeyringController:stateChange","AccountsController:selectedAccountChange"],allowedActions:["AccountsController:setCurrentAccount","AccountsController:setAccountName","AccountsController:listAccounts","AccountsController:getSelectedAccount","AccountsController:getAccountByAddress","AccountsController:updateAccounts","KeyringController:getAccounts","KeyringController:getKeyringsByType","KeyringController:getKeyringForAccount"]});this.accountsController=new H.AccountsController({messenger:me,state:s.AccountsController}),this.tokenRatesController=new o.TokenRatesController({chainId:this.networkController.state.providerConfig.chainId,ticker:this.networkController.state.providerConfig.ticker,selectedAddress:this.accountsController.getSelectedAccount().address,onTokensStateChange:e=>this.tokensController.subscribe(e),onNetworkStateChange:l.subscribe.bind(l,"NetworkController:stateChange"),onPreferencesStateChange:e=>this.controllerMessenger.subscribe("AccountsController:selectedAccountChange",(t=>{e({selectedAddress:t.address})})),tokenPricesService:new o.CodefiTokenPricesServiceV2,getNetworkClientById:this.networkController.getNetworkClientById.bind(this.networkController)},{allTokens:this.tokensController.state.allTokens,allDetectedTokens:this.tokensController.state.allDetectedTokens},s.TokenRatesController),this.preferencesController.store.subscribe((0,Je.previousValueComparator)(((e,t)=>{const{useCurrencyRateCheck:r}=e,{useCurrencyRateCheck:n}=t;n&&!r?this.tokenRatesController.start():!n&&r&&this.tokenRatesController.stop()}),this.preferencesController.store.getState())),this.ensController=new N.EnsController({messenger:this.controllerMessenger.getRestricted({name:"EnsController"}),provider:this.provider,onNetworkDidChange:l.subscribe.bind(l,"NetworkController:networkDidChange")}),this.onboardingController=new He.default({initState:s.OnboardingController});let fe=[(0,h.keyringBuilderFactory)(_.MetaMaskKeyring)];if(!1===be.isManifestV3){var ye;const e=null===(ye=this.opts.overrides)||void 0===ye?void 0:ye.keyrings,t=[(null==e?void 0:e.lattice)||v.default,_.MetaMaskKeyring],r=[{keyring:(null==e?void 0:e.trezor)||w.TrezorKeyring,bridge:(null==e?void 0:e.trezorBridge)||w.TrezorConnectBridge},{keyring:(null==e?void 0:e.ledger)||C.LedgerKeyring,bridge:(null==e?void 0:e.ledgerBridge)||C.LedgerIframeBridge}];fe=t.map((e=>(0,h.keyringBuilderFactory)(e))),r.forEach((e=>fe.push((0,Ze.hardwareKeyringBuilderFactory)(e.keyring,e.bridge))))}else fe.push((0,Ze.hardwareKeyringBuilderFactory)(w.TrezorKeyring,it.TrezorOffscreenBridge),(0,Ze.hardwareKeyringBuilderFactory)(C.LedgerKeyring,at.LedgerOffscreenBridge),(0,h.keyringBuilderFactory)(ut.LatticeKeyringOffscreen));const we=this.controllerMessenger.getRestricted({name:"SnapKeyringBuilder",allowedActions:["ApprovalController:addRequest","ApprovalController:acceptRequest","ApprovalController:rejectRequest","ApprovalController:startFlow","ApprovalController:endFlow","ApprovalController:showSuccess","ApprovalController:showError","PhishingController:test","PhishingController:maybeUpdateState","KeyringController:getAccounts","AccountsController:setSelectedAccount","AccountsController:getAccountByAddress"]});fe.push((0,lt.snapKeyringBuilder)(we,(()=>this.snapController),(async()=>{await this.keyringController.persistAllKeyrings(),await this.accountsController.updateAccounts()}),(e=>this.preferencesController.setSelectedAddress(e)),(e=>this.removeAccount(e)),this.metaMetricsController.trackEvent.bind(this.metaMetricsController),(e=>{if(!e)return null;const t=this.getLocale(),{snaps:r}=this.snapController.state,n=r[e];if(!n)return(0,Z.stripSnapPrefix)(e);if(n.localizationFiles){return(0,Z.getLocalizedSnapManifest)(n.manifest,t,n.localizationFiles).proposedName}return n.manifest.proposedName})));const ve=this.controllerMessenger.getRestricted({name:"KeyringController"});this.keyringController=new p.KeyringController({cacheEncryptionKey:!0,keyringBuilders:fe,state:s.KeyringController,encryptor:e.encryptor||(0,ct.encryptorFactory)(6e5),messenger:ve,removeIdentity:this.preferencesController.removeAddress.bind(this.preferencesController),setAccountLabel:(e,t)=>{const r=this.accountsController.getAccountByAddress(e);if(r===undefined)throw new Error(`No account found for address: ${e}`);this.accountsController.setAccountName(r.id,t),this.preferencesController.setAccountLabel(e,t)},setSelectedAddress:e=>{const t=this.accountsController.getAccountByAddress(e);if(t===undefined)throw new Error(`No account found for address: ${e}`);this.accountsController.setSelectedAccount(t.id),this.preferencesController.setSelectedAddress(e)},syncIdentities:e=>{this.preferencesController.syncAddresses(e)},updateIdentities:this.preferencesController.setAddresses.bind(this.preferencesController)}),this.controllerMessenger.subscribe("KeyringController:unlock",(()=>this._onUnlock())),this.controllerMessenger.subscribe("KeyringController:lock",(()=>this._onLock())),this.controllerMessenger.subscribe("KeyringController:stateChange",(e=>{this._onKeyringControllerUpdate(e)})),this.permissionController=new L.PermissionController({messenger:this.controllerMessenger.getRestricted({name:"PermissionController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:hasRequest`,`${this.approvalController.name}:acceptRequest`,`${this.approvalController.name}:rejectRequest`,"SnapController:getPermitted","SnapController:install","SubjectMetadataController:getSubjectMetadata"]}),state:s.PermissionController,caveatSpecifications:(0,rt.getCaveatSpecifications)({getInternalAccounts:this.accountsController.listAccounts.bind(this.accountsController)}),permissionSpecifications:{...(0,rt.getPermissionSpecifications)({getInternalAccounts:this.accountsController.listAccounts.bind(this.accountsController),getAllAccounts:this.keyringController.getAccounts.bind(this.keyringController),captureKeyringTypesWithMissingIdentities:(e=[],t=[])=>{const r=t.filter((t=>!e.some((e=>e.address.toLowerCase()===t.toLowerCase())))).map((e=>this.keyringController.getAccountKeyringType(e))),n=e.length,s=Object.keys(this.accountTracker.store.getState().accounts||{}).length;(0,E.captureException)(new Error(`Attempt to get permission specifications failed because their were ${t.length} accounts, but ${n} identities, and the ${r} keyrings included accounts with missing identities. Meanwhile, there are ${s} accounts in the account tracker.`))}}),...this.getSnapPermissionSpecifications()},unrestrictedMethods:rt.unrestrictedMethods}),this.selectedNetworkController=new U.SelectedNetworkController({messenger:this.controllerMessenger.getRestricted({name:"SelectedNetworkController",allowedActions:["NetworkController:getNetworkClientById","NetworkController:getState","NetworkController:getSelectedNetworkClient","PermissionController:hasPermissions","PermissionController:getSubjectNames"],allowedEvents:["NetworkController:stateChange","PermissionController:stateChange"]}),state:s.SelectedNetworkController,useRequestQueuePreference:this.preferencesController.store.getState().useRequestQueue,onPreferencesStateChange:e=>this.preferencesController.store.subscribe(e),domainProxyMap:new mt.WeakRefObjectMap}),this.permissionLogController=new F.PermissionLogController({messenger:this.controllerMessenger.getRestricted({name:"PermissionLogController"}),restrictedMethods:new Set(Object.keys(ae.RestrictedMethods)),state:s.PermissionLogController}),this.subjectMetadataController=new L.SubjectMetadataController({messenger:this.controllerMessenger.getRestricted({name:"SubjectMetadataController",allowedActions:[`${this.permissionController.name}:hasPermissions`]}),state:s.SubjectMetadataController,subjectCacheLimit:100});const _e=be.isManifestV3&&"undefined"!=typeof chrome&&void 0!==chrome.offscreen,Se={messenger:this.controllerMessenger.getRestricted({name:"ExecutionService"}),setupSnapProvider:this.setupSnapProvider.bind(this)};this.snapExecutionService=!1===_e?new K.IframeExecutionService({...Se,iframeUrl:new URL("https://execution.metamask.io/iframe/6.0.2/index.html")}):new K.OffscreenExecutionService({documentUrl:chrome.runtime.getURL("./offscreen.html"),...Se});const Ae=this.controllerMessenger.getRestricted({name:"SnapController",allowedEvents:["ExecutionService:unhandledError","ExecutionService:outboundRequest","ExecutionService:outboundResponse"],allowedActions:[`${this.permissionController.name}:getEndowments`,`${this.permissionController.name}:getPermissions`,`${this.permissionController.name}:hasPermission`,`${this.permissionController.name}:hasPermissions`,`${this.permissionController.name}:requestPermissions`,`${this.permissionController.name}:revokeAllPermissions`,`${this.permissionController.name}:revokePermissions`,`${this.permissionController.name}:revokePermissionForAllSubjects`,`${this.permissionController.name}:getSubjectNames`,`${this.permissionController.name}:updateCaveat`,`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:updateRequestState`,`${this.permissionController.name}:grantPermissions`,`${this.subjectMetadataController.name}:getSubjectMetadata`,`${this.subjectMetadataController.name}:addSubjectMetadata`,"ExecutionService:executeSnap","ExecutionService:getRpcRequestHandler","ExecutionService:terminateSnap","ExecutionService:terminateAllSnaps","ExecutionService:handleRpcRequest","SnapsRegistry:get","SnapsRegistry:getMetadata","SnapsRegistry:update","SnapsRegistry:resolveVersion","SnapInterfaceController:createInterface","SnapInterfaceController:getInterface"]}),Re=!0;this.snapController=new K.SnapController({environmentEndowmentPermissions:Object.values(ae.EndowmentPermissions),excludedPermissions:{...ae.ExcludedSnapPermissions,...ae.ExcludedSnapEndowments},closeAllConnections:this.removeAllConnections.bind(this),state:s.SnapController,messenger:Ae,featureFlags:{dappsCanUpdateSnaps:!0,allowLocalSnaps:!1,requireAllowlist:Re},encryptor:(0,ct.encryptorFactory)(6e5),getMnemonic:this.getPrimaryKeyringMnemonic.bind(this),preinstalledSnaps:ht.default}),this.notificationController=new q.NotificationController({messenger:this.controllerMessenger.getRestricted({name:"NotificationController"}),state:s.NotificationController}),this.rateLimitController=new B.RateLimitController({state:s.RateLimitController,messenger:this.controllerMessenger.getRestricted({name:"RateLimitController"}),implementations:{showNativeNotification:{method:(e,t)=>{const r=this.controllerMessenger.call("SubjectMetadataController:getState").subjectMetadata[e];return this.platform._showNotification((null==r?void 0:r.name)??e,t).catch((e=>{b.default.error("Failed to create notification",e)})),null},rateLimitCount:2,rateLimitTimeout:3e5},showInAppNotification:{method:(e,t)=>(this.controllerMessenger.call("NotificationController:show",e,t),null),rateLimitCount:5,rateLimitTimeout:6e4}}});const xe=this.controllerMessenger.getRestricted({name:"CronjobController",allowedEvents:["SnapController:snapInstalled","SnapController:snapUpdated","SnapController:snapUninstalled","SnapController:snapEnabled","SnapController:snapDisabled"],allowedActions:[`${this.permissionController.name}:getPermissions`,"SnapController:handleRequest","SnapController:getAll"]});this.cronjobController=new K.CronjobController({state:s.CronjobController,messenger:xe});const Oe=this.controllerMessenger.getRestricted({name:"SnapsRegistry",allowedEvents:[],allowedActions:[]});this.snapsRegistry=new K.JsonSnapsRegistry({state:s.SnapsRegistry,messenger:Oe,refetchOnAllowlistMiss:Re,failOnUnavailableRegistry:Re,url:{registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:"0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6"});const Le=this.controllerMessenger.getRestricted({name:"SnapInterfaceController",allowedActions:[`${this.phishingController.name}:maybeUpdateState`,`${this.phishingController.name}:testOrigin`]});this.snapInterfaceController=new K.SnapInterfaceController({state:s.SnapInterfaceController,messenger:Le}),this.authenticationController=new pt.default({state:s.AuthenticationController,messenger:this.controllerMessenger.getRestricted({name:"AuthenticationController",allowedActions:["SnapController:handleRequest"]})}),this.userStorageController=new gt.default({state:s.UserStorageController,messenger:this.controllerMessenger.getRestricted({name:"UserStorageController",allowedActions:["SnapController:handleRequest","AuthenticationController:getBearerToken","AuthenticationController:getSessionProfile","AuthenticationController:isSignedIn","AuthenticationController:performSignIn"]})}),this.accountTracker=new Ie.default({provider:this.provider,blockTracker:this.blockTracker,getCurrentChainId:()=>this.networkController.state.providerConfig.chainId,getNetworkIdentifier:e=>{const{type:t,rpcUrl:r}=e??this.networkController.state.providerConfig;return t===ne.NETWORK_TYPES.RPC?r:t},preferencesController:this.preferencesController,onboardingController:this.onboardingController,controllerMessenger:this.controllerMessenger.getRestricted({name:"AccountTracker",allowedEvents:["AccountsController:selectedAccountChange"],allowedActions:["AccountsController:getSelectedAccount"]}),initState:{accounts:{}},onAccountRemoved:this.controllerMessenger.subscribe.bind(this.controllerMessenger,"KeyringController:accountRemoved")}),this.on("controllerConnectionChanged",(e=>{const{completedOnboarding:t}=this.onboardingController.store.getState();e>0&&t?this.triggerNetworkrequests():this.stopNetworkRequests()})),this.onboardingController.store.subscribe((0,Je.previousValueComparator)((async(e,t)=>{const{completedOnboarding:r}=e,{completedOnboarding:n}=t;if(!r&&n){const{address:e}=this.accountsController.getSelectedAccount();this._addAccountsWithBalance(),this.postOnboardingInitialization(),this.triggerNetworkrequests(),await this.tokenDetectionController.detectTokens({selectedAddress:e})}}),this.onboardingController.store.getState()));const De=this.controllerMessenger.getRestricted({name:"TokenDetectionController",allowedActions:["AccountsController:getSelectedAccount","KeyringController:getState","NetworkController:getNetworkClientById","NetworkController:getNetworkConfigurationByNetworkClientId","NetworkController:getState","PreferencesController:getState","TokenListController:getState","TokensController:getState","TokensController:addDetectedTokens"],allowedEvents:["AccountsController:selectedAccountChange","KeyringController:lock","KeyringController:unlock","NetworkController:networkDidChange","PreferencesController:stateChange","TokenListController:stateChange"]});this.tokenDetectionController=new o.TokenDetectionController({messenger:De,getBalancesInSingleCall:this.assetsContractController.getBalancesInSingleCall.bind(this.assetsContractController),trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.addressBookController=new A.AddressBookController(undefined,s.AddressBookController),this.alertController=new $e.default({initState:s.AlertController,preferencesStore:this.preferencesController.store,controllerMessenger:this.controllerMessenger.getRestricted({name:"AlertController",allowedEvents:["AccountsController:selectedAccountChange"],allowedActions:["AccountsController:getSelectedAccount"]})}),this.backup=new Ge.default({preferencesController:this.preferencesController,addressBookController:this.addressBookController,accountsController:this.accountsController,networkController:this.networkController,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.snapAndHardwareMetricsParams={getSelectedAccount:this.accountsController.getSelectedAccount.bind(this.accountsController),getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),snapAndHardwareMessenger:this.controllerMessenger.getRestricted({name:"SnapAndHardwareMessenger",allowedActions:["KeyringController:getKeyringForAccount","SnapController:get","AccountsController:getSelectedAccount"]})};const Fe=this.controllerMessenger.getRestricted({name:"TransactionController",allowedActions:[`${this.approvalController.name}:addRequest`,"NetworkController:findNetworkClientIdByChainId","NetworkController:getNetworkClientById"],allowedEvents:["NetworkController:stateChange"]});this.txController=new X.TransactionController({blockTracker:this.blockTracker,getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getCurrentAccountEIP1559Compatibility:this.getCurrentAccountEIP1559Compatibility.bind(this),getExternalPendingTransactions:this.getExternalPendingTransactions.bind(this),getGasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),getNetworkClientRegistry:this.networkController.getNetworkClientRegistry.bind(this.networkController),getNetworkState:()=>this.networkController.state,getPermittedAccounts:this.getPermittedAccounts.bind(this),getSavedGasFees:()=>this.preferencesController.store.getState().advancedGasFee[this.networkController.state.providerConfig.chainId],getSelectedAddress:()=>this.accountsController.getSelectedAccount().address,incomingTransactions:{includeTokenTransfers:!1,isEnabled:()=>{var e;return Boolean((null===(e=this.preferencesController.store.getState().incomingTransactionsPreferences)||void 0===e?void 0:e[this.networkController.state.providerConfig.chainId])&&this.onboardingController.store.getState().completedOnboarding)},queryEntireHistory:!1,updateTransactions:!1},isMultichainEnabled:"",isSimulationEnabled:()=>this.preferencesController.store.getState().useTransactionSimulations,messenger:Fe,onNetworkStateChange:e=>{l.subscribe("NetworkController:networkDidChange",(()=>e()))},pendingTransactions:{isResubmitEnabled:()=>{const e=this._getMetaMaskState();return!((0,Ce.getSmartTransactionsOptInStatus)(e)&&(0,Ce.getCurrentChainSupportsSmartTransactions)(e))}},provider:this.provider,hooks:{publish:this._publishSmartTransactionHook.bind(this)},sign:(...e)=>this.keyringController.signTransaction(...e),state:s.TransactionController}),this._addTransactionControllerListeners(),this.decryptMessageController=new We.default({getState:this.getState.bind(this),messenger:this.controllerMessenger.getRestricted({name:"DecryptMessageController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:acceptRequest`,`${this.approvalController.name}:rejectRequest`,`${this.keyringController.name}:decryptMessage`]}),metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.encryptionPublicKeyController=new et.default({messenger:this.controllerMessenger.getRestricted({name:"EncryptionPublicKeyController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.approvalController.name}:acceptRequest`,`${this.approvalController.name}:rejectRequest`]}),getEncryptionPublicKey:this.keyringController.getEncryptionPublicKey.bind(this.keyringController),getAccountKeyringType:this.keyringController.getAccountKeyringType.bind(this.keyringController),getState:this.getState.bind(this),metricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)}),this.signatureController=new G.SignatureController({messenger:this.controllerMessenger.getRestricted({name:"SignatureController",allowedActions:[`${this.approvalController.name}:addRequest`,`${this.keyringController.name}:signMessage`,`${this.keyringController.name}:signPersonalMessage`,`${this.keyringController.name}:signTypedMessage`,`${this.loggingController.name}:add`]}),isEthSignEnabled:()=>{var e;return null===(e=this.preferencesController.store.getState())||void 0===e||null===(e=e.disabledRpcMethodPreferences)||void 0===e?void 0:e.eth_sign},getAllState:this.getState.bind(this),getCurrentChainId:()=>this.networkController.state.providerConfig.chainId}),this.signatureController.hub.on("cancelWithReason",(({message:e,reason:t})=>{this.metaMetricsController.trackEvent({event:t,category:ue.MetaMetricsEventCategory.Transactions,properties:{action:"Sign Request",type:e.type}})})),this.swapsController=new ze.default({getBufferedGasLimit:async(e,t)=>{const{gas:r,simulationFails:n}=await this.txController.estimateGasBuffered(e.txParams,t);return{gasLimit:r,simulationFails:n}},provider:this.provider,getProviderConfig:()=>this.networkController.state.providerConfig,getTokenRatesState:()=>this.tokenRatesController.state,getCurrentChainId:()=>this.networkController.state.providerConfig.chainId,getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),getLayer1GasFee:this.txController.getLayer1GasFee.bind(this.txController),getNetworkClientId:()=>this.networkController.state.selectedNetworkClientId,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)},s.SwapsController),this.smartTransactionsController=new D.default({getNetworkClientById:this.networkController.getNetworkClientById.bind(this.networkController),onNetworkStateChange:l.subscribe.bind(l,"NetworkController:stateChange"),getNonceLock:this.txController.getNonceLock.bind(this.txController),confirmExternalTransaction:this.txController.confirmExternalTransaction.bind(this.txController),getTransactions:this.txController.getTransactions.bind(this.txController),provider:this.provider,trackMetaMetricsEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController)},{supportedChainIds:(0,se.getAllowedSmartTransactionsChainIds)()},s.SmartTransactionsController);const Be=()=>this.preferencesController.store.getState().useExternalNameSources;this.nameController=new Y.NameController({messenger:this.controllerMessenger.getRestricted({name:"NameController",allowedActions:[]}),providers:[new Y.ENSNameProvider({reverseLookup:this.ensController.reverseResolveAddress.bind(this.ensController)}),new Y.EtherscanNameProvider({isEnabled:Be}),new Y.TokenNameProvider({isEnabled:Be}),new Y.LensNameProvider({isEnabled:Be}),new ke.SnapsNameProvider({messenger:this.controllerMessenger.getRestricted({name:"SnapsNameProvider",allowedActions:["SnapController:getAll","SnapController:get","SnapController:handleRequest","PermissionController:getState"]})})],state:s.NameController});const Qe=this.controllerMessenger.getRestricted({name:"PetnamesBridge",allowedEvents:["NameController:stateChange","AccountsController:stateChange"],allowedActions:["AccountsController:listAccounts"]});new Te.AddressBookPetnamesBridge({addressBookController:this.addressBookController,nameController:this.nameController,messenger:Qe}).init(),new Ee.AccountIdentitiesPetnamesBridge({nameController:this.nameController,messenger:Qe}).init(),this.userOperationController=new J.UserOperationController({entrypoint:null,getGasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),messenger:this.controllerMessenger.getRestricted({name:"UserOperationController",allowedActions:["ApprovalController:addRequest","NetworkController:getNetworkClientById","KeyringController:prepareUserOperation","KeyringController:patchUserOperation","KeyringController:signUserOperation"]}),state:s.UserOperationController}),this.userOperationController.hub.on("user-operation-added",this._onUserOperationAdded.bind(this)),this.userOperationController.hub.on("transaction-updated",this._onUserOperationTransactionUpdated.bind(this)),l.subscribe("NetworkController:networkDidChange",(()=>{this.accountTracker.updateAccounts()})),l.subscribe("NetworkController:networkWillChange",a.bind(this)),this.metamaskMiddleware=(0,Xe.default)({static:{eth_syncing:!1,web3_clientVersion:`MetaMask/v${i}`},version:i,getAccounts:async({origin:e},{suppressUnauthorizedError:t=!0}={})=>{if(e===de.ORIGIN_METAMASK){const e=this.accountsController.getSelectedAccount().address;return e?[e]:[]}return this.isUnlocked()?await this.getPermittedAccounts(e,{suppressUnauthorizedError:t}):[]},processTransaction:(e,t)=>(0,dt.addDappTransaction)(this.getAddTransactionRequest({transactionParams:e,dappRequest:t})),processEthSignMessage:this.signatureController.newUnsignedMessage.bind(this.signatureController),processTypedMessage:this.signatureController.newUnsignedTypedMessage.bind(this.signatureController),processTypedMessageV3:this.signatureController.newUnsignedTypedMessage.bind(this.signatureController),processTypedMessageV4:this.signatureController.newUnsignedTypedMessage.bind(this.signatureController),processPersonalMessage:this.signatureController.newUnsignedPersonalMessage.bind(this.signatureController),processEncryptionPublicKey:this.encryptionPublicKeyController.newRequestEncryptionPublicKey.bind(this.encryptionPublicKeyController),processDecryptMessage:this.decryptMessageController.newRequestDecryptMessage.bind(this.decryptMessageController),getPendingNonce:this.getPendingNonce.bind(this),getPendingTransactionByHash:e=>this.txController.state.transactions.find((t=>t.hash===e&&t.status===X.TransactionStatus.submitted))}),this.on("update",(e=>this._onStateUpdate(e)));const nt={AccountTracker:this.accountTracker.store,TokenRatesController:this.tokenRatesController,DecryptMessageController:this.decryptMessageController,EncryptionPublicKeyController:this.encryptionPublicKeyController,SignatureController:this.signatureController,SwapsController:this.swapsController.store,EnsController:this.ensController,ApprovalController:this.approvalController,PPOMController:this.ppomController};this.store.updateStructure({AccountsController:this.accountsController,AppStateController:this.appStateController.store,AppMetadataController:this.appMetadataController.store,TransactionController:this.txController,KeyringController:this.keyringController,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,NetworkController:this.networkController,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController,SubjectMetadataController:this.subjectMetadataController,AnnouncementController:this.announcementController,NetworkOrderController:this.networkOrderController,AccountOrderController:this.accountOrderController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,NftController:this.nftController,PhishingController:this.phishingController,SelectedNetworkController:this.selectedNetworkController,LoggingController:this.loggingController,SnapController:this.snapController,CronjobController:this.cronjobController,SnapsRegistry:this.snapsRegistry,NotificationController:this.notificationController,SnapInterfaceController:this.snapInterfaceController,PPOMController:this.ppomController,NameController:this.nameController,UserOperationController:this.userOperationController,...nt}),this.memStore=new Ne.default({config:{AccountsController:this.accountsController,AppStateController:this.appStateController.store,AppMetadataController:this.appMetadataController.store,NetworkController:this.networkController,KeyringController:this.keyringController,PreferencesController:this.preferencesController.store,MetaMetricsController:this.metaMetricsController.store,AddressBookController:this.addressBookController,CurrencyController:this.currencyRateController,AlertController:this.alertController.store,OnboardingController:this.onboardingController.store,PermissionController:this.permissionController,PermissionLogController:this.permissionLogController,SubjectMetadataController:this.subjectMetadataController,AnnouncementController:this.announcementController,NetworkOrderController:this.networkOrderController,AccountOrderController:this.accountOrderController,GasFeeController:this.gasFeeController,TokenListController:this.tokenListController,TokensController:this.tokensController,SmartTransactionsController:this.smartTransactionsController,NftController:this.nftController,SelectedNetworkController:this.selectedNetworkController,LoggingController:this.loggingController,TxController:this.txController,SnapController:this.snapController,CronjobController:this.cronjobController,SnapsRegistry:this.snapsRegistry,NotificationController:this.notificationController,SnapInterfaceController:this.snapInterfaceController,NameController:this.nameController,UserOperationController:this.userOperationController,...nt},controllerMessenger:this.controllerMessenger});const ot=[this.accountTracker.resetState,this.decryptMessageController.resetState.bind(this.decryptMessageController),this.encryptionPublicKeyController.resetState.bind(this.encryptionPublicKeyController),this.signatureController.resetState.bind(this.signatureController),this.swapsController.resetState,this.ensController.resetState.bind(this.ensController),this.approvalController.clear.bind(this.approvalController)];be.isManifestV3?!0===n&&(this.resetStates(ot),this.extension.storage.session.set({isFirstMetaMaskControllerSetup:!1})):this.resetStates(ot);!this.isUnlocked()&&this.onboardingController.store.getState().completedOnboarding,this._startUISync(),this.extension.runtime.getPlatformInfo().then((({os:e})=>{this.appStateController.setBrowserEnvironment(e,this.extension.runtime.getBrowserInfo===undefined?"chrome":"firefox")})),this.setupControllerEventSubscriptions(),this.publicConfigStore=this.createPublicConfigStore(),this.extension.runtime.onMessageExternal.addListener(Pe.onMessageReceived),(0,Pe.checkForMultipleVersionsRunning)(),this.onboardingController.store.getState().completedOnboarding&&this.postOnboardingInitialization()}postOnboardingInitialization(){const{usePhishDetect:e}=this.preferencesController.store.getState();this.networkController.lookupNetwork(),e&&this.phishingController.maybeUpdateState()}triggerNetworkrequests(){this.accountTracker.start(),this.txController.startIncomingTransactionPolling(),this.tokenDetectionController.enable();const e=this.preferencesController.store.getState(),{useCurrencyRateCheck:t,useNftDetection:r}=e;r&&this.nftDetectionController.start(),t&&this.tokenRatesController.start(),Ct(this,St,At).call(this,e)&&this.tokenListController.start()}stopNetworkRequests(){this.accountTracker.stop(),this.txController.stopIncomingTransactionPolling(),this.tokenDetectionController.disable(),this.nftDetectionController.stop();const e=this.preferencesController.store.getState(),{useCurrencyRateCheck:t}=e;t&&this.tokenRatesController.stop(),Ct(this,St,At).call(this,e)&&this.tokenListController.stop()}resetStates(e){e.forEach((e=>{try{e()}catch(e){console.error(e)}}))}async getSnapKeyring(){let[e]=this.keyringController.getKeyringsByType(ie.KeyringType.snap);return e||(e=await this.keyringController.addNewKeyring(ie.KeyringType.snap)),e}_getSnapMetadata(e){var t;return null===(t=this.snapsRegistry.state.database)||void 0===t||null===(t=t.verifiedSnaps)||void 0===t||null===(t=t[e])||void 0===t?void 0:t.metadata}async handleSnapRequest(e){try{const t=await this.controllerMessenger.call("SnapController:handleRequest",e);return this._trackSnapExportUsage(e.snapId,e.handler,!0,e.origin),t}catch(t){throw this._trackSnapExportUsage(e.snapId,e.handler,!1,e.origin),t}}getLocale(){const{currentLocale:e}=this.preferencesController.store.getState();return e}getSnapPermissionSpecifications(){return{...(0,$.buildSnapEndowmentSpecifications)(Object.keys(ae.ExcludedSnapEndowments)),...(0,$.buildSnapRestrictedMethodSpecifications)(Object.keys(ae.ExcludedSnapPermissions),{getLocale:this.getLocale.bind(this),clearSnapState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:clearSnapState"),getMnemonic:this.getPrimaryKeyringMnemonic.bind(this),getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),getSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:get"),handleSnapRpcRequest:this.handleSnapRequest.bind(this),getSnapState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getSnapState"),showDialog:(e,t,r,n)=>this.approvalController.addAndShowApprovalRequest({origin:e,type:de.SNAP_DIALOG_TYPES[t],requestData:{id:r,placeholder:n}}),showNativeNotification:(e,t)=>this.controllerMessenger.call("RateLimitController:call",e,"showNativeNotification",e,t.message),showInAppNotification:(e,t)=>this.controllerMessenger.call("RateLimitController:call",e,"showInAppNotification",e,t.message),updateSnapState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:updateSnapState"),maybeUpdatePhishingList:()=>{const{usePhishDetect:e}=this.preferencesController.store.getState();e&&this.controllerMessenger.call("PhishingController:maybeUpdateState")},isOnPhishingList:e=>{const{usePhishDetect:t}=this.preferencesController.store.getState();return!!t&&this.controllerMessenger.call("PhishingController:testOrigin",e).result},createInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:createInterface"),getInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:getInterface"),getSnapKeyring:this.getSnapKeyring.bind(this)})}}dismissNotifications(e){this.notificationController.dismiss(e)}markNotificationsAsRead(e){this.notificationController.markRead(e)}setupControllerEventSubscriptions(){let e;this.preferencesController.store.subscribe((0,Je.previousValueComparator)(((e,t)=>{Ct(this,vt,Tt).call(this,t,e)}),this.preferencesController.store.getState())),this.controllerMessenger.subscribe(`${this.accountsController.name}:selectedAccountChange`,(async t=>{t.address&&t.address!==e&&(e=t.address,await this._onAccountChange(t.address))})),this.controllerMessenger.subscribe(`${this.permissionController.name}:stateChange`,(async(e,t)=>{const r=(0,rt.getChangedAccounts)(e,t);for(const[e,t]of r.entries())this._notifyAccountsChange(e,t)}),rt.getPermittedAccountsByOrigin),this.controllerMessenger.subscribe("NetworkController:networkDidChange",(async()=>{await this.txController.updateIncomingTransactions()})),this.controllerMessenger.subscribe(`${this.snapController.name}:snapInstallStarted`,((e,t,r)=>{var n;const s=null===(n=this._getSnapMetadata(e))||void 0===n?void 0:n.category;this.metaMetricsController.trackEvent({event:r?ue.MetaMetricsEventName.SnapUpdateStarted:ue.MetaMetricsEventName.SnapInstallStarted,category:ue.MetaMetricsEventCategory.Snaps,properties:{snap_id:e,origin:t,snap_category:s}})})),this.controllerMessenger.subscribe(`${this.snapController.name}:snapInstallFailed`,((e,t,r,n)=>{var s;const o=n.includes("User rejected the request."),i=r?ue.MetaMetricsEventName.SnapUpdateFailed:ue.MetaMetricsEventName.SnapInstallFailed,a=r?ue.MetaMetricsEventName.SnapUpdateRejected:ue.MetaMetricsEventName.SnapInstallRejected,l=null===(s=this._getSnapMetadata(e))||void 0===s?void 0:s.category;this.metaMetricsController.trackEvent({event:o?a:i,category:ue.MetaMetricsEventCategory.Snaps,properties:{snap_id:e,origin:t,snap_category:l}})})),this.controllerMessenger.subscribe(`${this.snapController.name}:snapInstalled`,((e,t)=>{var r;const n=e.id,s=null===(r=this._getSnapMetadata(n))||void 0===r?void 0:r.category;this.metaMetricsController.trackEvent({event:ue.MetaMetricsEventName.SnapInstalled,category:ue.MetaMetricsEventCategory.Snaps,properties:{snap_id:n,version:e.version,origin:t,snap_category:s}})})),this.controllerMessenger.subscribe(`${this.snapController.name}:snapUpdated`,((e,t,r)=>{var n;const s=e.id,o=null===(n=this._getSnapMetadata(s))||void 0===n?void 0:n.category;this.metaMetricsController.trackEvent({event:ue.MetaMetricsEventName.SnapUpdated,category:ue.MetaMetricsEventCategory.Snaps,properties:{snap_id:s,old_version:t,new_version:e.version,origin:r,snap_category:o}})})),this.controllerMessenger.subscribe(`${this.snapController.name}:snapTerminated`,(e=>{const t=Object.values(this.approvalController.state.pendingApprovals).filter((t=>t.origin===e.id&&t.type.startsWith(ae.RestrictedMethods.snap_dialog)));for(const e of t)this.approvalController.reject(e.id,new Error("Snap was terminated."))})),this.controllerMessenger.subscribe(`${this.snapController.name}:snapUninstalled`,(e=>{var t;const r=Object.values(this.notificationController.state.notifications).reduce(((t,r)=>(r.origin===e.id&&t.push(r.id),t)),[]);this.dismissNotifications(r);const n=e.id,s=null===(t=this._getSnapMetadata(n))||void 0===t?void 0:t.category;this.metaMetricsController.trackEvent({event:ue.MetaMetricsEventName.SnapUninstalled,category:ue.MetaMetricsEventCategory.Snaps,properties:{snap_id:n,version:e.version,snap_category:s}})}))}createPublicConfigStore(){const e=new i.ObservableStore,t=async({isUnlocked:e})=>{const{chainId:t,networkVersion:r}=await this.getProviderNetworkState();return{isUnlocked:e,chainId:t,networkVersion:r??"loading"}},r=async r=>{var n;(null===(n=r.networksMetadata[r.selectedNetworkClientId])||void 0===n?void 0:n.status)===ne.NetworkStatus.Available&&e.putState(await t(r))};return this.on("update",r),r(this.getState()),e}async getProviderState(e){const t=await this.getProviderNetworkState(this.preferencesController.getUseRequestQueue()?e:undefined);return{isUnlocked:this.isUnlocked(),accounts:await this.getPermittedAccounts(e),...t}}async getProviderNetworkState(e=U.METAMASK_DOMAIN){const t=this.controllerMessenger.call("SelectedNetworkController:getNetworkClientIdForDomain",e),r=this.controllerMessenger.call("NetworkController:getNetworkClientById",t),{chainId:n}=r.configuration,{completedOnboarding:s}=this.onboardingController.store.getState();let o=this.deprecatedNetworkVersions[t];if(!o&&s){const e=new S.default(r.provider);o=await new Promise((t=>{e.sendAsync({method:"net_version"},((e,r)=>{e?(console.error(e),t(null)):t((0,we.convertNetworkId)(r))}))})),this.deprecatedNetworkVersions[t]=o}return{chainId:n,networkVersion:o??"loading"}}getState(){const{vault:e}=this.keyringController.state,t=Boolean(e),r=this.memStore.getFlatState();return delete r.vault,{isInitialized:t,...r,snapStates:{},unencryptedSnapStates:{},snaps:Object.values(r.snaps??{}).reduce(((e,t)=>{const{sourceCode:r,auxiliaryFiles:n,...s}=t;return e[t.id]=s,e}),{})}}getApi(){const{accountsController:e,addressBookController:t,alertController:r,appStateController:n,keyringController:s,nftController:o,nftDetectionController:i,currencyRateController:a,tokenDetectionController:l,ensController:c,gasFeeController:d,metaMetricsController:u,networkController:h,announcementController:p,onboardingController:g,permissionController:m,preferencesController:f,swapsController:y,tokensController:b,smartTransactionsController:w,txController:C,assetsContractController:v,backup:_,approvalController:S,phishingController:k}=this;return{getState:this.getState.bind(this),setCurrentCurrency:a.setCurrentCurrency.bind(a),setUseBlockie:f.setUseBlockie.bind(f),setUseNonceField:f.setUseNonceField.bind(f),setUsePhishDetect:f.setUsePhishDetect.bind(f),setUseMultiAccountBalanceChecker:f.setUseMultiAccountBalanceChecker.bind(f),dismissOpenSeaToBlockaidBanner:f.dismissOpenSeaToBlockaidBanner.bind(f),setUseSafeChainsListValidation:f.setUseSafeChainsListValidation.bind(f),setUseTokenDetection:f.setUseTokenDetection.bind(f),setUseNftDetection:f.setUseNftDetection.bind(f),setUse4ByteResolution:f.setUse4ByteResolution.bind(f),setUseCurrencyRateCheck:f.setUseCurrencyRateCheck.bind(f),setOpenSeaEnabled:f.setOpenSeaEnabled.bind(f),getUseRequestQueue:this.preferencesController.getUseRequestQueue.bind(this.preferencesController),getProviderConfig:()=>this.networkController.state.providerConfig,setSecurityAlertsEnabled:f.setSecurityAlertsEnabled.bind(f),setAddSnapAccountEnabled:f.setAddSnapAccountEnabled.bind(f),setUseExternalNameSources:f.setUseExternalNameSources.bind(f),setUseTransactionSimulations:f.setUseTransactionSimulations.bind(f),setUseRequestQueue:this.setUseRequestQueue.bind(this),setIpfsGateway:f.setIpfsGateway.bind(f),setIsIpfsGatewayEnabled:f.setIsIpfsGatewayEnabled.bind(f),setUseAddressBarEnsResolution:f.setUseAddressBarEnsResolution.bind(f),setParticipateInMetaMetrics:u.setParticipateInMetaMetrics.bind(u),setDataCollectionForMarketing:u.setDataCollectionForMarketing.bind(u),setCurrentLocale:f.setCurrentLocale.bind(f),setIncomingTransactionsPreferences:f.setIncomingTransactionsPreferences.bind(f),setServiceWorkerKeepAlivePreference:f.setServiceWorkerKeepAlivePreference.bind(f),markPasswordForgotten:this.markPasswordForgotten.bind(this),unMarkPasswordForgotten:this.unMarkPasswordForgotten.bind(this),getRequestAccountTabIds:this.getRequestAccountTabIds,getOpenMetamaskTabsIds:this.getOpenMetamaskTabsIds,markNotificationPopupAsAutomaticallyClosed:()=>this.notificationManager.markAsAutomaticallyClosed(),requestUserApproval:S.addAndShowApprovalRequest.bind(S),addNewAccount:this.addNewAccount.bind(this),getSeedPhrase:this.getSeedPhrase.bind(this),resetAccount:this.resetAccount.bind(this),removeAccount:this.removeAccount.bind(this),importAccountWithStrategy:this.importAccountWithStrategy.bind(this),getAccountsBySnapId:e=>(0,lt.getAccountsBySnapId)(this,e),connectHardware:this.connectHardware.bind(this),forgetDevice:this.forgetDevice.bind(this),checkHardwareStatus:this.checkHardwareStatus.bind(this),unlockHardwareWalletAccount:this.unlockHardwareWalletAccount.bind(this),attemptLedgerTransportCreation:this.attemptLedgerTransportCreation.bind(this),submitQRHardwareCryptoHDKey:s.submitQRCryptoHDKey.bind(s),submitQRHardwareCryptoAccount:s.submitQRCryptoAccount.bind(s),cancelSyncQRHardware:s.cancelQRSynchronization.bind(s),submitQRHardwareSignature:s.submitQRSignature.bind(s),cancelQRHardwareSignRequest:s.cancelQRSignRequest.bind(s),submitPassword:this.submitPassword.bind(this),verifyPassword:this.verifyPassword.bind(this),setProviderType:e=>this.networkController.setProviderType(e),setActiveNetwork:e=>this.networkController.setActiveNetwork(e),setNetworkClientIdForDomain:(e,t)=>this.selectedNetworkController.setNetworkClientIdForDomain(e,t),rollbackToPreviousProvider:h.rollbackToPreviousProvider.bind(h),removeNetworkConfiguration:h.removeNetworkConfiguration.bind(h),upsertNetworkConfiguration:this.networkController.upsertNetworkConfiguration.bind(this.networkController),getCurrentNetworkEIP1559Compatibility:this.networkController.getEIP1559Compatibility.bind(this.networkController),getNetworkConfigurationByNetworkClientId:this.networkController.getNetworkConfigurationByNetworkClientId.bind(this.networkController),setSelectedAddress:e=>{const t=this.accountsController.getAccountByAddress(e);if(!t)throw new Error(`No account found for address: ${e}`);this.accountsController.setSelectedAccount(t.id),this.preferencesController.setSelectedAddress(e)},toggleExternalServices:this.toggleExternalServices.bind(this),addToken:b.addToken.bind(b),updateTokenType:b.updateTokenType.bind(b),setFeatureFlag:f.setFeatureFlag.bind(f),setPreference:f.setPreference.bind(f),addKnownMethodData:f.addKnownMethodData.bind(f),setDismissSeedBackUpReminder:f.setDismissSeedBackUpReminder.bind(f),setDisabledRpcMethodPreference:f.setDisabledRpcMethodPreference.bind(f),getRpcMethodPreferences:f.getRpcMethodPreferences.bind(f),setAdvancedGasFee:f.setAdvancedGasFee.bind(f),setTheme:f.setTheme.bind(f),setSnapsAddSnapAccountModalDismissed:f.setSnapsAddSnapAccountModalDismissed.bind(f),setSelectedInternalAccount:e=>{const t=this.accountsController.getAccount(e);t&&(this.preferencesController.setSelectedAddress(t.address),this.accountsController.setSelectedAccount(e))},setAccountName:e.setAccountName.bind(e),setAccountLabel:(e,t)=>{this.preferencesController.setAccountLabel(e,t);const r=this.accountsController.getAccountByAddress(e);if(r===undefined)throw new Error(`No account found for address: ${e}`);this.accountsController.setAccountName(r.id,t)},getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),getTokenSymbol:this.getTokenSymbol.bind(this),addNft:o.addNft.bind(o),addNftVerifyOwnership:o.addNftVerifyOwnership.bind(o),removeAndIgnoreNft:o.removeAndIgnoreNft.bind(o),removeNft:o.removeNft.bind(o),checkAndUpdateAllNftsOwnershipStatus:o.checkAndUpdateAllNftsOwnershipStatus.bind(o),checkAndUpdateSingleNftOwnershipStatus:o.checkAndUpdateSingleNftOwnershipStatus.bind(o),isNftOwner:o.isNftOwner.bind(o),setAddressBook:t.set.bind(t),removeFromAddressBook:t.delete.bind(t),setLastActiveTime:n.setLastActiveTime.bind(n),setCurrentExtensionPopupId:n.setCurrentExtensionPopupId.bind(n),setDefaultHomeActiveTabName:n.setDefaultHomeActiveTabName.bind(n),setConnectedStatusPopoverHasBeenShown:n.setConnectedStatusPopoverHasBeenShown.bind(n),setRecoveryPhraseReminderHasBeenShown:n.setRecoveryPhraseReminderHasBeenShown.bind(n),setRecoveryPhraseReminderLastShown:n.setRecoveryPhraseReminderLastShown.bind(n),setTermsOfUseLastAgreed:n.setTermsOfUseLastAgreed.bind(n),setSurveyLinkLastClickedOrClosed:n.setSurveyLinkLastClickedOrClosed.bind(n),setOnboardingDate:n.setOnboardingDate.bind(n),setNewPrivacyPolicyToastClickedOrClosed:n.setNewPrivacyPolicyToastClickedOrClosed.bind(n),setNewPrivacyPolicyToastShownDate:n.setNewPrivacyPolicyToastShownDate.bind(n),setSnapsInstallPrivacyWarningShownStatus:n.setSnapsInstallPrivacyWarningShownStatus.bind(n),setOutdatedBrowserWarningLastShown:n.setOutdatedBrowserWarningLastShown.bind(n),setShowTestnetMessageInDropdown:n.setShowTestnetMessageInDropdown.bind(n),setShowBetaHeader:n.setShowBetaHeader.bind(n),setShowPermissionsTour:n.setShowPermissionsTour.bind(n),setShowAccountBanner:n.setShowAccountBanner.bind(n),setShowNetworkBanner:n.setShowNetworkBanner.bind(n),updateNftDropDownState:n.updateNftDropDownState.bind(n),setFirstTimeUsedNetwork:n.setFirstTimeUsedNetwork.bind(n),setSwitchedNetworkDetails:n.setSwitchedNetworkDetails.bind(n),clearSwitchedNetworkDetails:n.clearSwitchedNetworkDetails.bind(n),setSwitchedNetworkNeverShowMessage:n.setSwitchedNetworkNeverShowMessage.bind(n),tryReverseResolveAddress:c.reverseResolveAddress.bind(c),setLocked:this.setLocked.bind(this),createNewVaultAndKeychain:this.createNewVaultAndKeychain.bind(this),createNewVaultAndRestore:this.createNewVaultAndRestore.bind(this),exportAccount:this.exportAccount.bind(this),updateTransaction:C.updateTransaction.bind(C),approveTransactionsWithSameNonce:C.approveTransactionsWithSameNonce.bind(C),createCancelTransaction:this.createCancelTransaction.bind(this),createSpeedUpTransaction:this.createSpeedUpTransaction.bind(this),estimateGas:this.estimateGas.bind(this),getNextNonce:this.getNextNonce.bind(this),addTransaction:(e,t)=>(0,dt.addTransaction)(this.getAddTransactionRequest({transactionParams:e,transactionOptions:t,waitForSubmit:!1}),this.updateSecurityAlertResponseByTxId.bind(this)),addTransactionAndWaitForPublish:(e,t)=>(0,dt.addTransaction)(this.getAddTransactionRequest({transactionParams:e,transactionOptions:t,waitForSubmit:!0}),this.updateSecurityAlertResponseByTxId.bind(this)),createTransactionEventFragment:ve.createTransactionEventFragmentWithTxId.bind(null,this.getTransactionMetricsRequest()),getTransactions:this.txController.getTransactions.bind(this.txController),updateEditableParams:this.txController.updateEditableParams.bind(this.txController),updateTransactionGasFees:C.updateTransactionGasFees.bind(C),updateTransactionSendFlowHistory:C.updateTransactionSendFlowHistory.bind(C),updatePreviousGasParams:C.updatePreviousGasParams.bind(C),abortTransactionSigning:C.abortTransactionSigning.bind(C),getLayer1GasFee:C.getLayer1GasFee.bind(C),decryptMessage:this.decryptMessageController.decryptMessage.bind(this.decryptMessageController),decryptMessageInline:this.decryptMessageController.decryptMessageInline.bind(this.decryptMessageController),cancelDecryptMessage:this.decryptMessageController.cancelDecryptMessage.bind(this.decryptMessageController),encryptionPublicKey:this.encryptionPublicKeyController.encryptionPublicKey.bind(this.encryptionPublicKeyController),cancelEncryptionPublicKey:this.encryptionPublicKeyController.cancelEncryptionPublicKey.bind(this.encryptionPublicKeyController),setSeedPhraseBackedUp:g.setSeedPhraseBackedUp.bind(g),completeOnboarding:g.completeOnboarding.bind(g),setFirstTimeFlowType:g.setFirstTimeFlowType.bind(g),setAlertEnabledness:r.setAlertEnabledness.bind(r),setUnconnectedAccountAlertShown:r.setUnconnectedAccountAlertShown.bind(r),setWeb3ShimUsageAlertDismissed:r.setWeb3ShimUsageAlertDismissed.bind(r),removePermissionsFor:this.removePermissionsFor,approvePermissionsRequest:this.acceptPermissionsRequest,rejectPermissionsRequest:this.rejectPermissionsRequest,...(0,rt.getPermissionBackgroundApiMethods)(m),disableSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:disable"),enableSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:enable"),updateSnap:(e,t)=>(this.controllerMessenger.call("SnapController:install",e,t),null),removeSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:remove"),handleSnapRequest:this.handleSnapRequest.bind(this),revokeDynamicSnapPermissions:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:revokeDynamicPermissions"),dismissNotifications:this.dismissNotifications.bind(this),markNotificationsAsRead:this.markNotificationsAsRead.bind(this),disconnectOriginFromSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:disconnectOrigin"),updateNetworksList:this.updateNetworksList.bind(this),updateAccountsList:this.updateAccountsList.bind(this),updateHiddenAccountsList:this.updateHiddenAccountsList.bind(this),getPhishingResult:async e=>(await k.maybeUpdateState(),k.test(e)),deleteInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:deleteInterface"),updateInterfaceState:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:updateInterfaceState"),fetchAndSetQuotes:y.fetchAndSetQuotes.bind(y),setSelectedQuoteAggId:y.setSelectedQuoteAggId.bind(y),resetSwapsState:y.resetSwapsState.bind(y),setSwapsTokens:y.setSwapsTokens.bind(y),clearSwapsQuotes:y.clearSwapsQuotes.bind(y),setApproveTxId:y.setApproveTxId.bind(y),setTradeTxId:y.setTradeTxId.bind(y),setSwapsTxGasPrice:y.setSwapsTxGasPrice.bind(y),setSwapsTxGasLimit:y.setSwapsTxGasLimit.bind(y),setSwapsTxMaxFeePerGas:y.setSwapsTxMaxFeePerGas.bind(y),setSwapsTxMaxFeePriorityPerGas:y.setSwapsTxMaxFeePriorityPerGas.bind(y),safeRefetchQuotes:y.safeRefetchQuotes.bind(y),stopPollingForQuotes:y.stopPollingForQuotes.bind(y),setBackgroundSwapRouteState:y.setBackgroundSwapRouteState.bind(y),resetPostFetchState:y.resetPostFetchState.bind(y),setSwapsErrorKey:y.setSwapsErrorKey.bind(y),setInitialGasEstimate:y.setInitialGasEstimate.bind(y),setCustomApproveTxData:y.setCustomApproveTxData.bind(y),setSwapsLiveness:y.setSwapsLiveness.bind(y),setSwapsFeatureFlags:y.setSwapsFeatureFlags.bind(y),setSwapsUserFeeLevel:y.setSwapsUserFeeLevel.bind(y),setSwapsQuotesPollingLimitEnabled:y.setSwapsQuotesPollingLimitEnabled.bind(y),fetchSmartTransactionFees:w.getFees.bind(w),clearSmartTransactionFees:w.clearFees.bind(w),submitSignedTransactions:w.submitSignedTransactions.bind(w),cancelSmartTransaction:w.cancelSmartTransaction.bind(w),fetchSmartTransactionsLiveness:w.fetchLiveness.bind(w),updateSmartTransaction:w.updateSmartTransaction.bind(w),setStatusRefreshInterval:w.setStatusRefreshInterval.bind(w),trackMetaMetricsEvent:u.trackEvent.bind(u),trackMetaMetricsPage:u.trackPage.bind(u),createEventFragment:u.createEventFragment.bind(u),updateEventFragment:u.updateEventFragment.bind(u),finalizeEventFragment:u.finalizeEventFragment.bind(u),resolvePendingApproval:this.resolvePendingApproval,rejectPendingApproval:this.rejectPendingApproval,resetViewedNotifications:p.resetViewed.bind(p),updateViewedNotifications:p.updateViewed.bind(p),currencyRateStartPollingByNetworkClientId:a.startPollingByNetworkClientId.bind(a),currencyRateStopPollingByPollingToken:a.stopPollingByPollingToken.bind(a),gasFeeStartPollingByNetworkClientId:d.startPollingByNetworkClientId.bind(d),gasFeeStopPollingByPollingToken:d.stopPollingByPollingToken.bind(d),getGasFeeTimeEstimate:d.getTimeEstimate.bind(d),addPollingTokenToAppState:n.addPollingToken.bind(n),removePollingTokenFromAppState:n.removePollingToken.bind(n),backupUserData:_.backupUserData.bind(_),restoreUserData:_.restoreUserData.bind(_),detectTokens:l.detectTokens.bind(l),detectNfts:i.detectNfts.bind(i),addDetectedTokens:b.addDetectedTokens.bind(b),addImportedTokens:b.addTokens.bind(b),ignoreTokens:b.ignoreTokens.bind(b),getBalancesInSingleCall:v.getBalancesInSingleCall.bind(v),throwTestError:this.throwTestError.bind(this),updateProposedNames:this.nameController.updateProposedNames.bind(this.nameController),setName:this.nameController.setName.bind(this.nameController)}}async exportAccount(e,t){return await this.verifyPassword(t),this.keyringController.exportAccount(t,e)}async getTokenStandardAndDetails(e,t,r){var n,s;const{tokenList:o}=this.tokenListController.state,{tokens:i}=this.tokensController.state,a={...fe.STATIC_MAINNET_TOKEN_LIST[e.toLowerCase()]||{},...o[e.toLowerCase()]||{},...i.find((({address:t})=>(0,ge.isEqualCaseInsensitive)(t,e)))||{}},l=(0,ge.isEqualCaseInsensitive)(a.standard,te.TokenStandard.ERC20)||!0===a.erc20,c=!(r||(0,ge.isEqualCaseInsensitive)(a.standard,te.TokenStandard.ERC1155)||(0,ge.isEqualCaseInsensitive)(a.standard,te.TokenStandard.ERC721)||a.erc721),d=a.decimals!==undefined&&a.symbol;let u;if(l||c&&d)try{const r=t?await(0,pe.fetchTokenBalance)(e,t,this.provider):undefined;u={address:e,balance:r,standard:te.TokenStandard.ERC20,decimals:a.decimals,symbol:a.symbol}}catch(e){b.default.warn(`Failed to get token balance. Error: ${e}`)}u===undefined&&(u=await this.assetsContractController.getTokenStandardAndDetails(e,t,r));if((0,ge.isEqualCaseInsensitive)(u.standard,te.TokenStandard.ERC1155))try{const n=await(0,pe.fetchERC1155Balance)(e,t,r,this.provider),s=null!=n&&n._hex?parseInt(n._hex,16).toString():null;u={...u,balance:s}}catch(e){b.default.warn("Failed to get token balance. Error:",e)}return{...u,decimals:null===(n=u)||void 0===n||null===(n=n.decimals)||void 0===n?void 0:n.toString(10),balance:null===(s=u)||void 0===s||null===(s=s.balance)||void 0===s?void 0:s.toString(10)}}async getTokenSymbol(e){try{const t=await this.assetsContractController.getTokenStandardAndDetails(e);return null==t?void 0:t.symbol}catch(e){return null}}async createNewVaultAndKeychain(e){const t=await this.createVaultMutex.acquire();try{const t=await this.keyringController.createNewVaultAndKeychain(e),r=await this.keyringController.getAccounts();return this.preferencesController.setAddresses(r),this.selectFirstAccount(),t}finally{t()}}async createNewVaultAndRestore(e,r){const n=await this.createVaultMutex.acquire();try{const{completedOnboarding:n}=this.onboardingController.store.getState(),s=t.from(r);this.preferencesController.setAddresses([]),this.permissionController.clearState(),this.snapController.clearState(),this.notificationController.clear(),this.accountTracker.clearAccounts(),this.txController.clearUnapprovedTransactions(),n&&this.tokenDetectionController.enable();const o=await this.keyringController.createNewVaultAndRestore(e,this._convertMnemonicToWordlistIndices(s));return n&&(await this._addAccountsWithBalance(),this.setLedgerTransportPreference()),this.selectFirstAccount(),o}finally{n()}}async _addAccountsWithBalance(){const{chainId:e}=this.networkController.state.providerConfig,t=new S.default(this.provider),r=await this.keyringController.getAccounts();let n=r[r.length-1];for(let i=r.length;;i++){if("0x0"===await this.getBalance(n,t)){var s,o;await this.tokenDetectionController.detectTokens({selectedAddress:n});const t=null===(s=this.tokensController.state.allTokens)||void 0===s||null===(s=s[e])||void 0===s?void 0:s[n],r=null===(o=this.tokensController.state.allDetectedTokens)||void 0===o||null===(o=o[e])||void 0===o?void 0:o[n];if(0===((null==t?void 0:t.length)??0)&&0===((null==r?void 0:r.length)??0)){1!==i&&await this.removeAccount(n);break}}({addedAccountAddress:n}=await this.keyringController.addNewAccount(i))}}_convertMnemonicToWordlistIndices(e){const t=e.toString().split(" ").map((e=>V.wordlist.indexOf(e)));return new Uint8Array(new Uint16Array(t).buffer)}_convertEnglishWordlistIndicesToCodepoints(e){return t.from(Array.from(new Uint16Array(e.buffer)).map((e=>V.wordlist[e])).join(" "))}getBalance(e,t){return new Promise(((r,n)=>{const s=this.accountTracker.store.getState().accounts[e];s&&s.balance?r(s.balance):t.getBalance(e,((e,t)=>{e?(n(e),b.default.error(e)):r(t||"0x0")}))}))}async submitPassword(e){const{completedOnboarding:t}=this.onboardingController.store.getState();await this.keyringController.submitPassword(e);try{await this.blockTracker.checkForLatestBlock()}catch(e){b.default.error("Error while unlocking extension.",e)}await this.accountsController.updateAccounts(),t&&this.setLedgerTransportPreference()}async _loginUser(e){try{await this.submitPassword(e),await this.accountTracker.updateAccountsAllActiveNetworks()}finally{this._startUISync()}}_startUISync(){this.emit("startUISync"),this.startUISync=!0,this.memStore.subscribe(this.sendUpdate.bind(this))}async submitEncryptionKey(){try{const{loginToken:e,loginSalt:t}=await this.extension.storage.session.get(["loginToken","loginSalt"]);if(e&&t){const{vault:r}=this.keyringController.state;if(JSON.parse(r).salt!==t)return console.warn("submitEncryptionKey: Stored salt and vault salt do not match"),void await this.clearLoginArtifacts();await this.keyringController.submitEncryptionKey(e,t)}}catch(e){throw await this.clearLoginArtifacts(),e}}async clearLoginArtifacts(){await this.extension.storage.session.remove(["loginToken","loginSalt"])}async verifyPassword(e){await this.keyringController.verifyPassword(e)}selectFirstAccount(){const{identities:e}=this.preferencesController.store.getState(),[t]=Object.keys(e);this.preferencesController.setSelectedAddress(t);const[r]=this.accountsController.listAccounts();this.accountsController.setSelectedAccount(r.id)}getPrimaryKeyringMnemonic(){const[e]=this.keyringController.getKeyringsByType(ie.KeyringType.hdKeyTree);if(!e.mnemonic)throw new Error("Primary keyring mnemonic unavailable.");return e.mnemonic}async getKeyringForDevice(e,t=null){var r,n,s,o;const i=null===(r=this.opts.overrides)||void 0===r?void 0:r.keyrings;let a=null;switch(e){case oe.HardwareDeviceNames.trezor:a=(null==i||null===(n=i.trezor)||void 0===n?void 0:n.type)||w.TrezorKeyring.type;break;case oe.HardwareDeviceNames.ledger:a=(null==i||null===(s=i.ledger)||void 0===s?void 0:s.type)||C.LedgerKeyring.type;break;case oe.HardwareDeviceNames.qr:a=_.MetaMaskKeyring.type;break;case oe.HardwareDeviceNames.lattice:a=(null==i||null===(o=i.lattice)||void 0===o?void 0:o.type)||v.default.type;break;default:throw new Error("MetamaskController:getKeyringForDevice - Unknown device")}let[l]=await this.keyringController.getKeyringsByType(a);if(l||(l=await this.keyringController.addNewKeyring(a)),t&&l.setHdPath&&l.setHdPath(t),e===oe.HardwareDeviceNames.lattice&&(l.appName="MetaMask"),e===oe.HardwareDeviceNames.trezor){const e=l.getModel();this.appStateController.setTrezorModel(e)}return l.network=this.networkController.state.providerConfig.type,l}async attemptLedgerTransportCreation(){const e=await this.getKeyringForDevice(oe.HardwareDeviceNames.ledger);return await e.attemptMakeApp()}async connectHardware(e,t,r){const n=await this.getKeyringForDevice(e,r);e===oe.HardwareDeviceNames.ledger&&await this.setLedgerTransportPreference(n);let s=[];switch(t){case-1:s=await n.getPreviousPage();break;case 1:s=await n.getNextPage();break;default:s=await n.getFirstPage()}const o=await this.keyringController.getAccounts(),i=[...new Set(o.concat(s.map((e=>e.address.toLowerCase()))))];return this.accountTracker.syncWithAddresses(i),s}async checkHardwareStatus(e,t){return(await this.getKeyringForDevice(e,t)).isUnlocked()}async forgetDevice(e){const t=await this.getKeyringForDevice(e);for(const e of t.accounts)await this.removeAccount(e);return t.forgetDevice(),!0}async getAccountType(e){switch(await this.keyringController.getAccountKeyringType(e)){case ie.KeyringType.trezor:case ie.KeyringType.lattice:case ie.KeyringType.qr:case ie.KeyringType.ledger:return"hardware";case ie.KeyringType.imported:return"imported";case ie.KeyringType.snap:return"snap";default:return"MetaMask"}}async getDeviceModel(e){const t=await this.keyringController.getKeyringForAccount(e);switch(t.type){case ie.KeyringType.trezor:return t.getModel();case ie.KeyringType.qr:return t.getName();case ie.KeyringType.ledger:return oe.HardwareDeviceNames.ledger;case ie.KeyringType.lattice:return oe.HardwareDeviceNames.lattice;default:return undefined}}getAccountLabel(e,t,r){return`${e[0].toUpperCase()}${e.slice(1)} ${parseInt(t,10)+1} ${r||""}`.trim()}async unlockHardwareWalletAccount(e,t,r,n){const s=await this.getKeyringForDevice(t,r);s.setAccountToUnlock(e);const o=await this.keyringController.getAccounts(),i=await this.keyringController.addNewAccountForKeyring(s),a=await this.keyringController.getAccounts();this.preferencesController.setAddresses(a),a.forEach((r=>{if(!o.includes(r)){const o=this.getAccountLabel(t===oe.HardwareDeviceNames.qr?s.getName():t,e,n);this.preferencesController.setAccountLabel(r,o),this.preferencesController.setSelectedAddress(r);const i=this.accountsController.getAccountByAddress(r);this.accountsController.setAccountName(i.id,o)}}));const l=this.accountsController.listAccounts(),{identities:c}=this.preferencesController.store.getState();return{...i,identities:c,accounts:l}}async addNewAccount(e){const t=await this.keyringController.getAccounts(),{addedAccountAddress:r}=await this.keyringController.addNewAccount(e);return t.includes(r)||this.preferencesController.setSelectedAddress(r),r}async getSeedPhrase(e){return this._convertEnglishWordlistIndicesToCodepoints(await this.keyringController.exportSeedPhrase(e))}async resetAccount(){const e=this.accountsController.getSelectedAccount().address;return this.txController.wipeTransactions(!1,e),this.smartTransactionsController.wipeSmartTransactions({address:e,ignoreNetwork:!1}),this.networkController.resetConnection(),e}async getPermittedAccounts(e,{suppressUnauthorizedError:t=!0}={}){try{return await this.permissionController.executeRestrictedMethod(e,ae.RestrictedMethods.eth_accounts)}catch(e){if(t&&e.code===f.errorCodes.provider.unauthorized)return[];throw e}}removeAllAccountPermissions(e){this.permissionController.updatePermissionsByCaveat(ae.CaveatTypes.restrictReturnedAccounts,(t=>rt.CaveatMutatorFactories[ae.CaveatTypes.restrictReturnedAccounts].removeAccount(e,t)))}async removeAccount(e){this.removeAllAccountPermissions(e);const t=await this.keyringController.getKeyringForAccount(e);await this.keyringController.removeAccount(e);const r=t?await t.getAccounts():{};var n;0===(null==r?void 0:r.length)&&(null===(n=t.destroy)||void 0===n||n.call(t));return e}async importAccountWithStrategy(e,t){const{importedAccountAddress:r}=await this.keyringController.importAccountWithStrategy(e,t);this.preferencesController.setSelectedAddress(r)}getAddTransactionRequest({transactionParams:e,transactionOptions:t,dappRequest:r}){var n;return{dappRequest:r,networkClientId:(null==r?void 0:r.networkClientId)??this.networkController.state.selectedNetworkClientId,selectedAccount:this.accountsController.getAccountByAddress(e.from),transactionController:this.txController,transactionOptions:t,transactionParams:e,userOperationController:this.userOperationController,ppomController:this.ppomController,securityAlertsEnabled:null===(n=this.preferencesController.store.getState())||void 0===n?void 0:n.securityAlertsEnabled,chainId:this.networkController.state.providerConfig.chainId}}async getCurrentAccountEIP1559Compatibility(){return!0}async createCancelTransaction(e,t,r){await this.txController.stopTransaction(e,t,r);return this.getState()}async createSpeedUpTransaction(e,t,r){await this.txController.speedUpTransaction(e,t,r);return this.getState()}async estimateGas(e){return new Promise(((t,r)=>new k.default(this.provider).estimateGas(e,((e,n)=>e?r(e):t(n.toString(16))))))}async updateSecurityAlertResponseByTxId(e,t){let r=!1;for(;!r;)r=te.SIGNING_METHODS.includes(e.method)?Object.values(this.signatureController.messages).find((t=>{var r;return(null===(r=t.securityAlertResponse)||void 0===r?void 0:r.securityAlertId)===e.securityAlertResponse.securityAlertId})):this.txController.state.transactions.find((t=>{var r;return(null===(r=t.securityAlertResponse)||void 0===r?void 0:r.securityAlertId)===e.securityAlertResponse.securityAlertId})),r||await new Promise((e=>setTimeout(e,100)));te.SIGNING_METHODS.includes(e.method)?this.appStateController.addSignatureSecurityAlertResponse(t):this.txController.updateSecurityAlertResponse(r.id,t)}markPasswordForgotten(){this.preferencesController.setPasswordForgotten(!0),this.sendUpdate()}unMarkPasswordForgotten(){this.preferencesController.setPasswordForgotten(!1),this.sendUpdate()}setUseRequestQueue(e){this.preferencesController.setUseRequestQueue(e)}setupUntrustedCommunication({connectionStream:e,sender:t,subjectType:r}){const{completedOnboarding:n}=this.onboardingController.store.getState(),{usePhishDetect:s}=this.preferencesController.store.getState();let o;if(o=r||(t.id&&t.id!==this.extension.runtime.id?L.SubjectType.Extension:L.SubjectType.Website),s&&n&&t.url){const{hostname:r}=new URL(t.url);this.phishingController.maybeUpdateState();const n=this.phishingController.test(r);if(null!=n&&n.result)return this.sendPhishingWarning(e,r),void this.metaMetricsController.trackEvent({event:ue.MetaMetricsEventName.PhishingPageDisplayed,category:ue.MetaMetricsEventCategory.Phishing,properties:{url:r}})}const i=(0,Be.setupMultiplex)(e);this.setupProviderConnection(i.createStream("metamask-provider"),t,o),t.url&&this.setupPublicConfig(i.createStream("publicConfig"))}setupTrustedCommunication(e,t){const r=(0,Be.setupMultiplex)(e);this.setupControllerConnection(r.createStream("controller")),this.setupProviderConnection(r.createStream("provider"),t,L.SubjectType.Internal)}setupPhishingCommunication({connectionStream:e}){const{usePhishDetect:t}=this.preferencesController.store.getState();if(!t)return;const r=(0,Be.setupMultiplex)(e).createStream("metamask-phishing-safelist");r.on("data",(0,Qe.default)({safelistPhishingDomain:this.safelistPhishingDomain.bind(this),backToSafetyPhishingWarning:this.backToSafetyPhishingWarning.bind(this)},r))}sendPhishingWarning(e,t){(0,Be.setupMultiplex)(e).createStream("phishing").write({hostname:t})}setupControllerConnection(e){const t=this.getApi();this.activeControllerConnections+=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),e.on("data",(0,Qe.default)(t,e));const r=t=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"sendUpdate",params:[t]})};this.on("update",r);const n=()=>{e._writableState.ended||e.write({jsonrpc:"2.0",method:"startUISync"})};this.startUISync?n():this.once("startUISync",n),e.on("end",(()=>{this.activeControllerConnections-=1,this.emit("controllerConnectionChanged",this.activeControllerConnections),this.removeListener("update",r)}))}setupProviderConnection(e,t,r){let n,o;n=r===L.SubjectType.Internal?de.ORIGIN_METAMASK:r===L.SubjectType.Snap?t.snapId:new URL(t.url).origin,t.id&&t.id!==this.extension.runtime.id&&this.subjectMetadataController.addSubjectMetadata({origin:n,extensionId:t.id,subjectType:L.SubjectType.Extension}),t.tab&&t.tab.id&&(o=t.tab.id);const i=this.setupProviderEngine({origin:n,sender:t,subjectType:r,tabId:o}),a=(0,Re.default)(),l=(0,c.createEngineStream)({engine:i}),d=this.addConnection(n,{engine:i});(0,s.default)(e,a,l,e,(e=>{i._middleware.forEach((e=>{e.destroy&&"function"==typeof e.destroy&&e.destroy()})),d&&this.removeConnection(n,d),e&&b.default.error(e)}))}setupSnapProvider(e,t){this.setupUntrustedCommunication({connectionStream:t,sender:{snapId:e},subjectType:L.SubjectType.Snap})}setupProviderEngine({origin:e,subjectType:t,sender:r,tabId:n}){const s=new l.JsonRpcEngine;s.push((0,Le.default)({origin:e})),s.push((0,U.createSelectedNetworkMiddleware)(this.controllerMessenger));const o=this.selectedNetworkController.getProviderAndBlockTracker(e),i=(0,Q.createQueuedRequestMiddleware)({enqueueRequest:this.queuedRequestController.enqueueRequest.bind(this.queuedRequestController),useRequestQueue:this.preferencesController.getUseRequestQueue.bind(this.preferencesController),methodsWithConfirmation:ee.methodsWithConfirmation});s.push(i);const a=(0,g.default)(o),c=(0,m.default)(o);return c.events.on("notification",(e=>s.emit("notification",e))),n&&s.push((0,De.default)({tabId:n})),s.push((0,xe.default)({origin:e})),s.push(this.permissionLogController.createMiddleware()),s.push((0,Ae.createPPOMMiddleware)(this.ppomController,this.preferencesController,this.networkController,this.appStateController,this.updateSecurityAlertResponseByTxId.bind(this))),s.push((0,nt.default)({trackEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getMetricsState:this.metaMetricsController.store.getState.bind(this.metaMetricsController.store),getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),snapAndHardwareMessenger:this.controllerMessenger.getRestricted({name:"SnapAndHardwareMessenger",allowedActions:["KeyringController:getKeyringForAccount","SnapController:get","AccountsController:getSelectedAccount"]}),appStateController:this.appStateController})),t===L.SubjectType.Website&&s.push((0,Fe.default)({location:r.url,registerOnboarding:this.onboardingController.registerOnboarding})),s.push((0,Oe.createMethodMiddleware)({origin:e,subjectType:t,addSubjectMetadata:this.subjectMetadataController.addSubjectMetadata.bind(this.subjectMetadataController),metamaskState:this.getState(),getProviderState:this.getProviderState.bind(this),getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),handleWatchAssetRequest:this.handleWatchAssetRequest.bind(this),requestUserApproval:this.approvalController.addAndShowApprovalRequest.bind(this.approvalController),startApprovalFlow:this.approvalController.startFlow.bind(this.approvalController),endApprovalFlow:this.approvalController.endFlow.bind(this.approvalController),setApprovalFlowLoadingText:this.approvalController.setFlowLoadingText.bind(this.approvalController),showApprovalSuccess:this.approvalController.success.bind(this.approvalController),showApprovalError:this.approvalController.error.bind(this.approvalController),sendMetrics:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),getAccounts:this.getPermittedAccounts.bind(this,e),getPermissionsForOrigin:this.permissionController.getPermissions.bind(this.permissionController,e),hasPermission:this.permissionController.hasPermission.bind(this.permissionController,e),hasPermissions:this.permissionController.hasPermissions.bind(this.permissionController,e),requestAccountsPermission:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e},{eth_accounts:{}}),requestPermissionsForOrigin:this.permissionController.requestPermissions.bind(this.permissionController,{origin:e}),revokePermissionsForOrigin:t=>{try{this.permissionController.revokePermissions({[e]:t})}catch(e){console.log(e)}},getCurrentChainId:()=>this.networkController.state.providerConfig.chainId,getCurrentRpcUrl:()=>this.networkController.state.providerConfig.rpcUrl,getNetworkConfigurations:()=>this.networkController.state.networkConfigurations,upsertNetworkConfiguration:this.networkController.upsertNetworkConfiguration.bind(this.networkController),setActiveNetwork:e=>{this.networkController.setActiveNetwork(e)},findNetworkClientIdByChainId:this.networkController.findNetworkClientIdByChainId.bind(this.networkController),findNetworkConfigurationBy:this.findNetworkConfigurationBy.bind(this),getNetworkClientIdForDomain:this.selectedNetworkController.getNetworkClientIdForDomain.bind(this.selectedNetworkController),setNetworkClientIdForDomain:this.selectedNetworkController.setNetworkClientIdForDomain.bind(this.selectedNetworkController),getUseRequestQueue:this.preferencesController.getUseRequestQueue.bind(this.preferencesController),getProviderConfig:()=>this.networkController.state.providerConfig,setProviderType:e=>this.networkController.setProviderType(e),getWeb3ShimUsageState:this.alertController.getWeb3ShimUsageState.bind(this.alertController),setWeb3ShimUsageRecorded:this.alertController.setWeb3ShimUsageRecorded.bind(this.alertController)})),s.push((0,$.createSnapsMethodMiddleware)(t===L.SubjectType.Snap,{getUnlockPromise:this.appStateController.getUnlockPromise.bind(this.appStateController),getSnaps:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getPermitted",e),requestPermissions:async t=>await this.permissionController.requestPermissions({origin:e},t),getPermissions:this.permissionController.getPermissions.bind(this.permissionController,e),getSnapFile:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getFile",e),installSnaps:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:install",e),getIsLocked:()=>!this.appStateController.isUnlocked(),hasPermission:this.permissionController.hasPermission.bind(this.permissionController,e),getSnap:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:get"),getAllSnaps:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapController:getAll"),handleSnapRpcRequest:t=>this.handleSnapRequest({...t,origin:e}),getAllowedKeyringMethods:(0,Se.keyringSnapPermissionsBuilder)(this.subjectMetadataController,e),createInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:createInterface",e),getInterfaceState:(...t)=>this.controllerMessenger.call("SnapInterfaceController:getInterface",e,...t).state,updateInterface:this.controllerMessenger.call.bind(this.controllerMessenger,"SnapInterfaceController:updateInterface",e)})),s.push(a),s.push(c.middleware),t!==L.SubjectType.Internal&&s.push(this.permissionController.createPermissionMiddleware({origin:e})),s.push(this.metamaskMiddleware),s.push((0,d.providerAsMiddleware)(o.provider)),s}setupPublicConfig(e){const t=(0,a.storeAsStream)(this.publicConfigStore);(0,s.default)(t,e,(e=>{t.destroy(),e&&b.default.error(e)}))}addConnection(e,{engine:t}){if(e===de.ORIGIN_METAMASK)return null;this.connections[e]||(this.connections[e]={});const r=(0,T.default)();return this.connections[e][r]={engine:t},r}removeConnection(e,t){const r=this.connections[e];r&&(delete r[t],0===Object.keys(r).length&&delete this.connections[e])}removeAllConnections(e){const t=this.connections[e];t&&Object.keys(t).forEach((t=>{this.removeConnection(e,t)}))}notifyConnections(e,t){const r=this.connections[e];r&&Object.values(r).forEach((e=>{e.engine&&e.engine.emit("notification",t)}))}notifyAllConnections(e){const t="function"==typeof e?t=>e(t):()=>e;Object.keys(this.connections).forEach((e=>{Object.values(this.connections[e]).forEach((async r=>{try{r.engine&&r.engine.emit("notification",await t(e))}catch(e){console.error(e)}}))}))}async _onKeyringControllerUpdate(e){const{keyrings:t}=e,r=t.reduce(((e,{accounts:t})=>e.concat(t)),[]);r.length&&(this.preferencesController.syncAddresses(r),this.accountTracker.syncWithAddresses(r))}_onUnlock(){this.notifyAllConnections((async e=>({method:rt.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!0,accounts:await this.getPermittedAccounts(e)}}))),this.unMarkPasswordForgotten(),this.emit("unlock")}_onLock(){this.notifyAllConnections({method:rt.NOTIFICATION_NAMES.unlockStateChanged,params:{isUnlocked:!1}}),this.emit("lock")}_onStateUpdate(e){this.isClientOpenAndUnlocked=e.isUnlocked&&this._isClientOpen,this._notifyChainChange()}privateSendUpdate(){this.emit("update",this.getState())}isUnlocked(){return this.keyringController.state.isUnlocked}getExternalPendingTransactions(e){return this.smartTransactionsController.getTransactions({addressFrom:e,status:"pending"})}async getPendingNonce(e,t){const{nonceDetails:r,releaseLock:n}=await this.txController.getNonceLock(e,undefined),s=r.params.highestSuggested;return n(),s}async getNextNonce(e,t){const r=await this.txController.getNonceLock(e,undefined);return r.releaseLock(),r.nextNonce}throwTestError(e){setTimeout((()=>{const t=new Error(e);throw t.name="TestError",t}))}_addTransactionControllerListeners(){const e=this.getTransactionMetricsRequest();this.controllerMessenger.subscribe("TransactionController:postTransactionBalanceUpdated",ve.handlePostTransactionBalanceUpdate.bind(null,e)),this.controllerMessenger.subscribe("TransactionController:unapprovedTransactionAdded",(t=>(0,ve.handleTransactionAdded)(e,{transactionMeta:t}))),this.controllerMessenger.subscribe("TransactionController:transactionApproved",ve.handleTransactionApproved.bind(null,e)),this.controllerMessenger.subscribe("TransactionController:transactionDropped",ve.handleTransactionDropped.bind(null,e)),this.controllerMessenger.subscribe("TransactionController:transactionConfirmed",ve.handleTransactionConfirmed.bind(null,e)),this.controllerMessenger.subscribe("TransactionController:transactionFailed",ve.handleTransactionFailed.bind(null,e)),this.controllerMessenger.subscribe("TransactionController:transactionNewSwap",(({transactionMeta:e})=>this.swapsController.setTradeTxId(e.id))),this.controllerMessenger.subscribe("TransactionController:transactionNewSwapApproval",(({transactionMeta:e})=>this.swapsController.setApproveTxId(e.id))),this.controllerMessenger.subscribe("TransactionController:transactionRejected",ve.handleTransactionRejected.bind(null,e)),this.controllerMessenger.subscribe("TransactionController:transactionSubmitted",ve.handleTransactionSubmitted.bind(null,e)),this.controllerMessenger.subscribe("TransactionController:transactionStatusUpdated",(({transactionMeta:e})=>{this._onFinishedTransaction(e)}))}getTransactionMetricsRequest(){return{...{createEventFragment:this.metaMetricsController.createEventFragment.bind(this.metaMetricsController),finalizeEventFragment:this.metaMetricsController.finalizeEventFragment.bind(this.metaMetricsController),getEventFragmentById:this.metaMetricsController.getEventFragmentById.bind(this.metaMetricsController),getParticipateInMetrics:()=>this.metaMetricsController.state.participateInMetaMetrics,trackEvent:this.metaMetricsController.trackEvent.bind(this.metaMetricsController),updateEventFragment:this.metaMetricsController.updateEventFragment.bind(this.metaMetricsController),getAccountType:this.getAccountType.bind(this),getDeviceModel:this.getDeviceModel.bind(this),getEIP1559GasFeeEstimates:this.gasFeeController.fetchGasFeeEstimates.bind(this.gasFeeController),getSelectedAddress:()=>this.preferencesController.store.getState().selectedAddress,getTokenStandardAndDetails:this.getTokenStandardAndDetails.bind(this),getTransaction:e=>this.txController.state.transactions.find((t=>t.id===e)),getIsSmartTransaction:()=>(0,Ce.getIsSmartTransaction)(this._getMetaMaskState()),getSmartTransactionByMinedTxHash:e=>this.smartTransactionsController.getSmartTransactionByMinedTxHash(e)},snapAndHardwareMessenger:this.controllerMessenger.getRestricted({name:"SnapAndHardwareMessenger",allowedActions:["KeyringController:getKeyringForAccount","SnapController:get","AccountsController:getSelectedAccount"]}),provider:this.provider}}toggleExternalServices(e){this.preferencesController.toggleExternalServices(e),this.tokenListController.updatePreventPollingOnNetworkRestart(!e),e?(this.tokenDetectionController.enable(),this.gasFeeController.enableNonRPCGasFeeApis()):(this.tokenDetectionController.disable(),this.gasFeeController.disableNonRPCGasFeeApis())}findNetworkConfigurationBy(e){const{networkConfigurations:t}=this.networkController.state;return Object.values(t).find((t=>Object.keys(e).some((r=>t[r]===e[r]))))||null}async setLedgerTransportPreference(e){const t=window.navigator.hid?oe.LedgerTransportTypes.webhid:oe.LedgerTransportTypes.u2f,r=e||await this.getKeyringForDevice(oe.HardwareDeviceNames.ledger);return null!=r&&r.updateTransportMethod?r.updateTransportMethod(t).catch((e=>{throw e})):undefined}recordFirstTimeInfo(e){if(!("firstTimeInfo"in e)){const t=this.platform.getVersion();e.firstTimeInfo={version:t,date:Date.now()}}}set isClientOpen(e){this._isClientOpen=e}onClientClosed(){try{this.gasFeeController.stopAllPolling(),this.currencyRateController.stopAllPolling(),this.appStateController.clearPollingTokens()}catch(e){console.error(e)}}onEnvironmentTypeClosed(e){const t=de.POLLING_TOKEN_ENVIRONMENT_TYPES[e];this.appStateController.store.getState()[t].forEach((e=>{this.gasFeeController.stopPollingByPollingToken(e),this.currencyRateController.stopPollingByPollingToken(e),this.appStateController.removePollingToken(e,t)}))}safelistPhishingDomain(e){return this.phishingController.bypass(e)}async backToSafetyPhishingWarning(){const e=this.platform.getExtensionURL();await this.platform.switchToAnotherURL(undefined,e)}setLocked(){return this.keyringController.setLocked()}async _onAccountChange(e){const t=(0,rt.getPermittedAccountsByOrigin)(this.permissionController.state);for(const[r,n]of t.entries())n.includes(e)&&this._notifyAccountsChange(r,n);await this.txController.updateIncomingTransactions()}async _notifyAccountsChange(e,t){this.isUnlocked()&&this.notifyConnections(e,{method:rt.NOTIFICATION_NAMES.accountsChanged,params:t.length<2?t:await this.getPermittedAccounts(e)}),this.permissionLogController.updateAccountsHistory(e,t)}async _notifyChainChange(){this.preferencesController.getUseRequestQueue()?this.notifyAllConnections((async e=>({method:rt.NOTIFICATION_NAMES.chainChanged,params:await this.getProviderNetworkState(e)}))):this.notifyAllConnections({method:rt.NOTIFICATION_NAMES.chainChanged,params:await this.getProviderNetworkState()})}async _onFinishedTransaction(e){[X.TransactionStatus.confirmed,X.TransactionStatus.failed].includes(e.status)&&(await this._createTransactionNotifcation(e),this._updateNFTOwnership(e),this._trackTransactionFailure(e))}async _createTransactionNotifcation(e){const{chainId:t}=e;let r={};if(t){const{networkConfigurations:e}=this.networkController.state,n=Object.values(e).find((e=>e.chainId===t));r=(null==n?void 0:n.rpcPrefs)??{}}try{await this.platform.showTransactionNotification(e,r)}catch(e){b.default.error("Failed to create transaction notification",e)}}_updateNFTOwnership(e){var t;const{type:r,txParams:n,chainId:s}=e;if(r!==X.TransactionType.tokenMethodTransferFrom||n===undefined)return;const{data:o,to:i,from:a}=n,l=(0,me.parseStandardTokenTransactionData)(o),c=(0,pe.getTokenIdParam)(l)??(0,ye.getTokenValueParam)(l),{allNfts:d}=this.nftController.state,u=null==d||null===(t=d[a])||void 0===t||null===(t=t[s])||void 0===t?void 0:t.find((({address:e,tokenId:t})=>(0,ge.isEqualCaseInsensitive)(e,i)&&t===c));u&&this.nftController.checkAndUpdateSingleNftOwnershipStatus(u,!1,{userAddress:a})}_trackTransactionFailure(e){var t;const{txReceipt:r}=e,n=this.getState();r&&"0x0"===r.status&&this.metaMetricsController.trackEvent({event:"Tx Status Update: On-Chain Failure",category:ue.MetaMetricsEventCategory.Background,properties:{action:"Transactions",errorMessage:null===(t=e.simulationFails)||void 0===t?void 0:t.reason,numberOfTokens:n.tokens.length,numberOfAccounts:Object.keys(n.accounts).length}},{matomoEvent:!0})}_onUserOperationAdded(e){const t=this.txController.state.transactions.find((t=>t.id===e.id));t&&(t.type===X.TransactionType.swap?this.controllerMessenger.publish("TransactionController:transactionNewSwap",{transactionMeta:t}):t.type===X.TransactionType.swapApproval&&this.controllerMessenger.publish("TransactionController:transactionNewSwapApproval",{transactionMeta:t}))}_onUserOperationTransactionUpdated(e){const t={...e,txParams:{...e.txParams,from:this.preferencesController.getSelectedAddress()}};this.txController.state.transactions.some((e=>e.id===t.id))||this.txController.update((e=>{e.transactions.push(t)})),this.txController.updateTransaction(t,"Generated from user operation"),this.controllerMessenger.publish("TransactionController:transactionStatusUpdated",{updatedTransactionMeta:t})}_publishSmartTransactionHook(e){const t=this._getMetaMaskState(),r=(0,Ce.getIsSmartTransaction)(t);if(!r)return{transactionHash:undefined};const n=(0,Ce.getFeatureFlagsByChainId)(t);return(0,_e.submitSmartTransactionHook)({transactionMeta:e,transactionController:this.txController,smartTransactionsController:this.smartTransactionsController,controllerMessenger:this.controllerMessenger,isSmartTransaction:r,featureFlags:n})}_getMetaMaskState(){return{metamask:this.getState()}}}async function Tt(e,t){var r;const{currentLocale:n}=e,{chainId:s}=this.networkController.state.providerConfig;await(0,ot.updateCurrentLocale)(n),null!==(r=e.incomingTransactionsPreferences)&&void 0!==r&&r[s]?this.txController.startIncomingTransactionPolling():this.txController.stopIncomingTransactionPolling(),Ct(this,_t,Et).call(this,e,t),this.controllerMessenger.publish("PreferencesController:stateChange",e,[])}function Et(e,t){const r=Ct(this,St,At).call(this,t),n=Ct(this,St,At).call(this,e);r!==n&&(this.tokenListController.updatePreventPollingOnNetworkRestart(!n),n?(b.default.debug("Started token list controller polling"),this.tokenListController.start()):(b.default.debug("Stopped token list controller polling"),this.tokenListController.clearingTokenListData(),this.tokenListController.stop()))}function At(e){const{useTokenDetection:t,useTransactionSimulations:r,preferences:n}=e??{},{petnamesEnabled:s}=n??{};return t||s||r}r.default=kt}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"$root$",file:"app/scripts/metamask-controller.js"}],[99,{lodash:3638},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e("lodash");r.default={version:2,migrate(e){const t=(0,n.cloneDeep)(e);t.meta.version=2;try{"etherscan"===t.data.config.provider.type&&(t.data.config.provider.type="rpc",t.data.config.provider.rpcTarget="https://rpc.metamask.io/")}catch(e){}return Promise.resolve(t)}}}}},{package:"$root$",file:"app/scripts/migrations/002.js"}],[4,{"../../shared/constants/app":4343,"../../shared/constants/metametrics":4353,"../../shared/modules/browser-runtime.utils":4380,"../../shared/modules/mv3.utils":4393,"../../shared/modules/object.utils":4395,"./first-time-state":31,"./lib/createStreamSink":47,"./lib/ens-ipfs/setup":53,"./lib/get-first-preferred-lang-code":55,"./lib/getObjStructure":56,"./lib/local-store":59,"./lib/migrator":62,"./lib/network-store":63,"./lib/notification-manager":64,"./lib/setup-initial-state-hooks":86,"./lib/setupSentry":87,"./lib/util":97,"./metamask-controller":98,"./migrations":222,"./platforms/extension":223,"@metamask/controller-utils":1094,"@metamask/obs-store":1523,"@metamask/utils":2072,"debounce-stream":2938,"end-of-stream":2977,"eth-rpc-errors":3026,events:3097,"extension-port-stream":3100,loglevel:3644,pump:3852,"webextension-polyfill":4322},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,r){Object.defineProperty(r,"__esModule",{value:!0}),r.loadStateFromPersistence=le,r.setupController=de,r.statePersistenceEvents=void 0,e("./lib/setup-initial-state-hooks");var n=O(e("events")),s=O(e("end-of-stream")),o=O(e("pump")),i=O(e("debounce-stream")),a=O(e("loglevel")),l=O(e("webextension-polyfill")),c=e("@metamask/obs-store"),d=e("@metamask/utils"),u=e("@metamask/controller-utils"),h=O(e("extension-port-stream")),p=e("eth-rpc-errors"),g=e("../../shared/constants/app"),m=e("../../shared/constants/metametrics"),f=e("../../shared/modules/browser-runtime.utils"),y=e("../../shared/modules/mv3.utils"),b=e("../../shared/modules/object.utils"),w=O(e("./migrations")),C=O(e("./lib/migrator")),v=O(e("./platforms/extension")),_=O(e("./lib/local-store")),S=(O(e("./lib/network-store")),e("./lib/setupSentry")),k=O(e("./lib/createStreamSink")),T=x(e("./lib/notification-manager")),E=x(e("./metamask-controller")),A=O(e("./first-time-state")),M=O(e("./lib/get-first-preferred-lang-code")),P=O(e("./lib/getObjStructure")),N=O(e("./lib/ens-ipfs/setup")),I=e("./lib/util");function R(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(R=function(e){return e?r:t})(e)}function x(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=R(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=s?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}function O(e){return e&&e.__esModule?e:{default:e}}const L=new _.default;global.stateHooks.getMostRecentPersistedState=()=>L.mostRecentRetrievedState;const{sentry:D}=global,U={...A.default},j={[g.ENVIRONMENT_TYPE_POPUP]:!0,[g.ENVIRONMENT_TYPE_NOTIFICATION]:!0,[g.ENVIRONMENT_TYPE_FULLSCREEN]:!0},F=["trezor-connect"];a.default.setLevel("info",!1);const B=new v.default,q=new T.default;let K=0,$=!1,H=!1;const G={},W={};let z,V;const Y={};const Q=new URL("https://metamask.github.io/phishing-warning/v3.0.3/"),J=1e3,X=r.statePersistenceEvents=new n.default,{promise:Z,resolve:ee,reject:te}=(0,I.deferredPromise)(),re=async()=>{const e=await l.default.tabs.query({url:"<all_urls>",windowType:"normal"}).then((e=>((0,f.checkForLastErrorAndLog)(),e))).catch((()=>{(0,f.checkForLastErrorAndLog)()}));for(const t of e)l.default.tabs.sendMessage(t.id,{name:g.EXTENSION_MESSAGES.READY}).then((()=>{(0,f.checkForLastErrorAndLog)()})).catch((()=>{(0,f.checkForLastErrorAndLog)()}))};let ne,se;function oe(){const e=(new Date).toISOString();l.default.storage.session.set({timestamp:e})}async function ie(){try{const t=await le(),r=t.data,n=await(0,M.default)();let s;if(y.isManifestV3){var e;if(!1!==(null===(e=r.PreferencesController)||void 0===e?void 0:e.enableMV3TimestampSave)){const e=2e3;oe(),setInterval(oe,e)}const t=await l.default.storage.session.get(["isFirstMetaMaskControllerSetup"]);s=(null==t?void 0:t.isFirstMetaMaskControllerSetup)===undefined,await l.default.storage.session.set({isFirstMetaMaskControllerSetup:s})}de(r,n,{},s,t.meta),y.isManifestV3||await async function(){let e;try{const t=new URL("https://metamask.github.io/phishing-warning/v3.0.3/");let r,n;t.hash="#extensionStartup",e=window.document.createElement("iframe"),e.setAttribute("src",t.href),e.setAttribute("sandbox","allow-scripts allow-same-origin");const s=new Promise(((e,t)=>{r=e,n=t}));e.addEventListener("load",r),window.document.body.appendChild(e),setTimeout((()=>n(new ae)),J),await s}catch(e){e instanceof ae?console.warn("Phishing warning page timeout; page not guaranteed to work offline."):console.error("Failed to initialize phishing warning page",e)}finally{e&&e.remove()}}(),await re(),a.default.info("MetaMask initialization complete."),ee()}catch(e){te(e)}}l.default.runtime.onConnect.addListener((async(...e)=>{await Z,ne(...e)})),l.default.runtime.onConnectExternal.addListener((async(...e)=>{await Z,se(...e)}));class ae extends Error{constructor(){super("Timeout failed")}}async function le(){const e=new C.default({migrations:w.default});if(e.on("error",console.warn),V=await L.get()||e.generateInitialState(U),V&&!V.data&&(V=e.generateInitialState(U),D.captureMessage("MetaMask - Empty vault found - unable to recover")),e.on("error",(e=>{const t=(0,P.default)(V);D.captureException(e,{extra:{vaultStructure:t}})})),V=await e.migrateData(V),!V)throw new Error("MetaMask - migrator returned undefined");if(!(0,d.isObject)(V.meta))throw new Error(`MetaMask - migrator metadata has invalid type '${typeof V.meta}'`);if("number"!=typeof V.meta.version)throw new Error(`MetaMask - migrator metadata version has invalid type '${typeof V.meta.version}'`);if(!(0,d.isObject)(V.data))throw new Error(`MetaMask - migrator data has invalid type '${typeof V.data}'`);return L.setMetadata(V.meta),L.set(V.data),V}function ce(e,t,r){const{metaMetricsId:n}=z.metaMetricsController.state;if(!(0,I.shouldEmitDappViewedEvent)(n))return;if(!(0,d.hasProperty)(t.permissions,"eth_accounts"))return;const s=Object.keys(r.store.getState().identities).length,o=t.permissions.eth_accounts.caveats;if(o){const t=o[0].value.length;z.metaMetricsController.trackEvent({event:m.MetaMetricsEventName.DappViewed,category:m.MetaMetricsEventCategory.InpageProvider,referrer:{url:e},properties:{is_first_visit:!1,number_of_accounts:s,number_of_accounts_connected:t}})}}function de(e,t,r,n,d){var f;z=new E.default({infuraProjectId:"b6bf7d3508c941499b10025c0776eaf8",showUserConfirmation:ue,initState:e,initLangCode:t,platform:B,notificationManager:q,browser:l.default,getRequestAccountTabIds:()=>W,getOpenMetamaskTabsIds:()=>G,localStore:L,overrides:r,isFirstMetaMaskControllerSetup:n,currentMigrationVersion:d.version,featureFlags:{}}),(0,N.default)({getCurrentChainId:()=>z.networkController.state.providerConfig.chainId,getIpfsGateway:z.preferencesController.getIpfsGateway.bind(z.preferencesController),getUseAddressBarEnsResolution:()=>z.preferencesController.store.getState().useAddressBarEnsResolution,provider:z.provider}),(0,o.default)((0,c.storeAsStream)(z.store),(0,i.default)(1e3),(0,k.default)((async e=>{await L.set(e),X.emit("state-persisted",e)})),(e=>{a.default.error("MetaMask - Persistence pipeline failed",e)})),f=z,global.stateHooks.getSentryAppState=function(){const e=f.memStore.getState();return(0,b.maskObject)(e,S.SENTRY_BACKGROUND_STATE)};const w=()=>K>0||Boolean(Object.keys(G).length)||$,C=(e,t)=>{if(!1===e)z.onClientClosed();else{if(t===g.ENVIRONMENT_TYPE_FULLSCREEN&&Boolean(Object.keys(G).length))return;z.onEnvironmentTypeClosed(t)}};function v(){let e="";const t=_();t&&(e=String(t)),y.isManifestV3?(l.default.action.setBadgeText({text:e}),l.default.action.setBadgeBackgroundColor({color:"#037DD6"})):(l.default.browserAction.setBadgeText({text:e}),l.default.browserAction.setBadgeBackgroundColor({color:"#037DD6"}))}function _(){let e=z.appStateController.waitingForUnlock.length+z.approvalController.getTotalApprovalCount();return z.preferencesController.getUseRequestQueue()&&(e+=z.queuedRequestController.state.queuedRequestCount),e}ne=async e=>{var t;const n=e.name;if(F.includes(e.name))return;let o=!1;const i=(0,I.getPlatform)(),a=null!==(t=e.sender)&&void 0!==t&&t.url?new URL(e.sender.url):null;if(o=i===g.PLATFORM_FIREFOX?j[n]:(null==a?void 0:a.origin)===`chrome-extension://${l.default.runtime.id}`,o){var c;const t=(null==r||null===(c=r.getPortStream)||void 0===c?void 0:c.call(r,e))||new h.default(e);if(z.isClientOpen=!0,z.setupTrustedCommunication(t,e.sender),n===g.ENVIRONMENT_TYPE_POPUP&&(K+=1,(0,s.default)(t,(()=>{K-=1;const e=w();z.isClientOpen=e,C(e,g.ENVIRONMENT_TYPE_POPUP)}))),n===g.ENVIRONMENT_TYPE_NOTIFICATION&&($=!0,(0,s.default)(t,(()=>{$=!1;const e=w();z.isClientOpen=e,C(e,g.ENVIRONMENT_TYPE_NOTIFICATION)}))),n===g.ENVIRONMENT_TYPE_FULLSCREEN){const r=e.sender.tab.id;G[r]=!0,(0,s.default)(t,(()=>{delete G[r];const e=w();z.isClientOpen=e,C(e,g.ENVIRONMENT_TYPE_FULLSCREEN)}))}}else if(a&&a.origin===Q.origin&&a.pathname===Q.pathname){var d;const t=(null==r||null===(d=r.getPortStream)||void 0===d?void 0:d.call(r,e))||new h.default(e);z.setupPhishingCommunication({connectionStream:t})}else{if(e.sender&&e.sender.tab&&e.sender.url){const t=e.sender.tab.id,r=new URL(e.sender.url),{origin:n}=r;Object.keys(Y).includes(t)||(Y[t]=n);const s=z.permissionController.state.subjects[n],o=s!==undefined,i="New Tab"!==e.sender.tab.title;o&&i&&ce(n,s,z.preferencesController),e.onMessage.addListener((e=>{e.data&&e.data.method===g.MESSAGE_TYPE.ETH_REQUEST_ACCOUNTS&&(W[n]=t)}))}se(e)}},se=e=>{var t;const n=(null==r||null===(t=r.getPortStream)||void 0===t?void 0:t.call(r,e))||new h.default(e);z.setupUntrustedCommunication({connectionStream:n,sender:e.sender})},null!=r&&r.registerConnectListeners&&r.registerConnectListeners(ne,se),v(),z.decryptMessageController.hub.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,v),z.encryptionPublicKeyController.hub.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,v),z.signatureController.hub.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,v),z.appStateController.on(E.METAMASK_CONTROLLER_EVENTS.UPDATE_BADGE,v),z.controllerMessenger.subscribe(E.METAMASK_CONTROLLER_EVENTS.APPROVAL_STATE_CHANGE,v),z.controllerMessenger.subscribe(E.METAMASK_CONTROLLER_EVENTS.QUEUED_REQUEST_STATE_CHANGE,v),z.txController.initApprovals(),q.on(T.NOTIFICATION_MANAGER_EVENTS.POPUP_CLOSED,(({automaticallyClosed:e})=>{e?_()>0&&ue():(z.signatureController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE_SIG),z.decryptMessageController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),z.encryptionPublicKeyController.rejectUnapproved(m.REJECT_NOTIFICATION_CLOSE),Object.values(z.approvalController.state.pendingApprovals).forEach((({id:e,type:t})=>{switch(t){case u.ApprovalType.SnapDialogAlert:case u.ApprovalType.SnapDialogPrompt:z.approvalController.accept(e,null);break;case u.ApprovalType.SnapDialogConfirmation:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval:case g.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect:z.approvalController.accept(e,!1);break;default:z.approvalController.reject(e,p.ethErrors.provider.userRejectedRequest())}}))),v()})),Object.values(z.snapController.state.snaps).some((e=>!e.preinstalled))&&z.snapController.updateBlockedSnaps()}async function ue(){const e=await B.getActiveTabs(),t=Boolean(e.find((e=>G[e.id]))),r=e.length>0&&e[0].extData&&e[0].extData.indexOf("vivaldi_tab")>-1;if(!H&&(r||0===K)&&!t){H=!0;try{const e=z.appStateController.getCurrentPopupId();await q.showPopup((e=>z.appStateController.setCurrentPopupId(e)),e)}finally{H=!1}}}const he=()=>{if(z)return z.metaMetricsController.updateTraits({[m.MetaMetricsUserTrait.InstallDateExt]:(new Date).toISOString().split("T")[0]}),void z.metaMetricsController.addEventBeforeMetricsOptIn({category:m.MetaMetricsEventCategory.App,event:m.MetaMetricsEventName.AppInstalled,properties:{}});setTimeout((()=>{he()}),500)};async function pe(){Boolean(await L.get())||(he(),B.openExtensionInBrowser()),l.default.tabs.onActivated.addListener((e=>{if(z){const{tabId:t}=e,r=Y[t];if(r){const e=z.permissionController.state.subjects[r];e!==undefined&&ce(r,e,z.preferencesController)}}}))}(async function(){await pe(),ie().catch(a.default.error)})()}}},{package:"$root$",file:"app/scripts/background.js"}]],[4],{});