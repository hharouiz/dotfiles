var Pe=Object.create;var ue=Object.defineProperty;var je=Object.getOwnPropertyDescriptor;var Ne=Object.getOwnPropertyNames;var Re=Object.getPrototypeOf,De=Object.prototype.hasOwnProperty;var Fe=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var ze=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Ne(t))!De.call(e,i)&&i!==r&&ue(e,i,{get:()=>t[i],enumerable:!(n=je(t,i))||n.enumerable});return e};var Y=(e,t,r)=>(r=e!=null?Pe(Re(e)):{},ze(t||!e||!e.__esModule?ue(r,"default",{value:e,enumerable:!0}):r,e));var Q=Fe((Z,ce)=>{(function(e,t){if(typeof define=="function"&&define.amd)define("webextension-polyfill",["module"],t);else if(typeof Z<"u")t(ce);else{var r={exports:{}};t(r),e.browser=r.exports}})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:Z,function(e){"use strict";if(!globalThis.chrome?.runtime?.id)throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){let t="The message port closed before a response was received.",r=n=>{let i={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(i).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class o extends WeakMap{constructor(u,g=void 0){super(g),this.createItem=u}get(u){return this.has(u)||this.set(u,this.createItem(u)),super.get(u)}}let c=l=>l&&typeof l=="object"&&typeof l.then=="function",s=(l,u)=>(...g)=>{n.runtime.lastError?l.reject(new Error(n.runtime.lastError.message)):u.singleCallbackArg||g.length<=1&&u.singleCallbackArg!==!1?l.resolve(g[0]):l.resolve(g)},p=l=>l==1?"argument":"arguments",a=(l,u)=>function(_,...w){if(w.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${p(u.minArgs)} for ${l}(), got ${w.length}`);if(w.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${p(u.maxArgs)} for ${l}(), got ${w.length}`);return new Promise((T,O)=>{if(u.fallbackToNoCallback)try{_[l](...w,s({resolve:T,reject:O},u))}catch(d){console.warn(`${l} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,d),_[l](...w),u.fallbackToNoCallback=!1,u.noCallback=!0,T()}else u.noCallback?(_[l](...w),T()):_[l](...w,s({resolve:T,reject:O},u))})},y=(l,u,g)=>new Proxy(u,{apply(_,w,T){return g.call(w,l,...T)}}),x=Function.call.bind(Object.prototype.hasOwnProperty),N=(l,u={},g={})=>{let _=Object.create(null),w={has(O,d){return d in l||d in _},get(O,d,C){if(d in _)return _[d];if(!(d in l))return;let h=l[d];if(typeof h=="function")if(typeof u[d]=="function")h=y(l,l[d],u[d]);else if(x(g,d)){let D=a(d,g[d]);h=y(l,l[d],D)}else h=h.bind(l);else if(typeof h=="object"&&h!==null&&(x(u,d)||x(g,d)))h=N(h,u[d],g[d]);else if(x(g,"*"))h=N(h,u[d],g["*"]);else return Object.defineProperty(_,d,{configurable:!0,enumerable:!0,get(){return l[d]},set(D){l[d]=D}}),h;return _[d]=h,h},set(O,d,C,h){return d in _?_[d]=C:l[d]=C,!0},defineProperty(O,d,C){return Reflect.defineProperty(_,d,C)},deleteProperty(O,d){return Reflect.deleteProperty(_,d)}},T=Object.create(l);return new Proxy(T,w)},R=l=>({addListener(u,g,..._){u.addListener(l.get(g),..._)},hasListener(u,g){return u.hasListener(l.get(g))},removeListener(u,g){u.removeListener(l.get(g))}}),S=new o(l=>typeof l!="function"?l:function(g){let _=N(g,{},{getContent:{minArgs:0,maxArgs:0}});l(_)}),V=new o(l=>typeof l!="function"?l:function(g,_,w){let T=!1,O,d=new Promise(L=>{O=function(k){T=!0,L(k)}}),C;try{C=l(g,_,O)}catch(L){C=Promise.reject(L)}let h=C!==!0&&c(C);if(C!==!0&&!h&&!T)return!1;let D=L=>{L.then(k=>{w(k)},k=>{let K;k&&(k instanceof Error||typeof k.message=="string")?K=k.message:K="An unexpected error occurred",w({__mozWebExtensionPolyfillReject__:!0,message:K})}).catch(k=>{console.error("Failed to send onMessage rejected reply",k)})};return D(h?C:d),!0}),Ie=({reject:l,resolve:u},g)=>{n.runtime.lastError?n.runtime.lastError.message===t?u():l(new Error(n.runtime.lastError.message)):g&&g.__mozWebExtensionPolyfillReject__?l(new Error(g.message)):u(g)},le=(l,u,g,..._)=>{if(_.length<u.minArgs)throw new Error(`Expected at least ${u.minArgs} ${p(u.minArgs)} for ${l}(), got ${_.length}`);if(_.length>u.maxArgs)throw new Error(`Expected at most ${u.maxArgs} ${p(u.maxArgs)} for ${l}(), got ${_.length}`);return new Promise((w,T)=>{let O=Ie.bind(null,{resolve:w,reject:T});_.push(O),g.sendMessage(..._)})},Ve={devtools:{network:{onRequestFinished:R(S)}},runtime:{onMessage:R(V),onMessageExternal:R(V),sendMessage:le.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:le.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},G={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return i.privacy={network:{"*":G},services:{"*":G},websites:{"*":G}},N(n,Ve,i)};e.exports=r(chrome)}else e.exports=globalThis.browser})});var W=Y(Q(),1);function P(e){var t=String(e);if(t==="[object Object]")try{t=JSON.stringify(e)}catch{}return t}var Je=function(){function e(){}return e.prototype.isSome=function(){return!1},e.prototype.isNone=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(t){return t},e.prototype.expect=function(t){throw new Error("".concat(t))},e.prototype.unwrap=function(){throw new Error("Tried to unwrap None")},e.prototype.map=function(t){return this},e.prototype.mapOr=function(t,r){return t},e.prototype.mapOrElse=function(t,r){return t()},e.prototype.or=function(t){return t},e.prototype.orElse=function(t){return t()},e.prototype.andThen=function(t){return this},e.prototype.toResult=function(t){return b(t)},e.prototype.toString=function(){return"None"},e}(),m=new Je;Object.freeze(m);var qe=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.isSome=function(){return!0},e.prototype.isNone=function(){return!1},e.prototype[Symbol.iterator]=function(){var t=Object(this.value);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.unwrapOr=function(t){return this.value},e.prototype.expect=function(t){return this.value},e.prototype.unwrap=function(){return this.value},e.prototype.map=function(t){return A(t(this.value))},e.prototype.mapOr=function(t,r){return r(this.value)},e.prototype.mapOrElse=function(t,r){return r(this.value)},e.prototype.or=function(t){return this},e.prototype.orElse=function(t){return this},e.prototype.andThen=function(t){return t(this.value)},e.prototype.toResult=function(t){return f(this.value)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Some(".concat(P(this.value),")")},e.EMPTY=new e(void 0),e}(),A=qe,F;(function(e){function t(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var c=[],s=0,p=i;s<p.length;s++){var a=p[s];if(a.isSome())c.push(a.value);else return a}return A(c)}e.all=t;function r(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];for(var c=0,s=i;c<s.length;c++){var p=s[c];return p.isSome(),p}return m}e.any=r;function n(i){return i instanceof A||i===m}e.isOption=n})(F||(F={}));var Le=function(){function e(t){if(!(this instanceof e))return new e(t);this.error=t;var r=new Error().stack.split(`
`).slice(2);r&&r.length>0&&r[0].includes("ErrImpl")&&r.shift(),this._stack=r.join(`
`)}return e.prototype.isOk=function(){return!1},e.prototype.isErr=function(){return!0},e.prototype[Symbol.iterator]=function(){return{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(t){return t},e.prototype.unwrapOr=function(t){return t},e.prototype.expect=function(t){throw new Error("".concat(t," - Error: ").concat(P(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.expectErr=function(t){return this.error},e.prototype.unwrap=function(){throw new Error("Tried to unwrap Error: ".concat(P(this.error),`
`).concat(this._stack),{cause:this.error})},e.prototype.unwrapErr=function(){return this.error},e.prototype.map=function(t){return this},e.prototype.andThen=function(t){return this},e.prototype.mapErr=function(t){return new b(t(this.error))},e.prototype.mapOr=function(t,r){return t},e.prototype.mapOrElse=function(t,r){return t(this.error)},e.prototype.or=function(t){return t},e.prototype.orElse=function(t){return t(this.error)},e.prototype.toOption=function(){return m},e.prototype.toString=function(){return"Err(".concat(P(this.error),")")},Object.defineProperty(e.prototype,"stack",{get:function(){return"".concat(this,`
`).concat(this._stack)},enumerable:!1,configurable:!0}),e.prototype.toAsyncResult=function(){return new X(this)},e.EMPTY=new e(void 0),e}();var b=Le,He=function(){function e(t){if(!(this instanceof e))return new e(t);this.value=t}return e.prototype.isOk=function(){return!0},e.prototype.isErr=function(){return!1},e.prototype[Symbol.iterator]=function(){var t=Object(this.value);return Symbol.iterator in t?t[Symbol.iterator]():{next:function(){return{done:!0,value:void 0}}}},e.prototype.else=function(t){return this.value},e.prototype.unwrapOr=function(t){return this.value},e.prototype.expect=function(t){return this.value},e.prototype.expectErr=function(t){throw new Error(t)},e.prototype.unwrap=function(){return this.value},e.prototype.unwrapErr=function(){throw new Error("Tried to unwrap Ok: ".concat(P(this.value)),{cause:this.value})},e.prototype.map=function(t){return new f(t(this.value))},e.prototype.andThen=function(t){return t(this.value)},e.prototype.mapErr=function(t){return this},e.prototype.mapOr=function(t,r){return r(this.value)},e.prototype.mapOrElse=function(t,r){return r(this.value)},e.prototype.or=function(t){return this},e.prototype.orElse=function(t){return this},e.prototype.toOption=function(){return A(this.value)},e.prototype.safeUnwrap=function(){return this.value},e.prototype.toString=function(){return"Ok(".concat(P(this.value),")")},e.prototype.toAsyncResult=function(){return new X(this)},e.EMPTY=new e(void 0),e}();var f=He,z;(function(e){function t(){for(var c=[],s=0;s<arguments.length;s++)c[s]=arguments[s];for(var p=[],a=0,y=c;a<y.length;a++){var x=y[a];if(x.isOk())p.push(x.value);else return x}return new f(p)}e.all=t;function r(){for(var c=[],s=0;s<arguments.length;s++)c[s]=arguments[s];for(var p=[],a=0,y=c;a<y.length;a++){var x=y[a];if(x.isOk())return x;p.push(x.error)}return new b(p)}e.any=r;function n(c){try{return new f(c())}catch(s){return new b(s)}}e.wrap=n;function i(c){try{return c().then(function(s){return new f(s)}).catch(function(s){return new b(s)})}catch(s){return Promise.resolve(new b(s))}}e.wrapAsync=i;function o(c){return c instanceof b||c instanceof f}e.isResult=o})(z||(z={}));var me=function(e,t,r,n){function i(o){return o instanceof r?o:new r(function(c){c(o)})}return new(r||(r=Promise))(function(o,c){function s(y){try{a(n.next(y))}catch(x){c(x)}}function p(y){try{a(n.throw(y))}catch(x){c(x)}}function a(y){y.done?o(y.value):i(y.value).then(s,p)}a((n=n.apply(e,t||[])).next())})},pe=function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,c;return c={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function s(a){return function(y){return p([a,y])}}function p(a){if(n)throw new TypeError("Generator is already executing.");for(;c&&(c=0,a[0]&&(r=0)),r;)try{if(n=1,i&&(o=a[0]&2?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[a[0]&2,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(a[0]===6&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(y){a=[6,y],i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},X=function(){function e(t){this.promise=Promise.resolve(t)}return e.prototype.andThen=function(t){var r=this;return this.thenInternal(function(n){return me(r,void 0,void 0,function(){var i;return pe(this,function(o){return n.isErr()?[2,n]:(i=t(n.value),[2,i instanceof e?i.promise:i])})})})},e.prototype.map=function(t){var r=this;return this.thenInternal(function(n){return me(r,void 0,void 0,function(){var i;return pe(this,function(o){switch(o.label){case 0:return n.isErr()?[2,n]:(i=f,[4,t(n.value)]);case 1:return[2,i.apply(void 0,[o.sent()])]}})})})},e.prototype.thenInternal=function(t){return new e(this.promise.then(t))},e}();var de=(e,t)=>typeof e[t]=="string";function M(e){try{if(de(e,"__serializer_tag")){if(e.__serializer_tag==="primitive")return f(e.__serializer_value);if(e.__serializer_tag==="regex"){let n=new RegExp(e.__serializer_value);return f(n)}else if(e.__serializer_tag==="array"){let n=[];for(let i of e.__serializer_value){let o=M(i);if(o.isErr())return o;n.push(o.unwrap())}return f(n)}else if(e.__serializer_tag==="map"){let n=[];for(let i of e.__serializer_value){let o=M(i);if(o.isErr())return o;n.push(o.unwrap())}return f(new Map(n))}else if(e.__serializer_tag==="set"){let n=[];for(let i of e.__serializer_value){let o=M(i);if(o.isErr())return o;n.push(o.unwrap())}return f(new Set(n))}else if(e.__serializer_tag==="result_ok"){let n=e.__serializer_value,i=M(n);return i.isErr()?i:f(f(i.unwrap()))}else if(e.__serializer_tag==="result_err"){let n=e.__serializer_value,i=M(n);return i.isErr()?i:f(b(i.unwrap()))}else if(e.__serializer_tag==="option_some"){let n=e.__serializer_value,i=M(n);return i.isErr()?i:f(A(i.unwrap()))}else if(e.__serializer_tag==="option_none")return f(m)}let t=typeof e;if(t==="string"||t==="number"||t==="boolean"||t==="undefined"||Array.isArray(e)||e==null)return b("This object was not serialized with Serialize");let r={};for(let n of Object.keys(e))if(typeof n=="string"){let i=M(e[n]);if(i.isErr())return i;r[n]=i.unwrap()}return f(r)}catch{return b("Failed to inspect object. Not JSON?")}}function E(e){let t=typeof e;if(t==="string"||t==="number"||t==="boolean"||t==="undefined"||e==null)return f({__serializer_tag:"primitive",__serializer_value:e});if(e instanceof RegExp)return f({__serializer_tag:"regex",__serializer_value:e.source});if(Array.isArray(e)){let r=e.map(o=>E(o)),n=r.as_iter().find(o=>o.isErr());if(n.isSome())return n.unwrap();let i=r.as_iter().map(o=>o.unwrap()).toArray();return f({__serializer_tag:"array",__serializer_value:i})}else if(e instanceof Map){let r=[...e.entries()].map(o=>E(o)),n=r.as_iter().find(o=>o.isErr());if(n.isSome())return n.unwrap();let i=r.as_iter().map(o=>o.unwrap()).toArray();return f({__serializer_tag:"map",__serializer_value:i})}else if(e instanceof Set){let r=[...e.values()].map(o=>E(o)),n=r.as_iter().find(o=>o.isErr());if(n.isSome())return n.unwrap();let i=r.as_iter().map(o=>o.unwrap()).toArray();return f({__serializer_tag:"set",__serializer_value:i})}else if(z.isResult(e))if(e.isOk()){let r=e.unwrap(),n=E(r);return n.isErr()?n:f({__serializer_tag:"result_ok",__serializer_value:n.unwrap()})}else{let r=e.unwrapErr(),n=E(r);return n.isErr()?n:f({__serializer_tag:"result_err",__serializer_value:n.unwrap()})}else if(F.isOption(e))if(e.isSome()){let r=e.unwrap(),n=E(r);return n.isErr()?n:f({__serializer_tag:"option_some",__serializer_value:n.unwrap()})}else return f({__serializer_tag:"option_none"});else if(t==="object"){let r={},n=e;for(let i of Object.keys(e)){let o=n[i],c=E(o);if(c.isErr())continue;let s=c.unwrap();r[i]=s}return f(r)}else return b("Unsupported value")}function v(e){return Object.assign(e.prototype,{find:function(t){for(let r of this)if(t(r))return A(r);return m},count:function(t){return this.reduce((r,n)=>(t(n)&&r++,r),0)},reduce:function(t,r){let n=r;for(let i of this)n=t(n,i);return n},every:function(t){return!this.any(r=>!t(r))},any:function(t){for(let r of this)if(t(r))return!0;return!1},map:function(t){return this.filterMap(r=>A(t(r)))},filter:function(t){return this.filterMap(r=>t(r)?A(r):m)},enumerate:function(){let t=this;return v(function*(){let r=0;for(let n of t)yield[r,n],r++})()},filterMap:function(t){let r=this;return v(function*(){for(let n of r){let i=t(n);i.isSome()&&(yield i.unwrap())}})()},sort:function(t){let r=this.toArray();return r.sort(t),r},toArray:function(){return[...this]}}),e}Array.prototype.as_iter||(Array.prototype.as_iter=function(){let e=this;return v(function*(){for(let t of e)yield t})()});Set.prototype.as_iter||(Set.prototype.as_iter=function(){let e=this;return v(function*(){for(let t of e)yield t})()});Map.prototype.as_iter||(Map.prototype.as_iter=function(){let e=this;return v(function*(){for(let t of e)yield t})()});var J=/.^/,ee={Av1:{name:"Av1",type:"video",mimetype:/av01.*/i,defacto_container:"WebM"},H264:{name:"H264",type:"video",mimetype:/avc1.*/i,defacto_container:"Mp4"},H263:{name:"H263",type:"video",mimetype:J,defacto_container:"3gp"},H265:{name:"H265",type:"video",mimetype:/(hvc1|hevc|h265|h\.265).*/i,defacto_container:"Mp4"},MP4V:{name:"MP4V",type:"video",mimetype:/mp4v\.20.*/i,defacto_container:"Mp4"},MPEG1:{name:"MPEG1",type:"video",mimetype:J,defacto_container:"Mpeg"},MPEG2:{name:"MPEG2",type:"video",mimetype:J,defacto_container:"Mpeg"},Theora:{name:"Theora",type:"video",mimetype:/theora/i,defacto_container:"Ogg"},VP8:{name:"VP8",type:"video",mimetype:/vp0?8.*/i,defacto_container:"WebM"},VP9:{name:"VP9",type:"video",mimetype:/vp0?9.*/i,defacto_container:"WebM"},unknown:{name:"unknown",type:"video",mimetype:J,defacto_container:"Mp4"}},fe={AAC:{name:"AAC",type:"audio",mimetype:/(aac|mp4a.40).*/i,defacto_container:"Mp4"},PCM:{name:"PCM",type:"audio",mimetype:/pcm.*/i,defacto_container:"Wav"},FLAC:{name:"FLAC",type:"audio",mimetype:/flac/i,defacto_container:"Flac"},MP3:{name:"MP3",type:"audio",mimetype:/(\.?mp3|mp4a\.69|mp4a\.6b).*/i,defacto_container:"Mpeg"},Opus:{name:"Opus",type:"audio",mimetype:/(opus|(mp4a\.ad.*))/i,defacto_container:"Ogg"},Vorbis:{name:"Vorbis",type:"audio",mimetype:/vorbis/i,defacto_container:"Ogg"},Wav:{name:"Wav",type:"audio",mimetype:J,defacto_container:"Wav"},unknown:{name:"unknown",type:"audio",mimetype:J,defacto_container:"Mp4"}},ge=v(function*(){for(let e of Object.keys(ee))yield ee[e]}),_e=v(function*(){for(let e of Object.keys(fe))yield fe[e]});function te(e){return typeof e=="string"&&e in ee?A(e):m}var re={Mp4:{name:"Mp4",extension:"mp4",audio_only_extension:"mp3",defacto_codecs:{audio:m,video:m},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2","unknown"],supported_audio_codecs:["Opus","MP3","FLAC","AAC","unknown"],mimetype:/(?:x-)?mp4/i},Mkv:{name:"Mkv",extension:"mkv",audio_only_extension:"mp3",defacto_codecs:{audio:m,video:m},supported_video_codecs:ge().filter(e=>e.name!="unknown").map(e=>e.name).toArray(),supported_audio_codecs:_e().filter(e=>e.name!="unknown").map(e=>e.name).toArray(),mimetype:/(?:x-)?matroska/i},WebM:{name:"WebM",extension:"webm",audio_only_extension:"oga",defacto_codecs:{audio:m,video:m},supported_video_codecs:["H264","VP8","VP9","Av1"],supported_audio_codecs:["Opus","Vorbis"],mimetype:/(?:x-)?webm/i},M2TS:{name:"M2TS",extension:"mt2s",audio_only_extension:"mp3",defacto_codecs:{audio:m,video:m},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2","VP9","unknown"],supported_audio_codecs:["Opus","MP3","FLAC","AAC"],mimetype:/(?:x-)?mts/i},MP2T:{name:"MP2T",extension:"mp2t",audio_only_extension:"mp3",defacto_codecs:{audio:A("MP3"),video:A("H264")},supported_video_codecs:["MPEG2","MPEG1"],supported_audio_codecs:["MP3"],mimetype:/(?:x-)?mp2t/i},Flash:{name:"Flash",extension:"flv",audio_only_extension:"mp3",defacto_codecs:{audio:m,video:m},supported_video_codecs:["H264"],supported_audio_codecs:["AAC"],mimetype:/(?:x-)?flv/i},M4V:{name:"M4V",extension:"m4v",audio_only_extension:"mp3",defacto_codecs:{audio:m,video:m},supported_video_codecs:["H264","H265","Av1","MP4V","MPEG2"],supported_audio_codecs:["Opus","MP3","FLAC","AAC"],mimetype:/(?:x-)?m4v/i},M4A:{name:"M4A",extension:"m4a",other_extensions:["aac"],audio_only_extension:"m4a",defacto_codecs:{audio:A("AAC"),video:m},supported_video_codecs:[],supported_audio_codecs:["Opus","MP3","FLAC","AAC","unknown"],mimetype:/(?:x-)?m4a/i},Flac:{name:"Flac",extension:"flac",audio_only_extension:"flac",defacto_codecs:{audio:A("FLAC"),video:m},supported_video_codecs:[],supported_audio_codecs:["FLAC"],mimetype:/(?:x-)?flac/i},Mpeg:{name:"Mpeg",extension:"mpeg",audio_only_extension:"mp3",defacto_codecs:{audio:A("MP3"),video:A("H264")},supported_video_codecs:["MPEG2","MPEG1"],supported_audio_codecs:["MP3"],mimetype:/(?:x-)?mpeg/i},Ogg:{name:"Ogg",extension:"ogv",audio_only_extension:"oga",defacto_codecs:{audio:m,video:m},supported_video_codecs:["VP9","VP8","Theora"],supported_audio_codecs:["Opus","Vorbis","FLAC"],mimetype:/(?:x-)?og./i},Wav:{name:"Wav",extension:"wav",audio_only_extension:"wav",defacto_codecs:{audio:A("Wav"),video:m},supported_video_codecs:[],supported_audio_codecs:["Wav","PCM"],mimetype:/(?:x-)?(?:pn-)?wave?/i},"3gp":{name:"3gp",extension:"3gpp",audio_only_extension:"mp3",defacto_codecs:{audio:m,video:m},supported_video_codecs:["H264","H263","MP4V","VP8"],supported_audio_codecs:["MP3","AAC"],mimetype:/(?:x-)?3gpp2?/i},QuickTime:{name:"QuickTime",extension:"mov",audio_only_extension:"mp3",defacto_codecs:{audio:m,video:m},supported_video_codecs:["MPEG1","MPEG2"],supported_audio_codecs:[],mimetype:/(?:x-)?mov/i}},Ue=v(function*(){for(let e of Object.keys(re))yield e}),jt=v(function*(){for(let e of Ue())yield re[e]});function ne(e){return typeof e=="string"&&e in re?A(e):m}var ye={240:{id:"240",loose_name:"Small"},360:{id:"360",loose_name:"SD"},480:{id:"480",loose_name:"SD"},720:{id:"720",loose_name:"HD"},1080:{id:"1080",loose_name:"FullHD"},1440:{id:"1440",loose_name:"UHD"},2160:{id:"2160",loose_name:"4K"},4320:{id:"4320",loose_name:"8K"}};var Ae=v(function*(){for(let e of Object.keys(ye))yield e}),Jt=v(function*(){for(let e of Ae())yield ye[e]});function $(e){if(typeof e=="string")return Ae().find(t=>t==e);if(typeof e=="number"){let t=e.toString();return $(t)}return m}function oe(){return{prefer_60fps:!0,ignore_low_quality_hits:!0,max_variants:3,container:"Mp4",video_codec:"H264",best_video_quality:"4320",lowest_video_quality:"480",ignored_containers:[],ignored_video_codecs:[]}}function xe(e){return E(e).unwrap()}function he(e){let t=M(e).unwrapOr({}),r=oe(),n=ne(t.container).unwrapOr(r.container),i=te(t.video_codec).unwrapOr(r.video_codec),o=$(t.best_video_quality).unwrapOr(r.best_video_quality),c=$(t.lowest_video_quality).unwrapOr(r.lowest_video_quality),s;if("prefered_video_quality"in t){let S=$(t.prefered_video_quality);S.isSome()&&(s=S.unwrap())}let p=r.max_variants;if(typeof t.max_variants=="number"){let S=t.max_variants;Number.isInteger(S)&&S<=11&&S>0&&(p=S)}let a=r.prefer_60fps;typeof t.prefer_60fps=="boolean"&&(a=t.prefer_60fps);let y=r.ignore_low_quality_hits;typeof t.ignore_low_quality_hits=="boolean"&&(y=t.ignore_low_quality_hits);let x=[];if(Array.isArray(t.ignored_containers))for(let S of t.ignored_containers){let V=ne(S);V.isSome()&&x.push(V.unwrap())}let N=[];if(Array.isArray(t.ignored_video_codecs))for(let S of t.ignored_video_codecs){let V=te(S);V.isSome()&&N.push(V.unwrap())}let R={prefer_60fps:a,ignore_low_quality_hits:y,container:n,max_variants:p,video_codec:i,lowest_video_quality:c,best_video_quality:o,ignored_containers:x,ignored_video_codecs:N};return typeof s<"u"&&(R.prefered_video_quality=s),R}var ie=Y(Q(),1);function q(){return{template:"%title",max_length:64}}async function we(e,t){let r=e.variants.values().next().value,n=e.title,i=new URL(e.page_url).hostname.replace(/\.com$|\.net$|\.org$/,""),o=new URL(r.manifest_url).pathname.split("/").pop()||"none",c="";if(n.length<4?n=i:n.length<8&&(n+="-"+i),o.includes(".")){let p=o.split(".");p.pop(),o=p.join(".")}if(!t){let p=await j(I);t=p.get(i)||p.get("*"),t||(console.error("Missing '*' rule"),t=q())}try{if(t.selector&&e.tab_id!="none"){let p={tabId:e.tab_id};c=(await ie.default.scripting.executeScript({target:p,world:ie.default.scripting.ExecutionWorld.MAIN,args:[t.selector],func:y=>document.querySelector(y)?.textContent}))[0]?.result}}catch{}let s=t.template.replaceAll("%title",n).replaceAll("%hostname",i).replaceAll("%pathname",o).replaceAll("%selector",c);return s.length<3&&(s=i),s.trim().normalize("NFD").replace(/\./gu," ").replace(/[^\p{L}\p{N}\-\s]/ug,"").replace(/-+/gu,"-").replace(/\s+/gu," ").substring(0,t.max_length)}async function ae(e,t){let r=t;e.hooks&&(r=e.hooks.setter(t)),await W.storage[e.where].set({[e.name]:r})}async function j(e){let t=await W.storage[e.where].get(e.name);if(e.name in t){let r=t[e.name];return e.hooks?e.hooks.getter(r,e):r}return e.default}async function be(e){await W.storage[e.where].remove(e.name)}var ve={name:"view_options",default:{},where:"session"};var fr={name:"media_user_pref",where:"local",default:oe(),hooks:{setter:e=>xe(e),getter:e=>he(e)}},I={name:"smartnaming",where:"local",default:new Map([["*",q()]]),hooks:{setter:e=>E(e).unwrap(),getter:(e,t)=>M(e).unwrapOr(t.default)}},Se={name:"database",where:"session",default:{yt_bulk:m,user_messages:new Set,coapp_status:"checking",license_status:{checking:!0},current_tab_id:0,current_window_id:0,downloadable:new Map,downloading:new Map,downloaded:new Map,download_errors:new Map},hooks:{setter:e=>E(e).unwrap(),getter:(e,t)=>M(e).unwrapOr(t.default)}};var Ce=Y(Q(),1);function Te(e){return e?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):""}function Oe(e,t,r){let n=()=>(console.error(`Requesting unknown i18n string ${e}`),e);t=t.map(i=>i.toString()).map(Te);try{if(e in r){let i=r[e],o=1;for(let c=0;c<t.length;c++)i=i.replace(`$${o}`,t[c]);return i}else{let i=Ce.default.i18n.getMessage(e,t);return i||n()}}catch{return n()}}function Me(e,t){for(let r of Array.from(e.querySelectorAll("[data-i18n]"))){let n=r.dataset.i18nArgs,i=r.dataset.i18nAttr,o;n?o=Oe(r.dataset.i18n,JSON.parse(n),t):o=Oe(r.dataset.i18n,[],t),i?r.setAttribute(i,o):r.textContent=o}}var $e=new URL(document.location.toString()).searchParams,Qe=$e.get("id"),ke=(await j(Se)).downloadable.get(Qe),B=new URL(ke.page_url).hostname;async function se(){let e=await j(I),t=e.get(B)||e.get("*")||q();for(let r of Array.from(document.querySelectorAll(".hostname")))r.textContent=B;document.querySelector("#template").value=t.template,document.querySelector("#selector").value=t.selector||"",document.querySelector("#max-length").value=t.max_length.toString(),document.querySelector("#result").value=""}function Ee(){let e=document.querySelector("#template").value,t=parseInt(document.querySelector("#max-length").value),r=document.querySelector("#selector").value,n=q();return n.template=e,t&&(n.max_length=t),r&&(n.selector=r),n}async function We(e){let t=e.target;if(t){let r=t.closest("#button-reset"),n=t.closest("#button-reset-all"),i=t.closest("#button-save"),o=t.closest("#button-save-all"),c=t.closest("#button-test");if(n&&(await be(I),se()),r){let s=await j(I);s.delete(B),await ae(I,s),se()}if(i||o){let s=await j(I),p=Ee(),a=B;o&&(delete p.selector,a="*"),s.set(a,p),ae(I,s)}if(c){let s=Ee(),p=await we(ke,s);document.querySelector("#result").value=p}}}se();var Be=await j(ve);Me(document,Be);window.addEventListener("click",We);
